var BaseItem=SuperView.extend({_initialize:function(e){this._initOptions(e),this._initCollapse(this.model.get("_options")),this._initTemplate(this._options),this._initBind(this._options),this._initView(this._options),this._initStyle(this._options),this._initEnterEvent(this._options)},_initOptions:function(e){this._options=Est.extend(this.options,e||{}),this._options.speed=this._options.speed||9},_initCollapse:function(e){e._speed>1&&(this.model.stopCollapse=!1,this.collapsed=e?e._extend:!1)},_initTemplate:function(e){e.template=e.template||e.itemTemp,e.template&&(this.$template="<div>"+e.template+"</div>",e.viewId?app.getCompileTemp(e.viewId)||app.addCompileTemp(e.viewId,Handlebars.compile(e.template)):this.template=Handlebars.compile(e.template))},_initBind:function(e){e.speed>1&&(this.model.bind("reset",this.render,this),this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this))},_initView:function(e){e.speed>1&&(this.model.view&&this.model.view.remove(),this.model.view=this)},_initStyle:function(e){if(e.speed>1){var t=this.model.get("id")?this.model.get("id")+"":this.model.get("dx")+1+"";this.model.get("dx")%2===0&&this.$el.addClass("bui-grid-row-even"),this.$el.addClass("_item_el_"+(this._options.viewId||"")+"_"+t.replace(/^[^1-9]+/,"")),this.$el.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}},_render:function(){debug("10.BaseItem._render"),this._onBeforeRender(),this._options&&this._options.filter&&this._options.filter.call(this,this.model),this.$el.html(this.template?this.template(this.model.attributes):this._options.viewId&&app.getCompileTemp(this._options.viewId)&&app.getCompileTemp(this._options.viewId)(this.model.attributes)),this._options.modelBind&&this._modelBind();var e=this.model.get("_options");if(e&&e._subRender&&this.model.get("children")&&this.model.get("children").length>0){var t=this,i=this.model.get("level")||1,s=this.$(e._subRender+":first");this._setupEvents(e),Est.each(this.model._getChildren(e._collection),function(o){var n=null;debug(function(){return Est.isEmpty(o)?"Error20":void 0},{type:"error"}),o.set("_options",e),o.set("level",i+1),n=new e._item({model:o,data:t._options._data}),n._setInitModel(t.initModel),n._setViewId(t._options.viewId),o.view=n,s.append(n.$el),t._options.views&&t._options.views.push(n),n._render()})}return this._onAfterRender(),this},_setViewId:function(e){this._options&&(this._options.viewId=e)},_setInitModel:function(e){this.initModel=e},_setupEvents:function(e){var t=this;t._toggleCollapse.call(this,e),this.$(e._collapse+":first").click(function(){t._toggleCollapse.call(t,e)})},_toggleCollapse:function(e){var t=this;return this.model.stopCollapse?void this.$(e._subRender+":first").addClass("hide"):(t.collapsed=!t.collapsed,void(t.collapsed?(this.$(e._collapse+":first").removeClass("x-caret-down"),this.$(e._subRender+":first").slideUp(CONST.COLLAPSE_SPEED).addClass("hide")):(this.$(e._collapse+":first").addClass("x-caret-down"),this.$(e._subRender+":first").slideDown(CONST.COLLAPSE_SPEED).removeClass("hide"))))},_onBeforeRender:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this.model)},_onAfterRender:function(){this._options.toolTip&&this._initToolTip(),this.afterRender&&this.afterRender.call(this,this.model),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el)},_close:function(){debug("BaseItem._close"),this.stopListening()},_clear:function(){debug("ProductItem._clear"),this.model.destroy()},_check:function(e){var t=this.model.get("checked"),i=null,s=null,o=null,n=!0;this._checkAppend="undefined"==typeof this.model.get("_options")._checkAppend?!1:this.model.get("_options")._checkAppend,this._checkToggle="undefined"==typeof this.model.get("_options")._checkToggle?!1:this.model.get("_options")._checkToggle,this._checkAppend||(this._options.viewId?app.getView(this._options.viewId)&&app.getView(this._options.viewId)._clearChecked():debug("Error21",{type:"error"})),this._checkToggle?this.model.attributes.checked="boolean"===Est.typeOf(e)?e:!t:(this.model.attributes.checked="boolean"===Est.typeOf(e)?e:!0,this._itemActive({add:this._checkAppend})),this.model.get("checked")&&this._checkToggle?this._itemActive({add:this._checkAppend}):this._checkToggle&&(this.$el.removeClass("item-active"),this.model.set("checked",!1)),e&&e.shiftKey&&this._checkAppend?(i=app.getData("curChecked"),s=this.model.get("dx"),Est.each(this.model.collection.models,function(e){o=e.get("dx"),o>i&&s>o&&(e.attributes.checked=!0,e.view.$el.addClass("item-active"))})):app.addData("curChecked",this.model.get("dx")),"boolean"!==Est.typeOf(e)&&e&&e.stopImmediatePropagation(),Est.trigger(this.cid+"checked","checked"),this.model.get("checked")?Est.each(this.model.collection.models,function(e){e.attributes.checked||(n=!1)}):n=!1,app.getView(this._options.viewId)&&app.getView(this._options.viewId)._checkedAll(n)},_itemActive:function(e){e=e||{},app.getData("itemActiveList"+this._options.viewId)||app.addData("itemActiveList"+this._options.viewId,[]);var t=app.getData("itemActiveList"+this._options.viewId);e.add||(debug("BaseItem._itemActive"),Est.each(t,Est.proxy(function(e){$("."+e,app.getView(this._options.viewId)?app.getView(this._options.viewId).$el:$("body")).removeClass("item-active")},this)),t.length=0),this.$el.addClass("item-active"),t.push(this.$el.attr("class").replace(/^.*(_item_el_.+?)\s+.*$/g,"$1"))},_moveUp:function(e){return e.stopImmediatePropagation(),this.collapsed=!0,this._options.viewId?void app.getView(this._options.viewId)._moveUp(this.model):(debug("Error22",{type:"error"}),!1)},_moveDown:function(e){return e.stopImmediatePropagation(),this.collapsed=!0,this._options.viewId?void app.getView(this._options.viewId)._moveDown(this.model):(debug("Error23",{type:"error"}),!1)},_saveSort:function(){var e=this,t=this.$(".input-sort").val();this.model._saveField({id:this.model.get("id"),sort:t},e,{success:function(){e.model.set("sort",t)},hideTip:!0})},_getPage:function(){var e=this.model.collection.paginationModel;return e?e.get("page"):1},_del:function(e,t){e&&e.stopImmediatePropagation(),debug("1.BaseItem._del");var i=this;return app.getData("delItemDialog")&&app.getData("delItemDialog").close(),i.model.get("children").length>0?void BaseUtils.confirm({title:CONST.LANG.TIP,width:300,content:CONST.LANG.DEL_TIP}):void app.addData("delItemDialog",BaseUtils.confirm({title:CONST.LANG.WARM_TIP,content:'<div class="item-delete-confirm">'+CONST.LANG.DEL_CONFIRM+"</div>",target:e&&this._getTarget(e).get(0),success:function(e){Est.isEmpty(i.model.url())&&(i.model.attributes.id=null),i.model.destroy({wait:!0,error:function(e,t){var i=[];i.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),BaseUtils.dialog({title:CONST.LANG.TIP+"ï¼š",content:t.msg,width:250,button:i})},success:function(){i._removeFromItems(i.model.get("dx")),t&&t.call(i)}})}}))},_removeFromItems:function(e){"undefined"!==Est.typeOf(e)&&app.getView(this._options.viewId)&&(app.getView(this._options.viewId)._options.items&&app.getView(this._options.viewId)._options.items.splice(e,1),app.getView(this._options.viewId)._resetDx())}});