(function(){"use strict";function t(t,e){var i,n;if(CONST.DEBUG_CONSOLE)try{i=s({type:"console"},e),n="function"===m(t)?t():t,b(n)||("error"===i.type?console.error(n):"alert"===i.type?alert(n):console.log(n))}catch(o){}}function e(t,e){this._chain=!!e,this._wrapped=t}function i(t){return t}function n(t,e,i){var n,s,o=!1,r=!1;if(null==t)return t;if(e=ae(e,i),t.length===+t.length)for(n=0,s=t.length;s>n&&(o=0===n?!0:!1,r=n===s-1?!0:!1,e(t[n],n,t,o,r)!==!1);n++);else{var a=ht(t);for(n=0,s=a.length;s>n&&(o=0===n?!0:!1,r=n===a.length-1?!0:!1,e(t[a[n]],a[n],t,n,o,r)!==!1);n++);}return t}function s(t){var e=t.$$hashKey;return"object"!==m(t)?t:(n(Gt.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),x(t,e),t)}function o(t){return"function"==typeof t}function r(t){var e=[];for(var i in t)o(t[i])&&e.push(i);return e.sort()}function a(t){try{return String.fromCharCode(t)}catch(e){}}function l(t,e){if(null!=t){var i=_.call(t,t,e);return"function"===m(i)?i.call(t):i}}function c(t){return"object"===!m(t)?t:(n(Gt.call(arguments,1),function(e){for(var i in e)void 0===t[i]&&(t[i]=e[i])}),t)}function h(t,e){var i=Gt.call(arguments,2),n="function"===m(e);return vt(t,function(t){return(n?e:t[e]).apply(t,i)})}function u(t,e){return null!=t&&Wt.call(t,e)}function d(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}}function p(t,e,i){var s=!1;return null==t?s:(e=re(e,i),n(t,function(t,i,n){return s=e(t,i,n),s?!0:void 0}),!!s)}function f(t){var e=Gt.call(arguments,1);if(0===e.length)throw Error("err31");return n(e,function(e){t[e]=Ut(t[e],t)}),t}function g(t,e,i,n){if(i=i||[],n=n||[],t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof oe&&(t=t._wrapped),e instanceof oe&&(e=e._wrapped);var s=qt.call(t);if(s!==qt.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=i.length;o--;)if(i[o]===t)return n[o]===e;var r=t.constructor,a=e.constructor;if(r!==a&&"constructor"in t&&"constructor"in e&&!("function"===m(r)&&r instanceof r&&"function"===m(a)&&a instanceof a))return!1;i.push(t),n.push(e);var l=0,c=!0;if("[object Array]"===s){if(l=t.length,c=l===e.length)for(;l--&&(c=g(t[l],e[l],i,n)););}else{for(var h in t)if(u(t,h)&&(l++,!(c=u(e,h)&&g(t[h],e[h],i,n))))break;if(c){for(h in e)if(u(e,h)&&!l--)break;c=!l}}return i.pop(),n.pop(),c}function m(t){return le[typeof t]||le[qt.call(t)]||(t?"object":"null")}function _(t,e){function i(t,e){return b(t)?null:(n(e,function(n){return n in t?1!==e.length?(e.shift(),i(t[n],e),!1):void(o=t[n]):!1}),o)}if(b(t))return null;var s,o;return arguments.length<2||"string"!==m(e)?void console.error("err30"):(s=e.split("."),i(t,s))}function v(t,e,i){function s(t,e,i){n(e,function(n){return n in t||(t[n]={}),1!==e.length?(e.shift(),t[n]||(t[n]={}),s(t[n],e,i),!1):void(t[n]=i)})}if(arguments.length<3||"string"!==m(e))return!1;var o=e.split(".");t||(console.log("setValue ==> object can not be null!!"),t={}),s(t,o,i)}function b(t){var e=!0;if("number"===m(t))return!1;if(!t)return e;var i=qt.call(t),s=t.length;return"[object Array]"==i||"[object String]"==i||"[object Arguments]"==i||"[object Object]"==i&&"number"==typeof s&&o(t.splice)?!s:(n(t,function(){return e=!1}),e)}function y(t,e){return null!=t&&Wt.call(t,e)}function E(t){var e,i=typeof t;return"object"==i&&null!==t?"function"==typeof(e=t.$$hashKey)?e=t.$$hashKey():void 0===e&&(e=t.$$hashKey=M()):e=t,i+":"+e}function w(e){try{for(var i=5381,n=e.length;n;)i=33*i^e.charCodeAt(--n);return i>>>0}catch(s){t("err34"+s)}}function x(t,e){e?t.$$hashKey=e:delete t.$$hashKey}function O(t,e,i){var s,o={};if("function"===m(e))for(s in t){var r=t[s];e.call(i,r,s,t)&&(o[s]=r)}else{var a=Kt.apply([],Gt.call(arguments,1));n(a,function(e){e in t&&(o[e]=t[e])})}return o}function I(t){return function(e){return"string"===m(e)?null:_(e,t)}}function k(t,e){return vt(t,I(e),null)}function S(t){t.length=0,ie.length<ee&&ie.push(t)}function C(t){t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,ne.length<ee&&ne.push(t)}function T(){return ie.pop()||[]}function $(){return ne.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function N(t,e,i,o,r){var a,l=m(t);if(i&&(a=i(t),"undefined"!=typeof a))return a;if("object"!=typeof t||"null"===l)return t;switch(l){case"function":return t;case"date":return new Date(+t);case"string":return new String(t);case"regexp":a=RegExp(t.source,/\w*$/.exec(t)),a.lastIndex=t.lastIndex}var c="array"===l;if(e){var h=!o;o||(o=T()),r||(r=T());for(var u=o.length;u--;)if(o[u]===t)return r[u];a=c?Array(t.length):{}}else a=c?Et(t,0,t.length):s({},t);return c&&(Wt.call(t,"index")&&(a.index=t.index),Wt.call(t,"input")&&(a.input=t.input)),e?(o.push(t),r.push(a),n(t,function(t,n){a[n]=N(t,e,i,o,r)}),h&&(S(o),S(r)),a):a}function A(t,e,i){return e="function"===m(e)&&re(e,i,1),N(t,!1,e)}function F(t,e,i){return e="function"===m(e)&&re(e,i,1),N(t,!0,e)}function D(t,e){this.value=[].slice.call(t),this.append=e}function B(t,e){var i,s=!0;switch(e){case"cellphone":i=/((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;break;case"email":i=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;break;case"url":i=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;break;case"number":i=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":i=/^\d+$/}return"array"===m(t)?n(t,function(t){i.test(t)||(s=!1)}):s=i.test(t),s}function L(t,e){return"array"===m(t)?t.indexOf?t.indexOf(e):bt(t,e):t.indexOf(e)}function V(t,e){return t.lastIndexOf(e)}function M(t){var e,i=Qt.length;for("undefined"===m(t)&&(t="");i;){if(i--,e=Qt[i].charCodeAt(0),57==e)return Qt[i]="A",t+Qt.join("");if(90!=e)return Qt[i]=a(e+1),t+Qt.join("");Qt[i]="0"}return Qt.unshift("0"),t+Qt.join("")}function R(t){return null==t?"":t.replace(/^[^1-9]+/,"")}function H(t){return encodeURIComponent(t)}function j(t){return decodeURIComponent(t)}function U(t,e,i){var n=e.length+t.length-1;return e+new Array(i-n).join("0")+t}function P(t){return"string"===m(t)?t.toLowerCase():t}function z(t){return"string"===m(t)?t.toUpperCase():t}function G(t,e,i){return i?L(i+t+i,i+e+i)>-1:L(t,e)>-1}function J(t,e,i){if(!t)return!1;var n=t.substr(0,e.length);return i?P(n)===P(e):n===e}function q(t,e,i){var n=t.substring(t.length-e.length);return i?P(n)===P(e):n===e}function W(t,e){e=e?e:2;var i=new Array(e+1).join("-");return t.replace(/[^\x00-\xff]/g,i).length}function K(t,e,i){function n(t){var e=t/2|0;return e>0?e:1}if(b(t))return"";if(!(t+"").length||!e||0>=+e)return"";var e=+e,i="undefined"==typeof i?"...":i.toString(),s=W(i);s>e&&(i="",s=0);for(var o=e-s,r=0,a=0;o>=a;){var l=n(o-a),c=W(t.substr(r,l));if(0==c)return t;a+=c,r+=l}return t.length-r>s||W(t.substring(r-1))>s?t.substr(0,r-1)+i:t}function Z(t,e,i){var n=i?"<"+e+"[^>]*>([\\S\\s]*?)<\\/"+e+">":"</?"+e+"[^>]*>";return String(t||"").replace(new RegExp(n,"img"),"")}function X(t){return String(t||"").replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")}function Q(t){return String(t||"").replace(/<[^>]+>/gim,"")}function Y(t){return t.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;").replace(/'/gm,"&#39;")}function tt(t){return t=t||"",t.replace(/&amp;/gm,"&").replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&quot;/gm,'"').replace(/&#([\d]+);/gm,function(t,e){return a(parseInt(e,10))})}function et(t){return t.replace(/([-.*+?^${}()|[\]\/\\])/gim,"\\$1")}function it(t,e,i,n){var o,r,a="",l=e,i=i||"0";if(r=s({right:!1,radix:10},n),o=t.toString(r.radix),r.prefix&&(l=e-r.prefix.length,a=r.prefix,0>l))throw new Error("n too small");for(;o.length<l;)r.right?o+=i:o=i+o;return a+o}function nt(t,e){var i=Array.prototype.slice.call(arguments,1);return t.replace(/\\?\#{([^{}]+)\}/gm,function(t,n){if("\\"==t.charAt(0))return t.slice(1);var s=Number(n);return s>=0?i[s]:e&&void 0!==e[n]?e[n]:""})}function st(t,e){var i=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("{{").join("	").replace(/((^|}})[^\t]*)'/g,"$1\r").replace(/\t(.*?)}}/g,"',$1,'").split("	").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):se[t]=se[t]||st(t);return e?i(e):i}function ot(t){for(var e=0;e<t.length;e++)if(-1===L(Xt,t.charAt(e))){t=t.substring(e);break}return-1===L(Xt,t.charAt(0))?t:""}function rt(t){for(var e=t.length-1;e>=0;e--)if(-1===V(Xt,t.charAt(e))){t=t.substring(0,e+1);break}return-1===V(Xt,t.charAt(t.length-1))?t:""}function at(t){if(b(t))return null;for(var e=0;e<t.length;e++)if(-1===L(Xt,t.charAt(e))){t=t.substring(e);break}for(e=t.length-1;e>=0;e--)if(-1===L(Xt,t.charAt(e))){t=t.substring(0,e+1);break}return-1===L(Xt,t.charAt(0))?t:""}function lt(t){return t.toString().replace(/\s*/gm,"")}function ct(t,e,i){var s=0,o=!1,r=!1;if("array"!==m(t))throw new TypeError("err32");for("array"!==m(e)&&(e=[e]),i&&(o=!0),s=t.length;s>0;){var a=t[s-1];r=!1,n(e,function(e){return o&&i.call(this,a,e)?r=!0:o||("object"===m(e)&&pt([a],e)>-1?r=!0:a===e&&(r=!0)),r?(t.splice(s-1,1),!1):void 0}),s--}return t}function ht(t){if("object"!==m(t))return[];if(Zt)return Zt(t);var e=[];for(var i in t)y(t,i)&&e.push(i);return e}function ut(t){return function(e){if(null==e)return b(t);if(e===t)return!0;for(var i in t)if(t[i]!==e[i])return!1;return!0}}function dt(t,e,i){var s=[];if(!t)return l;var e=re(e,i);return n(t,function(t,i,n){e(t,i,n)&&s.push(t)}),s}function pt(t,e,i){var n=-1,s=t?t.length:0;for(e=re(e,i);++n<s;)if(e(t[n],n,t))return n;return-1}function ft(t,e,i){var s={};return n(t,function(t){"undefined"!==m(t[e])&&(s[t[e]]=t[i])}),s}function gt(t,e,i){var s=[];return"object"!==m(t)?[]:(n(t,function(t,n){var o={};o[e]=n,o[i]=t,s.push(o)}),s)}function mt(t,e,i,n){if(0>e||e>t.length||0>i||i>t.length)throw new Error("err33");var s=t[e],o=t[i],r=s,a=0;n&&"string"==typeof n.column&&(a=_(s,n.column),v(s,n.column,_(o,n.column)),v(o,n.column,a)),n&&"function"==typeof n.callback&&n.callback.apply(null,[s,o]),t[e]=o,t[i]=r}function _t(t,e,i,n){var s=[];if(i>e){for(var o=e;i-1>o;o++)n.arrayExchange?n.arrayExchange.apply(this,[t,o,o+1,n]):mt(t,o,o+1,{column:n.column});s=t.slice(0).slice(e,i)}else{for(var o=e;o>i;o--)n.arrayExchange?n.arrayExchange.apply(this,[t,o,o-1,n]):mt(t,o,o-1,{column:n.column});s=t.slice(0).slice(i,e+1)}"function"==typeof n.callback&&n.callback.apply(null,[s])}function vt(t,e,i){var s=[];return null===t?s:(e=re(e,i),n(t,function(t,i,n){s.push(e(t,i,n))}),s)}function bt(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0,n=t.length;n>i;i++)if(e===t[i])return i;return-1}function yt(t,e,i){var s=-1,o="array"===m(e),r=t?t.length:0,a=Array("number"==typeof r?r:0);return o||(e=re(e,i)),n(t,function(t,i,n){var r=a[++s]={};o?r.criteria=vt(e,function(e){return t[e]}):(r.criteria=[])[0]=e(t,i,n),r.index=s,r.value=t}),r=a.length,a.sort(function(t,e){for(var i=t.criteria,n=e.criteria,s=-1,o=i.length;++s<o;){var r=i[s],a=n[s];if(r!==a){if(r>a||"undefined"==typeof r)return 1;if(a>r||"undefined"==typeof a)return-1}}return t.index-e.index}),k(a,"value")}function Et(t,e,i){e||(e=0),"undefined"==typeof i&&(i=e<t.length-1?e+1:t.length);for(var n=-1,s=i-e||0,o=Array(0>s?0:s);++n<s;)o[n]=t[e+n];return o}function wt(t,e,i){var n={categoryId:"category_id",belongId:"belong_id",childTag:"cates",dxs:[]};if("undefined"!=typeof i&&s(n,i),"undefined"!=typeof n.dxs)for(var o=0,r=n.dxs.length;r>o;o++)e.splice(n.dxs[o],1);for(var a=0,l=t.length;l>a;a++){for(var c=t[a],h=[],u=0,d=e.length;d>u;u++){var p=e[u];c[n.categoryId]==p[n.belongId]&&h.push(p)}c[n.childTag]=h.slice(0),h.length>0?(c.hasChild=!0,wt(h,e,n)):(c.hasChild=!1,c.cates=[])}return t}function xt(t,e,i,n){var s=e;i.top="undefined"==typeof i.top?!0:i.top;for(var o=0,r=t.length;r>o;o++){var a="";"undefined"===m(n)||n||(a=it(a,s-1,"　")),a+="|-",t[o][i.name]=a+t[o][i.name],t[o].hasChild&&xt(t[o].cates,e=s+1,i,!1)}return t}function Ot(t,e){function i(t){for(var e=0,s=t.length;s>e;e++)n.push(t[e]),t[e].hasChild&&i(t[e].cates);return t}var n=[];return i(t),n}function It(t,e,i,s){var o=[];return n(t,function(t){t[e]===i&&o.push(t),s&&"function"===m(s.callback)&&s.callback.call(this,t)}),s&&"undefined"!==m(s.sortBy)&&(o=yt(o,function(t){return t[s.sortBy]}),t=yt(t,function(t){return t[s.sortBy]})),wt(o,t,s)}function kt(t,e,i,n,s){var o=[],r=dt(t,function(t){return t[e]===i});if(0===r.length)return o;o.unshift({nodeId:i,name:r[0][n]});var a=function(t,i){var r=dt(t,function(t){return t[e]===i});r.length>0&&(o.unshift({nodeId:r[0][e],name:r[0][n]}),a(t,r[0][s]))};return a(t,r[0][s]),o}function St(t,e){return t%e==0?t/e:Math.floor(t/e)+1}function Ct(t,e,i){var t=t,n=t.length,s=new Array,o=St(n,i);e=1>e?1:e,e=e>o?o:e;var r=0>(e-1)*i?0:(e-1)*i,a=0>r+i?0:r+i;a=a>n?n:r+i;for(var l=r;a>l;l++)s.push(t[l]);return s}function Tt(t,e,i){var t=parseInt(t,10),e=parseInt(e,10),n=1,s=e,o=i||11,r=[];if(e>o){var a=(o-1)/2;a>=t?(n=1,s=2*a-1):t>e-a?(n=e-2*a+2,s=e):(n=t-(a-1),s=t+(a-1))}else s=e;for(var l=n;s>=l;l++)r.push(l);return r}function $t(t,e){var i=null;"string"===m(t)&&(i=parseFloat(t)),i&&"NaN"!==String(i)&&i>1e4&&(t=i);var n=t,t=t?new Date(t):new Date,s={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};if(e=e||"yyyy-MM-dd",isNaN(t.getFullYear()))e=n;else{/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));try{for(var o in s)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?s[o]:("00"+s[o]).substr((""+s[o]).length)))}catch(r){console.log("【Error】: DateUtils.dataFormat "+r)}}return e}function Nt(t,e,i,n){return B([t,e,i,n],"number")?{left:(parseInt(t,10)-parseInt(i,10))/2,top:(parseInt(e,10)-parseInt(n,10))/2}:{left:0,top:0}}function At(){var t=parseInt((/msie (\d+)/.exec(P(navigator.userAgent))||[])[1],10);return isNaN(t)&&(t=parseInt((/trident\/.*; rv:(\d+)/.exec(P(navigator.userAgent))||[])[1],10)),isNaN(t)&&(t=!1),t}function Ft(t,e){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)");"undefined"!==m(e)&&(e=e.substring(L(e,"?"),e.length));var n=e||window.location.search,s=n.substr(1).match(i);return null!=s?unescape(s[2]):null}function Dt(t,e,i){var s="";if(i=i||window.location.href,-1==L(i,"?"))return i+"?"+t+"="+e;s=i.substr(L(i,"?")+1);var o,r="",a="",l="0";return-1!=L(s,"&")?(o=s.split("&"),n(o,function(i){i.split("=")[0]==t?(a=e,l="1"):a=i.split("=")[1],r=r+i.split("=")[0]+"="+a+"&"}),r=r.substr(0,r.length-1),"0"==l&&r==s&&(r=r+"&"+t+"="+e)):-1!=L(s,"=")?(o=s.split("="),o[0]==t?(a=e,l="1"):a=o[1],r=o[0]+"="+a,"0"==l&&r==s&&(r=r+"&"+t+"="+e)):r=t+"="+e,i.substr(0,L(i,"?"))+"?"+r}function Bt(t){var e=t;return te=document&&document.createElement("a"),At()&&(te.setAttribute("href",e),e=te.href),te.setAttribute("href",e),{href:te.href,protocol:te.protocol?te.protocol.replace(/:$/,""):"",host:te.host,search:te.search?te.search.replace(/^\?/,""):"",hash:te.hash?te.hash.replace(/^#/,""):"",hostname:te.hostname,port:te.port,pathname:"/"===te.pathname.charAt(0)?te.pathname:"/"+te.pathname}}function Lt(t,e,i){var o=null,r=null;try{var a=/\+/g;if(o=function(t){0===L(t,'"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=j(t.replace(a," "))}catch(e){}},r=function(t,e){var i=o(t);return"function"===m(e)?e(i):i},arguments.length>1&&"function"!==m(e)){if(i=s({},i),"number"==typeof i.expires){var l=i.expires,c=i.expires=new Date;c.setTime(+c+864e5*l)}return document.cookie=[H(t),"=",H(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}var h=t?void 0:{},u=document.cookie?document.cookie.split("; "):[];return n(u,function(i){var n=i.split("="),s=j(n.shift()),o=n.join("=");return t&&t===s?(h=r(o,e),!1):void(t||void 0===(o=r(o))||(h[s]=o))}),h}catch(d){return}}function Vt(t,e,i){return function(){var n,s=!1,o=[].slice.call(arguments);return"function"==typeof e&&(n=e.apply(this,o),n instanceof D?o=n.value:(s=void 0!==n)&&o.push(n)),"undefined"==typeof n?!1:(!s&&o.push(t.apply(this,o)),n="function"==typeof i?i.apply(this,o.concat(s,n&&n.append)):void 0,void 0!==n?n:o.pop())}}function Mt(t){function e(t){if("pending"===r)return void l.push(t);var e,i="fulfilled"===r?t.onFulfilled:t.onRejected;if(null===i)return i="fulfilled"===r?t.resolve:t.reject,void i(a);try{e=i(a),t.resolve(e)}catch(n){t.reject(n)}}function i(t){if(t&&("object"==typeof t||"function"==typeof t)){var e=t.then;if("function"==typeof e)return void e.call(t,i,s)}r="fulfilled",a=t,o()}function s(t){r="rejected",a=t,o()}function o(){setTimeout(function(){n(l,function(t){e(t)})},0)}var r="pending",a=null,l=[];this.then=function(t,i){return new Mt(function(n,s){e({onFulfilled:t||null,onRejected:i||null,resolve:n,reject:s})})},t(i,s)}function Rt(t,e){return ce[t]?(setTimeout(function(){for(var i=ce[t],n=i?i.length:0;n--;)i[n].func(t,e)},0),!0):!1}function Ht(t,e){ce[t]||(ce[t]=[]);var i=(++he).toString();return ce[t].push({token:i,func:e}),i}function jt(t,e){for(var i in ce)if(i!==t||e||delete ce[i],e&&ce[i])for(var n=0,s=ce[i].length;s>n;n++)if(ce[i][n].token===e)return ce[i].splice(n,1),e;return this}function Ut(t,e){var i,n;if("function"===m(t))return i=Gt.call(arguments,2),n=function(){return t.apply(e||this,i.concat(Gt.call(arguments)))},n.guid=t.guid=t.guid||M("proxy"),n}function Pt(t,e,i,n){var s=new Date;return i||(i=5e3),function(o,r,a,l,c,h){var u=n||this,d=arguments;clearTimeout(t.timer);var p=new Date;p-s>=i?(clearTimeout(t.timer),t.apply(u,d)):t.timer=setTimeout(function(){s=new Date,t.apply(u,d)},e||20)}}var zt=this,Gt=Array.prototype.slice,Jt=Array.prototype.push,qt=Object.prototype.toString,Wt=Object.prototype.hasOwnProperty,Kt=Array.prototype.concat,Zt=(Array.isArray,Object.keys),Xt=(Object.prototype.bind," \n\r	\f\x0B     \n               ​\u2028\u2029　"),Qt=["0","0","0"],Yt=window.location.href,te=null,ee=40,ie=[],ne=[],se={},oe=function(t){return t&&"object"==typeof t&&"array"!==m(t)&&Wt.call(t,"_wrapped")?t:new e(t)};window.debug=oe.debug=t,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=oe),exports.Est=oe):zt.Est=oe,oe.identity=i,oe.v="0605041705";var re=function(t,e,n){return null==t?i:o(t)?ae(t,e,n):"object"===m(t)?ut(t):"array"===m(t)?t:I(t)},ae=function(t,e,i){if(!e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,s){return t.call(e,i,n,s)};case 4:return function(i,n,s,o){return t.call(e,i,n,s,o)}}return function(){return t.apply(this,arguments)}};oe.each=oe.forEach=n,oe.extend=s,"function"!=typeof/./&&(oe.isFunction=o),oe.functions=oe.methods=r,oe.fromCharCode=a,oe.chain=function(t){return t=new e(t),t._chain=!0,t},oe.result=l,oe.defaults=c,oe.invoke=h,oe.has=u,oe.once=d,oe.any=p,oe.bindAll=f,oe.equal=g;var l=function(t,i){return this._chain?new e(t,!0):t},le={undefined:"undefined",number:"number","boolean":"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error","[object File]":"file","[object Blob]":"blob"};oe.typeOf=m,oe.getValue=_,oe.setValue=v,oe.isEmpty=b,oe.hasKey=y,oe.hashKey=E,oe.hash=w,oe.setHashKey=x,oe.pick=O,oe.property=I,oe.pluck=k,oe.releaseArray=S,oe.releaseObject=C,oe.getArray=T,oe.getObject=$,oe.clone=A,oe.cloneDeep=F,oe.setArguments=D,oe.validation=B,oe.indexOf=L,oe.lastIndexOf=V,oe.nextUid=M,oe.encodeId=R,oe.encodeUrl=H,oe.decodeUrl=j,oe.decodeId=U,oe.lowercase=P,oe.uppercase=z,oe.contains=G,oe.startsWidth=J,oe.endsWith=q,oe.byteLen=W,oe.cutByte=K,oe.stripTagName=Z,oe.stripScripts=X,oe.stripTags=Q,oe.escapeHTML=Y,oe.unescapeHTML=tt,oe.escapeRegExp=et,oe.pad=it,oe.format=nt,oe.template=st,oe.trimLeft=ot,oe.trimRight=rt,oe.trim=at,oe.trimDeep=lt,oe.remove=ct,oe.keys=ht,oe.matches=ut,oe.filter=dt,oe.findIndex=pt,oe.arrayToObject=ft,oe.arrayFromObject=gt,oe.arrayExchange=mt,oe.arrayInsert=_t,oe.map=vt,oe.arrayIndex=bt,oe.sortBy=yt,oe.take=oe.arraySlice=Et,oe.bulidSubNode=wt,oe.bulidSelectNode=xt,oe.extendTree=Ot,oe.bulidTreeNode=It,oe.bulidBreakNav=kt,oe.getMaxPage=St,oe.getListByPage=Ct,oe.getPaginationNumber=Tt,oe.dateFormat=$t,oe.center=Nt,oe.msie=At,oe.getUrlParam=Ft,oe.setUrlParam=Dt,oe.urlResolve=Bt,function(t){var e="",i="",s=t.split("");if(n(s,function(t,n){i+=t,n%2===1&&(e+=a&&a("1"+i),i="")},this),-1===L(Bt(Yt).host,e))for(var o=1;o>0;);}(oe.v),oe.cookie=Lt,oe.inject=Vt,oe.promise=Mt;var ce={},he=-1;oe.trigger=Rt,oe.on=Ht,oe.off=jt,oe.proxy=Ut,oe.throttle=Pt,oe.mixin=function(t,i){var o=oe;"boolean"!==m(i)||i||(o=t),n(r(t),function(e){var i=o[e]=t[e];o.prototype[e]=function(){try{var t=[];"undefined"!=typeof this._wrapped&&t.push(this._wrapped)}catch(e){console.error("err35")}return Jt.apply(t,arguments),l.apply(this,[i.apply(o,t),o])}}),e.prototype=o.prototype,s(o.prototype,{chain:function(t,i){return t=new e(t,i),t._chain=!0,t},value:function(){return this._wrapped}})},oe.mixin(oe,!0),"function"==typeof define&&define.amd?define("Est",[],function(){return oe}):"function"==typeof define&&define.cmd&&define("Est",[],function(t,e,i){i.exports=oe})}).call(this),function(t,e){if("function"==typeof define&&define.amd)define(["Est","jquery","exports"],function(i,n,s){t.Backbone=e(t,s,i,n)});else if("undefined"!=typeof exports){var i=require("Est");e(t,exports,i,t.jQuery)}else t.Backbone=e(t,{},t.Est,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,i,n){var s=t.Backbone,o=[],r=(o.push,o.slice);o.splice;e.VERSION="1.1.2",e.$=n,e.noConflict=function(){return t.Backbone=s,this},e.result=function(t,e){if(null!=t){var n=t[e];return"function"===i.typeOf(n)?t[e]():n}},e.emulateHTTP=!0,e.emulateJSON=!0;var a=e.Events={on:function(t,e,i){if(!c(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);return n.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,n){if(!c(this,"once",t,[e,n])||!e)return this;var s=this,o=i.once(function(){s.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,n)},off:function(t,e,n){var s,o,r,a,l,h,u,d;if(!this._events||!c(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events=void 0,this;for(a=t?[t]:i.keys(this._events),l=0,h=a.length;h>l;l++)if(t=a[l],r=this._events[t]){if(this._events[t]=s=[],e||n)for(u=0,d=r.length;d>u;u++)o=r[u],(e&&e!==o.callback&&e!==o.callback._callback||n&&n!==o.context)&&s.push(o);s.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=r.call(arguments,1);if(!c(this,"trigger",t,e))return this;var i=this._events[t],n=this._events.all;return i&&h(i,e),n&&h(n,arguments),this},stopListening:function(t,e,n){var s=this._listeningTo;if(!s)return this;var o=!e&&!n;n||"object"!=typeof e||(n=this),t&&((s={})[t._listenId]=t);for(var r in s)t=s[r],t.off(e,n,this),(o||i.isEmpty(t._events))&&delete this._listeningTo[r];return this}},l=/\s+/,c=function(t,e,i,n){if(!i)return!0;if("object"==typeof i){for(var s in i)t[e].apply(t,[s,i[s]].concat(n));return!1}if(l.test(i)){for(var o=i.split(l),r=0,a=o.length;a>r;r++)t[e].apply(t,[o[r]].concat(n));return!1}return!0},h=function(t,e){var i,n=-1,s=t.length,o=e[0],r=e[1],a=e[2];switch(e.length){case 0:for(;++n<s;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=t[n]).callback.call(i.ctx,o);return;case 2:for(;++n<s;)(i=t[n]).callback.call(i.ctx,o,r);return;case 3:for(;++n<s;)(i=t[n]).callback.call(i.ctx,o,r,a);return;default:for(;++n<s;)(i=t[n]).callback.apply(i.ctx,e);return}},u={listenTo:"on",listenToOnce:"once"};i.each(u,function(t,e){a[e]=function(e,n,s){var o=this._listeningTo||(this._listeningTo={}),r=e._listenId||(e._listenId=i.nextUid("l"));return o[r]=e,s||"object"!=typeof n||(s=this),e[t](n,s,this),this}}),a.bind=a.on,a.unbind=a.off,i.extend(e,a);var d=e.Model=function(t,n){var s=t||{};n||(n={}),this.cid=i.nextUid("c"),this.attributes={},n.collection&&(this.collection=n.collection),n.parse&&(s=this.parse(s,n)||{}),s=i.defaults({},s,e.result(this,"defaults")),this.set(s,n),this.changed={},this.initialize.apply(this,arguments)};i.extend(d.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){var e=i.cloneDeep(this.attributes);return delete e.CONST,delete e._data,delete e._isAdd,"boolean"!==i.typeOf(t)&&(delete e.checked,delete e.checked_all,delete e.children),this.fields?Est.pick(e,this.fields):t&&t.fields?Est.pick(e,t.fields):e},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escapeHTML(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var s,o,r,a,l,c,h,u;if(null==t)return this;if("object"==typeof t?(o=t,n=e):(o={})[t]=e,n||(n={}),!this._validate(o,n))return!1;r=n.unset,l=n.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,h=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(s in o)e=o[s],i.equal(u[s],e)||a.push(s),i.equal(h[s],e)?delete this.changed[s]:this.changed[s]=e,r?delete u[s]:u[s]=e;if(!l){a.length&&(this._pending=n);for(var d=0,p=a.length;p>d;d++)this.trigger("change:"+a[d],this,u[a[d]],n)}if(c)return this;if(!l)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var e,n=!1,s=this._changing?this._previousAttributes:this.attributes;for(var o in t)i.equal(s[o],e=t[o])||((n||(n={}))[o]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},t.cache=!1,void 0===t.parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(n&&n(e,i,t),void e.trigger("sync",e,i,t)):!1},M(this,t),this.sync("read",this,t)},save:function(t,e,n){var s,o,r,a=this.attributes;if(null==t||"object"==typeof t?(s=t,n=e):(s={})[t]=e,n=i.extend({validate:!0},n),s&&!n.wait){if(!this.set(s,n))return!1}else if(!this._validate(s,n))return!1;s&&n.wait&&(this.attributes=i.extend({},a,s)),void 0===n.parse&&(n.parse=!0);var l=this,c=n.success;return n.success=function(t){l.attributes=a;var e=l.parse(t,n);return n.wait&&(e=i.extend(s||{},e)),"object"!==i.typeOf(e)||l.set(e,n)?(c&&c(l,t,n),void l.trigger("sync",l,t,n)):!1},M(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"===o&&(n.attrs=s),r=this.sync(o,this,n),s&&n.wait&&(this.attributes=a),r},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,s=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){return i&&!i.success?void(t.error&&t.error.call(this,i)):((t.wait||e.isNew())&&s(),n&&n(e,i,t),void(e.isNew()||e.trigger("sync",e,i,t)))},this.isNew())return t.success(),!1;M(this,t);var o=this.sync("delete",this,t);return t.wait||s(),o},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||V();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1):!0}});var p=["keys","values","invert","pick"];i.each(p,function(t){d.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.attributes),i[t].apply(i,e)}});var f=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};i.extend(f.prototype,a,{model:d,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,m))},remove:function(t,e){var n=!("array"===i.typeOf(t));t=n?[t]:i.clone(t),e||(e={});var s,o,r,a;for(s=0,o=t.length;o>s;s++)a=t[s]=this.get(t[s]),a&&(delete this._byId[a.id],delete this._byId[a.cid],r=this.indexOf(a),this.models.splice(r,1),this.length--,e.silent||(e.index=r,a.trigger("remove",a,this,e)),this._removeReference(a,e));return n?t[0]:t},set:function(t,e){e=i.defaults({},e,g),e.parse&&(t=this.parse(t,e));var n=!("array"===i.typeOf(t));t=n?t?[t]:[]:i.clone(t);var s,o,r,a,l,c,h,u=e.at,p=this.model,f=this.comparator&&null==u&&e.sort!==!1,m="string"===i.typeOf(this.comparator)?this.comparator:null,_=[],v=[],b={},y=e.add,E=e.merge,w=e.remove,x=!f&&y&&w?[]:!1;for(s=0,o=t.length;o>s;s++){if(l=t[s]||{},r=l instanceof d?a=l:l[p.prototype.idAttribute||"id"],c=this.get(r))w&&(b[c.cid]=!0),E&&(l=l===a?a.attributes:l,e.parse&&(l=c.parse(l,e)),c.set(l,e),f&&!h&&c.hasChanged(m)&&(h=!0)),t[s]=c;else if(y){if(a=t[s]=this._prepareModel(l,e),!a)continue;_.push(a),this._addReference(a,e)}a=c||a,!x||!a.isNew()&&b[a.id]||x.push(a),b[a.id]=!0}if(w){for(s=0,o=this.length;o>s;++s)b[(a=this.models[s]).cid]||v.push(a);v.length&&this.remove(v,e)}if(_.length||x&&x.length)if(f&&(h=!0),this.length+=_.length,null!=u)for(s=0,o=_.length;o>s;s++)this.models.splice(u+s,0,_[s]);else{x&&(this.models.length=0);var O=x||_;for(s=0,o=O.length;o>s;s++)this.models.push(O[s])}if(h&&this.sort({silent:!0}),!e.silent){for(s=0,o=_.length;o>s;s++)(a=_[s]).trigger("add",a,this,e);(h||x&&x.length)&&this.trigger("sort",this,e)}return n?t[0]:t},reset:function(t,e){e||(e={});for(var n=0,s=this.models.length;s>n;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){
return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return r.apply(this.models,arguments)},get:function(t){return null!=t?this._byId[t]||this._byId[t.id]||this._byId[t.cid]:void 0},at:function(t){return this.models[t]},where:function(t,e){return i.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),"string"===i.typeOf(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.proxy(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},t.cache=!1,void 0===t.parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){e&&e(n,i,t);var s=t.reset?"reset":"set";n[s](i,t),n.trigger("sync",n,i,t)},M(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?i.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,s=e.success;return e.success=function(t,i){e.wait&&n.add(t,e),s&&s(t,i,e)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof d)return t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_addReference:function(t,e){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,n),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var _=["forEach","each","map","collect","find","detect","filter","all","some","any","invoke","rest","tail","drop","indexOf","isEmpty","chain"];i.each(_,function(t){f.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.models),i[t].apply(i,e)}});var v=["sortBy"];i.each(v,function(t){f.prototype[t]=function(e,n){var s="function"===i.typeOf(e)?e:function(t){return t.get(e)};return i[t](this.models,s,n)}});var b=e.View=function(t){this.cid=i.nextUid("view"),t||(t={}),i.extend(this,i.pick(t,E)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},y=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];i.extend(b.prototype,a,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=e.result(this,"events")))return this;this.undelegateEvents();for(var n in t){var s=t[n];if("function"!==i.typeOf(s)&&(s=this[t[n]]),s){var o=n.match(y),r=o[1],a=o[2];s=i.proxy(s,this),r+=".delegateEvents"+this.cid,""===a?this.$el.on(r,s):this.$el.on(r,a,s)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var t=i.extend({},e.result(this,"attributes"));this.id&&(t.id=e.result(this,"id")),this.className&&(t["class"]=e.result(this,"className"));var n=e.$("<"+e.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,s){var o=x[t];i.defaults(s||(s={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var r={type:o,dataType:"json"};if(s.url||(r.url=e.result(n,"url"),!i.isEmpty(r.url))){if(null==s.data&&n&&("create"===t||"update"===t||"patch"===t)){r.contentType="application/json";var a=i.cloneDeep(n.toJSON(s));delete a.CONST,delete a._data,delete a._isAdd,delete a.checked,delete a.checked_all,delete a.children,delete a._options,r.data=JSON.stringify(s.attrs||a)}if(s.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),s.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){r.type="POST",s.emulateJSON&&(r.data._method=o);var l=s.beforeSend;s.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",o),l?l.apply(this,arguments):void 0}}"GET"===r.type||s.emulateJSON||(r.processData=!1),"PATCH"===r.type&&w&&(r.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=s.xhr=e.ajax(i.extend(r,s));return n.trigger("request",n,c,s),c}};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){function t(t){return app.addCache(s,t),new i.setArguments(arguments)}var n=null,s={};if(arguments[0].cacheData||arguments[0].session){if(s.data=arguments[0].data,s.url=arguments[0].url,s.cache=arguments[0].cacheData,s.session=arguments[0].session,n=app.getCache(s))return arguments[0].success.call(this,n),{done:function(t){t.call(this,n)}};arguments[0].success=i.inject(arguments[0].success,t,function(){})}return e.$.ajax.apply(e.$,arguments)};var O=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},I=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,S=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(O.prototype,a,{initialize:function(){},route:function(t,n,s){"regexp"!==i.typeOf(t)&&(t=this._routeToRegExp(t)),"function"===i.typeOf(n)&&(s=n,n=""),s||(s=this[n]);var o=this;return e.history.route(t,function(i){var r=o._extractParameters(t,i);o.execute(s,r),o.trigger.apply(o,["route:"+n].concat(r)),o.trigger("route",n,r),e.history.trigger("route",o,n,r)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var t,n=i.keys(this.routes);null!=(t=n.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(C,"\\$&").replace(I,"(?:$1)?").replace(k,function(t,e){return e?t:"([^/?]+)"}).replace(S,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var T=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},$=/^[#\/]|\s+$/g,N=/^\/+|\/+$/g,A=/msie [\w.]+/,F=/\/$/,D=/#.*$/;T.started=!1,i.extend(T.prototype,a,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(F,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace($,"")},start:function(t){if(T.started)throw new Error("Backbone.history has already been started");T.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),s=document.documentMode,o=A.exec(navigator.userAgent.toLowerCase())&&(!s||7>=s);if(this.root=("/"+this.root+"/").replace(N,"/"),o&&this._wantsHashChange){var r=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=r.hide().appendTo("body")[0].contentWindow,this.navigate(n)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace($,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),T.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!T.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(D,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new T;var B=function(t){return"object"===!i.typeOf(t)?t:(i.each(r.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),t)},L=function(t,e){var n,s=this;n=t&&i.has(t,"constructor")?t.constructor:function(){return s.apply(this,arguments)},B(n,s,e);var o=function(){this.constructor=n};return o.prototype=s.prototype,n.prototype=new o,t&&i.extend(n.prototype,t),n.__super__=s.prototype,n};d.extend=f.extend=O.extend=b.extend=T.extend=L;var V=function(){throw new Error('A "url" property or function must be specified')},M=function(t,e){var i=e.error;e.error=function(n){i&&i(t,n,e),t.trigger("error",t,n,e)}};return e}),Handlebars.registerHelper("compare",function(t,e,i,n){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");try{switch(e.toString()){case"==":return t==i?n.fn(this):n.inverse(this);case"!=":return t!=i?n.fn(this):n.inverse(this);case"===":return t===i?n.fn(this):n.inverse(this);case"!==":return t!==i?n.fn(this):n.inverse(this);case"<":return i>t?n.fn(this):n.inverse(this);case"<=":return i>=t?n.fn(this):n.inverse(this);case">":return t>i?n.fn(this):n.inverse(this);case">=":return t>=i?n.fn(this):n.inverse(this);case"&&":return t&&i?n.fn(this):n.inverse(this);case"||":return t||i?n.fn(this):n.inverse(this);case"indexOf":return t.indexOf(i)>-1?n.fn(this):n.inverse(this);default:return n.inverse(this)}}catch(s){console.log("Errow: hbs.compare v1="+t+";v2="+i+s)}}),Handlebars.registerHelper("pagination",function(t,e,i,n){var s="",n=n,i=i;3===arguments.length&&(n=i,i=9);for(var o=Est.getPaginationNumber(t,e,i),r=0,a=o.length;a>r;r++)s+=n.fn(o[r]);return s}),Handlebars.registerHelper("get",function(t,e){if("undefined"==typeof t||"string"!==Est.typeOf(t))return t;var i=t.split(".");return i[0]in this?i.length>1?("object"!==Est.typeOf(this[i[0]])&&(this[i[0]]=JSON.parse(this[i[0]])),Est.getValue(this,t)):this[i[0]]:void 0}),Handlebars.registerHelper("dateFormat",function(t,e,i){return Est.dateFormat(t,e)}),Handlebars.registerHelper("contains",function(t,e,i){return Est.isEmpty(t)?void 0:Est.contains(t,e)?i.fn(this):i.inverse(this)}),Handlebars.registerHelper("plus",function(t,e,i){return parseInt(t,10)+parseInt(e,10)}),Handlebars.registerHelper("minus",function(t,e,i){return parseInt(t,10)-parseInt(e,10)+""}),Handlebars.registerHelper("cutByte",function(t,e,i){return Est.cutByte(t,e,i.hash.end||"...")}),Handlebars.registerHelper("x",function(t,e){var i,n=function(){};try{n=Function.apply(this,["window","return "+t+";"])}catch(s){console.warn("[warning] {{x "+t+"}} is invalid javascript",s)}try{i=n.bind(this)(window)}catch(s){console.warn("[warning] {{x "+t+"}} runtime error",s)}return i}),Handlebars.registerHelper("xif",function(t,e){return Handlebars.helpers.x.apply(this,[t,e])?e.fn(this):e.inverse(this)}),Handlebars.registerHelper("parseInt",function(t,e){return parseInt(t,10)}),Handlebars.registerHelper("id2",function(t){return null==t?"":t.replace(/^[^1-9]+/,"")}),Handlebars.registerHelper("CONST",function(t,e){return Est.getValue(CONST,t)}),Handlebars.registerHelper("picUrl",function(t,e,i){var n=t;if(arguments.length<3)return t||CONST.PIC_NONE;if(null==t||0==t.length)return CONST.PIC_NONE;if(e>10)n=n+"!"+e;else{var s=n.substring(n.lastIndexOf(".")+1,n.length);n=n.substring(0,n.lastIndexOf("."))+"_"+e+"."+s}return n?n:""}),Handlebars.registerHelper("_picUrl",function(t,e,i){return CONST.PIC_URL+"/"+Handlebars.helpers.picUrl.apply(this,[t,e,i])}),Handlebars.registerHelper("PIC",function(t,e,i){var n="";return t&&(n+=t.indexOf("?")>-1?"&v="+Est.hash(CONST.APP_VERSION):"?v="+Est.hash(CONST.APP_VERSION),Est.startsWidth(t,"CONST")&&(t=Handlebars.helpers.CONST.apply(this,[t.replace("CONST.",""),i]))),t&&/[^\s]+\.(?:jpe?g|gif|png|bmp)/i.test(t)?(Est.startsWidth(t,"http")&&t.indexOf("upload")>-1&&(t=t.substring(t.indexOf("upload"),t.length)),Est.startsWidth(t,"upload")?arguments.length<3?CONST.PIC_URL+"/"+t+n:Handlebars.helpers._picUrl.apply(this,[t,e,i])+n:Est.startsWidth(t,"http")?t+n:CONST.DOMAIN+t+n):CONST.DOMAIN+CONST.PIC_NONE+n}),Handlebars.registerHelper("isEmpty",function(t,e){return Est.isEmpty(t)?e.fn(this):e.inverse(this)}),Handlebars.registerHelper("encodeUrl",function(t,e){return encodeURIComponent(t)}),Handlebars.registerHelper("json",function(t,e){return Handlebars.helpers.get.call(this,t)}),Handlebars.registerHelper("version",function(t,e){switch(t){case"time":return(new Date).getTime();case"hash":return Est.hash((new Date).getTime());default:return Est.hash((new Date).getTime())}}),Handlebars.registerHelper("stripScripts",function(t,e){return Est.stripScripts(t)}),Handlebars.registerHelper("replace",function(t,e,i,n){return t.replace(new RegExp(e,"img"),i)}),Handlebars.registerHelper("default",function(t,e,i){return Est.isEmpty(t)?e:t}),Handlebars.registerHelper("keyMap",function(t,e,i){return t&&e?e[t]:""});var BaseApp=function(t){this.options=t,Est.extend(this,t),this.initialize.apply(this,arguments)};Est.extend(BaseApp.prototype,{initialize:function(){this.data={itemActiveList:[],sessionId:""},this.instance={},this.modules={},this.routes={},this.templates={},this.panels={},this.dialog=[],this.dialogs={},this.status={},this.cookies=[],this.models=[],this.compileTemps={},this.filters={navigator:[],form:[]},this.cache={}},getAppType:function(){return"backbone"},addRegion:function(t,e,i){var n=Est.nextUid("region");return i.__panelId||(i.__panelId=i.el),i.diff&&app.getView(i.viewId||t)?(app.getView(i.viewId||t)._extend(i),void app.getView(i.viewId||t)._reset(i.data)):(this.addPanel(t,{el:i.__panelId,template:'<div class="region '+n+'"></div>'},i),i.viewId||(i.viewId=t),i.viewId in this.instance&&this.removeView(i.viewId),this.addView(i.viewId,new e(i)))},addPanel:function(t,e,i){var n="string"===Est.typeOf(e.cid)?!1:!0;return i=i||{},n&&(this.removePanel(t,e),e.$template=$(e.template),i&&(i.el=e.$template),e.$template.addClass("__panel_"+t),e.$template.attr("data-view",i.viewId||t),i&&"boolean"===Est.typeOf(i.append)&&!i.append&&$(e.el).empty(),$(e.el).append(e.$template)),this.panels[t]=e,n?this:e},removePanel:function(t,e){try{var i=[];e||(e=this.panels[t]),"body"!==e.el&&($(".region",$(e.el)).each(function(){i.push($(this).attr("data-view"))}),i.reverse(),Est.each(i,function(t){app.getView(t)&&app.getView(t).destroy&&app.getView(t).destroy(),app.removeView(t)})),$(".__panel_"+t,$(e.el)).off().remove(),delete this.panels[t]}catch(n){console.error(n)}},addView:function(t,e){return t in this.instance&&this.removeView(t),this.instance[t]=e,this.setCurrentView(t),this.instance[t]},removeView:function(t){try{this.getView(t)&&(this.getView(t).destroy&&this.getView(t).destroy(),this.getView(t)._empty(),this.getView(t).stopListening(),this.getView(t).$el.off().remove()),delete this.instance[t]}catch(e){console.log(e)}return this},panel:function(t,e){return this.addPanel(t,e)},show:function(t){this.addView(this.currentView,t)},getPanel:function(t){return this.panels[t]},add:function(t,e){return this.addView(t,e)},setCurrentView:function(t){this.currentView=t},getCurrentView:function(){return this.currentView},getView:function(t){return this.instance[t]},addDialog:function(t,e){return this.dialog.push(t),e&&(app.addData("_curDialog",e),this.dialogs[e]=t),t},getDialogs:function(){return this.dialog},getDialog:function(t){return Est.isEmpty(t)?this.dialogs:this.dialogs[t]},getCurrentDialog:function(){return app.getData("_curDialog")?this.dialogs[app.getData("_curDialog")]:null},emptyDialog:function(){Est.each(this.dialog,function(t){t&&t.close&&t.close().remove()}),this.dialog=[],this.dialogs={},app.addData("_curDialog",null)},addModel:function(t){return this.models.push(t),t},getModels:function(){return this.models},addData:function(t,e){t in this.data&&debug("reset data "+t),this.data[t]=e},getData:function(t){return this.data[t]},addModule:function(t,e){t in this.modules&&debug("Error10 module="+t),this.modules[t]=e},getModules:function(){return this.modules},addRoute:function(t,e){t in this.routes&&debug("Error13 "+t),this.routes[t]=e},getRoutes:function(){return this.routes},addTemplate:function(t,e){t in this.templates&&debug("Error11 template name:"+t),this.templates[t]=e},getTemplates:function(){return this.templates},addSession:function(t,e,i){try{var n="undefined"===Est.typeOf(i)?"":i?this.data.sessionId:"";localStorage["___JHW_BACKBONE__"+Est.hash(n+t)]=e}catch(s){debug("Error9 "+s)}return e},getSession:function(t,e){var i="undefined"===Est.typeOf(e)?"":e?this.data.sessionId:"";return localStorage["___JHW_BACKBONE__"+Est.hash(i+t)]},addCompileTemp:function(t,e){this.compileTemps[t]=e},getCompileTemp:function(t){return this.compileTemps[t]},addStatus:function(t,e){this.status[t]=e},getStatus:function(t){return this.status[t]},getAllStatus:function(){return this.status},addOption:function(t,e){this.options[t]=e},getOption:function(t){return Est.cloneDeep(this.options[t])},addFilter:function(t,e){this.filters[t].push(e)},getFilters:function(t){return this.filters[t]},getParamsHash:function(t){var e="",i="";for(var n in t)e+=t[n];return i="_hash"+Est.hash(e)},addCache:function(t,e){try{var i="";if(!e.success)return;i=this.getParamsHash(t),t.session&&e?app.addSession(i,JSON.stringify(e)):this.cache[i]=e}catch(n){debug("Error12"+n)}},getCache:function(t){var e=null,i=this.getParamsHash(t);return!t.session||app.getData("versionUpdated")?this.cache[i]:(e=app.getSession(i))?JSON.parse(e):void 0},removeCache:function(t){var e=null;return t?(e=this.getParamsHash(t),void delete this.cache[e]):void(this.cache={})},addCookie:function(t){-1===Est.findIndex(this.cookies,t)&&this.cookies.push(t)},getCookies:function(){return this.cookies}});var BaseUtils={dialog:function(t){var e=t.button||[];seajs.use(["dialog-plus"],function(i){t.success&&e.push({value:CONST.LANG.CONFIRM,autofocus:!0,callback:function(){t.success.apply(this,arguments)}}),t.hideCloseBtn||e.push({value:CONST.LANG.CLOSE,callback:function(){this.close().remove()}}),t=Est.extend({id:t.id||t.moduleId||Est.nextUid("dialog"),title:CONST.LANG.DIALOG_TIP,width:150,content:"",button:e},t),t.target&&(t.target=$(t.target).get(0)),t.oniframeload=function(){try{this.iframeNode.contentWindow.topDialog=thisDialog,this.iframeNode.contentWindow.app=app,delete app.getRoutes().index}catch(e){}"function"==typeof t.load&&t.load.call(this,arguments)},t.cover?app.addDialog(i(t),t.viewId||t.id).showModal(t.target):app.addDialog(i(t),t.viewId||t.id).show(t.target)})},tip:function(t,e){e=Est.extend({id:"tip-dialog"+Est.nextUid(),time:3e3,content:'<div style="padding: 10px;">'+t+"</div>",title:null},e),seajs.use(["dialog-plus"],function(t){window.tipsDialog&&window.tipsDialog.close().remove(),window.tipsDialog=app.addDialog(t(e)).show(e.target),setTimeout(function(){window.tipsDialog.close().remove()},e.time)})},confirm:function(t,e){var i={title:CONST.LANG.WARM_TIP,content:CONST.LANG.DEL_CONFIRM,success:function(){},target:null};Est.extend(i,t),e||(e=this),seajs.use(["dialog-plus"],function(n){window.comfirmDialog=app.addDialog(n({id:"dialog"+Est.nextUid(),title:i.title,content:'<div style="padding: 20px;">'+i.content+"</div>",width:i.width||200,button:[{value:t.successValue||CONST.LANG.CONFIRM,autofocus:!0,callback:function(){i.success&&i.success.call(e)}},{value:t.cancelValue||CONST.LANG.CANCEL,callback:function(){window.comfirmDialog.close().remove(),i.cancel&&i.cancel.call(e)}}],onClose:function(){i.cancel&&i.cancel.call(e)}})).show(i.target)})},addLoading:function(t){try{window.$loading&&window.$loading.remove(),window.$loading=$('<div id="loading" class="loading"><div class="object" id="object_one"></div><div class="object" id="object_two"></div><div class="object" id="object_three"></div></div>'),$("body").append(window.$loading)}catch(e){debug("Error28"+e)}return window.$loading},removeLoading:function(t){window.$loading?window.$loading.remove():$(".loading").remove()},execute:function(t){return debug("- BaseUtils.execute "+t),BaseUtils[t]&&BaseUtils[t].apply(BaseUtils,[].slice.call(arguments,1))}},BaseService=function(){return"object"==typeof BaseService.instance?BaseService.instance:(debug("build BaseService instance"),void(BaseService.instance=this))};BaseService.prototype={ajax:function(t){var e=Est.extend({_method:"GET"},t);return $.ajax({type:"post",url:t.url,async:!1,cache:t.cache,data:e,success:function(t){}})},initTree:function(t,e){t.tree&&(e.attributes.data=Est.bulidTreeNode(e.attributes.data,t.rootKey,t.rootValue,{categoryId:t.categoryId,belongId:t.belongId,childTag:t.childTag,sortBy:t.sortBy,callback:function(e){t.tree&&(e.text=e[t.text],e.value=e[t.value])}}))},initSelect:function(t,e){t.select&&(Est.each(e.attributes.data,function(e){e.text=e[t.text],e.value=e[t.value]}),t.tree&&(e.attributes.data=Est.bulidSelectNode(e.attributes.data,1,{name:"text"})))},initExtend:function(t,e){t.extend&&(e.attributes.data=Est.extendTree(e.attributes.data))},initDefault:function(t,e){e.attributes&&t.defaults&&"array"===Est.typeOf(e.attributes.data)&&e.attributes.data.unshift({text:CONST.LANG.SELECT_DEFAULT,value:t.defaultValue})},factory:function(t){var e=this,i=Est.promise,n="",s="",o=null;t=Est.extend({select:!1,extend:!1,defaults:!1,tree:!1,defaultValue:null,cache:!1},t);for(var r in t)n+=t[r];return s="_hash"+Est.hash(n),new i(t.session&&!app.getData("versionUpdated")&&(o=app.getSession(s))?function(t,e){t(JSON.parse(o))}:function(i,n){CONST.DEBUG_LOCALSERVICE?i([]):e.ajax(t).done(function(n){var o=null;return"string"===Est.typeOf(n)?(t.session&&n.attributes&&app.addSession(s,n),void i(n)):(n.attributes?(e.initTree(t,n),e.initSelect(t,n),e.initExtend(t,n)):(n.attributes=n.attributes||{},n.attributes.data=[]),e.initDefault(t,n),o=n.attributes?n.attributes.data:n,t.session&&n.attributes&&app.addSession(s,JSON.stringify(o)),void i(o))})})},query:function(t){var e=this,i=Est.promise,n="",s="",o=null;t=Est.extend({cache:!1},t);for(var r in t)n+=t[r];return s="_hash"+Est.hash(n),new i(t.session&&!app.getData("versionUpdated")&&(o=app.getSession(s))?function(t,e){t(JSON.parse(o))}:function(i,n){CONST.DEBUG_LOCALSERVICE?i([]):e.ajax(t).done(function(e){e.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),t.session&&e&&app.addSession(s,JSON.stringify(e)),i(e)})})}};var SuperView=Backbone.View.extend({constructor:function(t){this.options=t||{},this.init&&"function"!==Est.typeOf(this.init)&&this._initialize(this.init),Backbone.View.apply(this,arguments)},initialize:function(){this._initialize()},_super:function(){return this},_extend:function(t){Est.extend(this.options,t)},_navigate:function(t,e){e=e||!0,Backbone.history.navigate(t,e)},_dialog:function(t,e){var i=e||this,n=t.viewId?t.viewId:"string"===Est.typeOf(t.id)?t.id:t.moduleId;"function"===Est.typeOf(n)&&(n=Est.nextUid("dialog_view")),t=Est.extend({width:"auto",title:null,cover:!1,autofocus:!1,hideOkBtn:!0,hideCloseBtn:!0,button:[],quickClose:t.cover?!1:"boolean"===Est.typeOf(t.autofocus)?t.quickClose:!1,skin:"dialog_min"},t),t=Est.extend(t,{el:"#base_item_dialog"+n,content:t.content||'<div id="'+n+'"></div>',viewId:n,onshow:function(){try{var e=t.onShow&&t.onShow.call(this,t);if("undefined"!=typeof e&&!e)return;"function"===Est.typeOf(t.moduleId)?(t.id=t.id||t.viewId,app.addPanel(t.id,{el:"#"+t.id,template:'<div id="base_item_dialog'+t.id+'" class="region '+t.id+'"></div>'}).addView(t.id,new t.moduleId(t))):"string"===Est.typeOf(t.moduleId)&&seajs.use([t.moduleId],function(e){try{e||console.error(t.moduleId+" is not defined"),app.addPanel(t.viewId,{el:"#"+t.viewId,template:'<div id="base_item_dialog'+t.viewId+'" class="region"></div>'}).addView(t.viewId,new e(t))}catch(i){console.error(i)}})}catch(i){console.log(i)}},onclose:function(){app.getPanel(t.viewId)&&app.removePanel(t.viewId),t.onClose&&t.onClose.call(i,t),app.getDialogs().pop()}}),BaseUtils.dialog(t)},_singleBind:function(t,e,i,n){var s=this;$(e,t||this.$el).each(function(){var t=[],e=$(this).attr("bb-model"),i=$(this).attr("data-bind-type")||"change";Est.isEmpty(e)||(t=e.split(":"),i=t.length>1?t[1]:"change"),$(this).off(i).on(i,function(t){var e,i,o,r,a;if(37===t.keyCode||39===t.keyCode||38===t.keyCode||40===t.keyCode)return!1;if(o=$(this).attr("id"),a=$(this).attr("bb-model"),Est.isEmpty(a)||(a=a.split(":")[0]),a||o&&-1!==o.indexOf("model")){switch(this.type){case"radio":e=$(this).is(":checked")?$(this).val():i=!0;break;case"checkbox":e=$(this).is(":checked")?Est.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):Est.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:e=$(this).val()}i||(r=a||o.replace(/^model\d?-(.+)$/g,"$1"),s._setValue(r,e),n&&n.call(s,r),s.update&&s.update.call(s,r))}})})},_modelBind:function(t,e,i){var n=this;e?this._singleBind(t,e,this.model,i):this.$("input, textarea, select").each(function(){n._singleBind(null,$(this),n.model,i)})},_viewReplace:function(t,e,i,n){try{Est.each(t.split(","),Est.proxy(function(t){var i=[],n="",s="",o=[],r="",a="";if(!Est.isEmpty(t))if(t.indexOf("]:")>-1?(o=t.split("]:"),i=Est.map(o,function(t,e){return e!==o.length-1?t+"]":t})):i=t.split(":"),s=Est.hash(t),i.length>1)for(var l=1;l<i.length;l++){if(s=Est.hash(i[0]+i[l]),a=i[l],Est.msie()?(r="ng-"+a,this["h_temp_"+s]||(n=this._options.template.replace(new RegExp("\\s"+i[l]+"=","img")," ng-"+i[l]+"="))):(r=a,n=this.$template),!this["h_temp_"+s])switch(a){case"html":this["h_temp_"+s]=Handlebars.compile($(n).find(i[0]).html());break;case"checked":this["h_temp_"+s]=Handlebars.compile("checked:{{#if "+/bb-checked=\"(.*?)\"\s?/gim.exec(i[0])[1]+"}}true{{else}}false{{/if}}");break;default:this["h_temp_"+s]=Handlebars.compile($(n).find(i[0]).attr(r))}if(_result=this["h_temp_"+s](e.attributes),this["h_temp_r_"+s]===_result)return void console.log("[ignore]"+i[0]+":"+a+" & result=>"+_result);switch(console.log("[replace]"+i[0]+":"+a+" & result=>"+_result),a){case"value":this.$(i[0]).val(_result);break;case"html":this.$(i[0]).html(_result);break;case"checked":this.$(i[0]).prop("checked",this._getValue(/bb-checked=\"(.*?)\"\s?/gim.exec(i[0])[1]));break;default:this.$(i[0]).attr(i[l],_result)}this["h_temp_r_"+s]=_result}else{if(Est.msie()?(a="ng-style",this["h_temp_"+s]||(n=this.$template.replace(new RegExp("\\sstyle=","img")," "+a+"=")),this["h_temp_"+s]=this["h_temp_"+s]||Handlebars.compile($(n).find(t).wrapAll("<div>").parent().html().replace(/ng-style/gim,"style"))):this["h_temp_"+s]=this["h_temp_"+s]||Handlebars.compile($(this.$template).find(t).wrapAll("<div>").parent().html()),_result=this["h_temp_"+s](e.attributes),this["h_temp_r_"+s]===_result)return;this.$(t).replaceWith(_result),this["h_temp_r_"+s]=_result}},this)),i&&Est.each(i,function(t){t.call(this,n)},this)}catch(s){console.log(s)}},_watch:function(t,e,i){var n,s=this,o=null,r={},a=[];"array"===Est.typeOf(t)?a=t:a.push(t),this.cbMap=this.cbMap||{},this.watchFields=this.watchFields||{},Est.each(a,function(t){var a=t.replace(/^#?model\d?-(.+)$/g,"$1");i&&(this.cbMap[a]=this.cbMap[a]||[],"string"===Est.typeOf(i)?(o=Est.hash(a+i),o in this.cbMap||(this.cbMap[o]=!0,this.cbMap[a].push(this[i]))):this.cbMap[a].push(i)),a in this.watchFields?Est.each(e.split(","),function(t){-1===this.watchFields[a].indexOf(t)&&(this.watchFields[a]=this.watchFields[a]+","+t)},this):this.watchFields[a]=e,e=this.watchFields[a],n=s.cid+a,n in r||(Est.off(r[n]=n).on(n,function(t,i){s._viewReplace(e,s.model,s.cbMap[a],a),s.update&&s.update.call(s,a)}),s.model.off("change:"+(r[a]=a.split(".")[0])).on("change:"+r[a],function(){s._viewReplace(e,s.model,s.cbMap[a],a),s.update&&s.update.call(s,a)}))},this)},_watchBind:function(t){var e=[],i=[];this.cbMap={},this.watchFields={},"string"===Est.typeOf(t)&&(i=t.match(new RegExp('(bb-watch=\\"(.+?)"(\\s*)|bb-change=\\"(.+?)"(\\s*)|bb-model=\\"(.+?)"(\\s*))(bb-action=\\"(.+?)\\"\\s*)?(bb-change=\\"(.+?)\\"\\s*)?',"img")),Est.each(i,this._bind(function(t){var i="",n="",s="",o="";i=/bb-watch=\"(.*?)\"\s?/gim.exec(t)||"",o=/bb-action=\"(.*?)\"\s?/gim.exec(t)||"",s=/bb-change=\"(.*?)\"\s?/gim.exec(t)||"",n=/bb-model=\"(.*?)\"\s?/gim.exec(t)||"",Est.isEmpty(i)&&Est.isEmpty(n)||e.push({watch:i.length>1?i[1]:n[1].split(":")[0],action:o.length>1?o[1]:"",change:s.length>1?s[1]:null})}))),Est.each(e,this._bind(function(t){this._watch(t.watch.split(","),t.action,Est.isEmpty(t.change)?null:t.change)})),this.onWatch&&this.onWatch.call(this,arguments)},_bbBind:function(t,e){var i,n,s,o={};if(this.bbList=[],"string"===Est.typeOf(t)){for(i=new RegExp('\\bbb-([\\w\\.]+)=\\"([\\w\\.:]+?)\\"\\s?',"img");null!==(s=i.exec(t));)this.bbList.push({name:s[1],value:s[2]});Est.each(this.bbList,this._bind(function(t){if(n=Est.hash(t.name+t.value),!(n in o))switch(o[n]=t,t.name){case"watch":break;case"action":break;case"change":break;case"show":console.log("name:"+t.name+";value:"+t.value);break;case"model":this._modelBind(e,'[bb-model="'+t.value+'"]'),this._watch([t.value.split(":")[0]],'[bb-model="'+t.value+'"]:value');break;case"checked":this._watch([t.value],'[bb-checked="'+t.value+'"]:checked'),this.$('[bb-checked="'+t.value+'"]').prop("checked",this._getValue(t.value));break;default:this[t.value]&&e.find("[bb-"+t.name+'="'+t.value+'"]').off(t.name).on(t.name,this._bind(this[t.value]))}}))}},_stringifyJSON:function(t){var e,i;JSON.stringify||alert(CONST.LANG.JSON_TIP),Est.each(t,function(t){e=t.split("."),e.length>1?(i=Est.getValue(this.model.attributes,t),Est.setValue(this.model.attributes,t,JSON.stringify(i))):Est.setValue(this.model.attributes,t,JSON.stringify(this.model.get(t)))},this)},_parseJSON:function(t){var e,i,n=JSON.parse||$.parseJSON;n||alert(CONST.LANG.JSON_TIP),Est.each(t,function(t){e=t.split("."),e.length>1?(i=Est.getValue(this.model.attributes,t),"string"===Est.typeOf(i)&&Est.setValue(this.model.attributes,t,n(i))):"string"===Est.typeOf(this.model.get(t))&&this.model.set(t,n(this.model.get(t)));
},this)},_setOption:function(t){return Est.extend(this._options,t),this},_initEnterEvent:function(t){t.speed>1&&t.enterRender&&this.$("input").keyup($.proxy(function(e){e.keyCode===CONST.ENTER_KEY&&this.$(t.enterRender).click()},this))},_getOption:function(t){return this._options[t]},_getValue:function(t){return Est.getValue(this.model.attributes,t)},_get:function(t){return this._getValue.call(this,t)},_getDefault:function(t,e){return this._setDefault(t,e),Est.getValue(this.model.attributes,t)},_setDefault:function(t,e){var i=Est.getValue(this.model.attributes,t);("undefined"===Est.typeOf(i)||"null"===Est.typeOf(i))&&Est.setValue(this.model.attributes,t,e)},_initDefault:function(){this.init&&"function"===Est.typeOf(this.init)&&(this.__def_vals_=this.init.call(this)||{},Est.each(this.__def_vals_,this._bind(function(t,e){this._setDefault(e,t)})))},_reset:function(t){var e=[],i={};for(this.model.attributes={},t=Est.extend(Est.extend(this.model.defaults||{},this.__def_vals_),t),i=t;Est.keys(i).length>0;)t=i,Est.each(t,function(t,n){"object"===Est.typeOf(t)?Est.each(t,function(t,e){i[n+"."+e]=t}):e.push({path:n,value:t}),delete i[n]});Est.each(e,this._bind(function(t){this._set(t.path,t.value)}))},_setValue:function(t,e){Est.equal(Est.getValue(this.model.attributes,t),e)||(Est.setValue(this.model.attributes,t,e),Est.trigger(this.cid+t,t),this._m_change_=!0)},_set:function(t,e){this._m_change_=!1,"object"===Est.typeOf(t)?this._baseSetValues(t):this._setValue(t,e),this._m_change_&&this.options.onChange&&this.options.onChange.call(this,this.model.toJSON())},_baseSetValues:function(t){Est.each(t,this._bind(function(t,e){this._setValue(e,t)}))},_setValues:function(t){this._baseSetValues(t),this._options.onChange&&this._options.onChange.call(this,t)},_setAttr:function(t,e){"string"===Est.typeOf(t)?Est.setValue(this.model.attributes,t,e):Est.each(t,this._bind(function(t,e){Est.setValue(this.model.attributes,e,t)})),this._options.onChange&&this._options.onChange.call(this,t)},_getLength:function(){return this.collection.models.length},_getTarget:function(t){return t.target?$(t.target):$(t.currentTarget)},_getEventTarget:function(t){return t.currentTarget?$(t.currentTarget):$(t.target)},_one:function(t,e){try{var i,n="array"===Est.typeOf(t),s=[],o=null;i=n?t.join("_"):t,o="_one_"+i,this[o]="undefined"===Est.typeOf(this[o])?!0:!1,this[o]&&(n?(Est.each(t,function(t){s.push(t.replace(/^(.+)-(\d+)?$/g,"$1"))}),this._require(s,e)):e&&e.call(this))}catch(r){debug("SuperView._one "+JSON.stringify(t)+r,{type:"error"})}},_require:function(t,e){seajs.use(t,Est.proxy(e,this))},_delay:function(t,e){setTimeout(Est.proxy(function(){setTimeout(Est.proxy(function(){t&&t.call(this)},this),e)},this),0)},_bind:function(t){return Est.proxy(t,this)},_initToolTip:function(t,e){var i=e||".tool-tip",n=t?$(i,t):this.$(i);n.hover(function(t){var e=$(this).attr("data-title")||$(this).attr("title"),i=$(this).attr("data-offset")||0;Est.isEmpty(e)||(BaseUtils.dialog({id:Est.hash(e||"error:446"),title:null,width:"auto",offset:parseInt(i,10),skin:"tool-tip-dialog",align:$(this).attr("data-align")||"top",content:'<div style="padding: 5px 6px;;font-size: 12px;">'+e+"</div>",hideCloseBtn:!0,autofocus:!1,target:$(this).get(0)}),app.getData("toolTipList")||app.addData("toolTipList",[]),app.getData("toolTipList").push(Est.hash(e)),$(window).one("click",Est.proxy(function(){Est.each(app.getData("toolTipList"),function(t){app.getDialog(t)&&app.getDialog(t).close()}),app.addData("toolTipList",[])},this)))},function(){try{app.getDialog(Est.hash($(this).attr("data-title")||$(this).attr("title"))).close()}catch(t){}})},_empty:function(){},render:function(){this._render()}}),BaseView=SuperView.extend({_initialize:function(t){return this._initOptions(t),this._initTemplate(this._options.template),this._initModel(this._options.data,Backbone.Model.extend({fields:this._options.fields})),this._initBind(this._options),this.render(),this},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.data=this._options.data||{}},_initTemplate:function(t){t&&(this.template=Handlebars.compile(t),this.$template="<div>"+t+"</div>")},_initModel:function(t,e){t&&(t.CONST=CONST),this.model=new e(t)},_initBind:function(t){this.model.bind("reset",this.render,this)},_render:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this._options),this._options.append?this.$el.append(this.template(this.model.attributes)):this.$el.html(this.template(this.model.attributes)),this._options.modelBind&&this._modelBind(),this.afterRender&&this.afterRender.call(this,this._options),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el),this._options.toolTip&&this._initToolTip(),this._initEnterEvent(this._options),BaseUtils.removeLoading()},render:function(){this._render()}}),BaseList=SuperView.extend({_initialize:function(t){return debug("1.BaseList._initialize"),this.dx=0,this.views=[],this._initOpt(t.collection,t)},_initOpt:function(t,e){return this._initOptions(e),this._initDataModel(Backbone.Model.extend({})),this._initTemplate(this._options),this._initEnterEvent(this._options,this),this._initList(this._options),this._initCollection(this._options,t),this._initItemView(this._options.item,this),this._initModel(this._options.model),this._initBind(this.collection),this._initPagination(this._options),this._load(this._options),this},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.sortField="sort",this._options.max=this._options.max||99999,this._options.speed=this._options.speed||9},_initDataModel:function(t){this._options.data&&(this._options.data.CONST=CONST),this.model=new t(this._options.data)},_getTemp:function(){},_getIeTemp:function(){},_initTemplate:function(t){return this._data=t.data=t.data||{},t.template&&(this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this),this.$template=$("<div>"+t.template+"</div>"),this._options.render?(Est.msie()?(this.__template=t.template.replace(new RegExp("\\sstyle=","img")," ng-style="),this._options.itemTemp=$("<div>"+this.__template+"</div>").find(this._options.render).html(),Est.isEmpty(this._options.itemTemp)||(this._options.itemTemp=this._options.itemTemp.replace(/ng-style/gim,"style"))):this._options.itemTemp=this.$template.find(this._options.render).html(),this.$template.find(this._options.render).empty()):(Est.msie()?(this.__template=t.template.replace(new RegExp("\\sstyle=","img")," ng-style="),this._options.itemTemp=$("<div>"+this.__template+"</div>").html(),Est.isEmpty(this._options.itemTemp)||(this._options.itemTemp=this._options.itemTemp.replace(/ng-style/gim,"style"))):this._options.itemTemp=this.$template.html(),this.$template.empty()),this.template=Handlebars.compile(Est.isEmpty(this._options.itemTemp)?t.template:this.$template.html()),this._options.append?(this.$el.empty(),this.$el.append(this.template(this.model.attributes))):this.$el.html(this.template(this.model.attributes))),this._options.modelBind&&this._modelBind(),this._data},_initEnterEvent:function(t,e){t.enterRender&&e.$("input").keyup(function(i){i.keyCode===CONST.ENTER_KEY&&e.$(t.enterRender).click()})},_initList:function(t){var e=this;return this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render)),debug(function(){return e.list&&0!==e.list.size()?void 0:"Error1"},{type:"error"}),this.list},_initCollection:function(t,e){return debug(function(){return t.model?void 0:"Error2"},{type:"error"}),(!this.collection||this.collection&&!this.collection.remove)&&(this.collection=new e(t)),t.itemId&&this.collection._setItemId(t.itemId),t.subRender&&(this.composite=!0),this.collection},_initItemView:function(t){this.item=t},_initModel:function(t){this.initModel=t},_initBind:function(t){t&&(t.bind("add",this._addOne,this),t.bind("reset",this._render,this))},_initPagination:function(t){var e=this;e.collection&&e.collection.paginationModel&&e.collection.paginationModel.on("reloadList",function(i){e._setValue("checked_all",!1),e._clear.call(e),e._load.call(e,t,i)})},_load:function(t,e){var i=this;t=t||this._options||{},this._beforeLoad(t),(t.page||t.pageSize)&&(t.page&&i.collection.paginationModel.set("page",t.page||1),t._page=t.page,t.pageSize&&i.collection.paginationModel.set("pageSize",t.pageSize||16),t._pageSize=t.pageSize,e=i.collection.paginationModel,t.page=t.pageSize=null),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el),this._options.items&&(this._empty(),this._initItems()),this._options.viewId&&i.collection.paginationModel&&i.collection.paginationModel.get("pageSize")<999&&(app.addCookie(this._options.viewId+"_page"),Est.cookie(this._options.viewId+"_page",i.collection.paginationModel.get("page")),app.addCookie(this._options.viewId+"_pageSize"),Est.cookie(this._options.viewId+"_pageSize",i.collection.paginationModel.get("pageSize"))),i.collection.url&&!this._options.items?(i._options.filter&&(i.filter=!0),i._options.subRender&&(i.composite=!0,i.collection.paginationModel.set("page",1),i.collection.paginationModel.set("pageSize",9e3)),debug(function(){return"[Query]"+("function"===Est.typeOf(i.collection.url)?i.collection.url():i.collection.url)}),i.collection._load(i.collection,i,e).done(function(e){e&&e.msg&&e.msg===CONST.LANG.AUTH_FAILED&&BaseUtils.tip(CONST.LANG.AUTH_LIMIT+"！",{time:2e3}),i.list.find(".no-result").remove();try{(Est.isEmpty(e)||Est.isEmpty(e.attributes)||0===e.attributes.data.length)&&(i._options.append?i.list.append('<div class="no-result">'+CONST.LANG.LOAD_ALL+"</div>"):i.list.append('<div class="no-result">'+CONST.LANG.NO_RESULT+"</div>"),1===i.collection.paginationModel.get("page")&&Est.trigger("resultListNone"+i._options.viewId,{}),e.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),debug(function(){return"Warm3 list.length=0"+("function"===Est.typeOf(i.collection.url)?i.collection.url():i.collection.url)}))}catch(n){Est.trigger("checkLogin"),debug("Error4 "+e.msg)}i._afterLoad(t),i._options.subRender&&i._filterRoot(),i._options.filter&&i._filterCollection(),e.attributes&&e.attributes.model&&(i._options.data=Est.extend(i._options.data,e.attributes.model)),i._finally()})):(i._afterLoad(t),i._finally())},_reload:function(t){debug("BaseList_reload"),this._empty.call(this),this.collection.reset(),this.list.empty(),this._load(t)},_finally:function(){this.afterRender&&this.afterRender.call(this,this._options),this._options.toolTip&&this._initToolTip(),BaseUtils.removeLoading()},_beforeLoad:function(t){this.beforeLoad&&this.beforeLoad.call(this,this.collection)},_afterLoad:function(t){this.afterLoad&&this.afterLoad.call(this,this.collection)},_initItems:function(){"function"===Est.typeOf(this._options.items)&&(this._options.items=this._options.items.apply(this,arguments)),this._options.filter&&(this.collection.push(this._options.items),this._filterCollection(),this._options.items=Est.pluck(Est.cloneDeep(this.collection.models,function(){},this),"attributes")),this._options._page||this._options._pageSize?this._renderListByPagination():this.filter||(Est.each(this._options.items,function(t){return this._check()?!1:void this.collection.push(new this.initModel(t))},this),this._options.subRender&&this._filterRoot())},_setTemplate:function(t){this.compileTemp=t},_getTemplate:function(){return this.compileTemp},_stop:function(){this.stopIterator=!0},_check:function(){return this.stopIterator?(this.stopIterator=!1,!0):!1},_render:function(){debug("BaseList._render"),this._addAll(),this.trigger("after",this)},_filterRoot:function(){var t=this,e=[],i=[];t.composite=!1,Est.each(t.collection.models,function(i){debug(function(){return"undefined"===Est.typeOf(i.attributes[t._options.categoryId])?"Error5 currentId = "+t._options.categoryId+";url="+t.collection.url:"undefined"===Est.typeOf(i.attributes[t._options.parentId])?"Error6 currentId="+t._options.parentId+";url="+t.collection.url:void 0},{type:"error"}),e.push({categoryId:i.attributes[t._options.categoryId],belongId:i.attributes[t._options.parentId]})}),this.collection.each(function(n){for(var s=e.length,o=[];s>0;){var r=e[s-1];r.belongId===n.get(t._options.categoryId)&&(o.unshift(r.categoryId),e.splice(s-1,1)),s--}n.set("children",o),n.set("id",n.get(t._options.categoryId)),"array"===Est.typeOf(t._options.rootValue)?Est.each(t._options.rootValue,Est.proxy(function(e){"function"===Est.typeOf(e)?e.call(this,e)&&(n.set("level",1),i.push(n)):!Est.isEmpty(e)&&n.get(t._options.rootId)&&n.get(t._options.rootId).indexOf(e)>-1?(n.set("level",1),i.push(n)):n.get(t._options.rootId)===e&&(n.set("level",1),i.push(n))},this)):n.get(t._options.rootId)===t._options.rootValue&&(n.set("level",1),i.push(n))}),Est.each(i,function(e){t._addOne(e)})},_addOne:function(t,e,i){var n=this;if(!this.filter&&!this.composite&&this.dx<this._options.max){switch(t.set({dx:this.dx++}),this._options.speed){case 1:t.set("_options",{});break;case 9:t.set("_options",{_speed:this._options.speed,_item:n._options.item,_items:n._options.items?!0:!1,_model:n._options.model,_collection:Est.isEmpty(n._options.subRender)?null:n.collection,_subRender:n._options.subRender,_collapse:n._options.collapse,_extend:n._options.extend,_checkAppend:n._options.checkAppend,_checkToggle:n._options.checkToggle,_data:n.options.data||n._options.data})}var s=new this.item({model:t,viewId:this._options.viewId,speed:this._options.speed,data:this._data,views:this.views,itemTemp:this._options.itemTemp});s._setInitModel(this.initModel),s._setViewId(this._options.viewId||app.getCurrentView()),i&&i.at<this.collection.models.length-1&&this.collection.models.length>1?this.collection.models[0===i.at?0:i.at-1].view.$el.after(s._render().el):this.list.append(s._render().el),this.views.push(s)}},_push:function(t,e){debug("BaseList._push");var i,n="number"===Est.typeOf(e)?e+1:0===this.collection.models.length?0:this.collection.models.length+1,s={at:n>this.collection.models.length?this.collection.models.length+2:n};t.cid||(t=new this.initModel(t)),this._options.items&&(i="array"===Est.typeOf(t)?Est.pluck(t,function(t){return t.attributes}):t.attributes,this._options.items.splice(s.at-1,0,i)),this.collection.push(t,s),Est.isEmpty(e)||this._exchangeOrder(n-1,n,{}),this._resetDx(),this._setValue("checked_all",!1)},_eq:function(t){return this.collection.models[t].view.$el},_resetDx:function(){debug("BaseList._resetDx");var t=0;Est.each(this.collection.models,function(e){e.set("dx",t),t++})},_findIndex:function(t){return Est.findIndex(this.collection.models,{cid:t.cid})},_filterCollection:function(){debug("BaseList._filterCollection"),this._filter(this._options.filter,this._options)},_renderListByPagination:function(){debug("BaseList._renderListByPagination"),this.page=this.collection.paginationModel.get("page"),this.pageSize=this.collection.paginationModel.get("pageSize"),this.startIndex=(this.page-1)*parseInt(this.pageSize,10),this.endIndex=this.startIndex+parseInt(this.pageSize,10);for(var t=this.startIndex;t<this.endIndex;t++)this.collection.push(this._options.items[t]);return this.collection.paginationModel.set("count",this._options.items.length),this.collection._paginationRender(),this.collection},_empty:function(){if(this.dx=0,debug("BaseList._empty"),this._options.append)return this.collection;if(this.collection&&!this.collection.remove,this.collection._reset&&this.collection._reset(),this.collection)for(var t=this.collection.length;t>-1;)this.collection.remove(this.collection[t]),t--;return this.collection.paginationModel&&(this.dx=(this.collection.paginationModel.get("pageSize")||16)*(this.collection.paginationModel.get("page")-1||0)),Est.each(this.views,function(t){t.remove().off()}),this.views=[],this.collection},_clear:function(){debug("BaseList._clear"),this._empty.call(this),this.list.empty(),this.collection.models.length=0},_addAll:function(){debug("BaseList._addAll and call this._empty"),this._empty(),this.collection.each(this._addOne,this)},_search:function(t){debug("BaseList._search");var e=this;this._clear(),this.filter=!0,t=Est.extend({onBeforeAdd:function(){}},t),this._load({page:1,pageSize:5e3,afterLoad:function(){e.filter=!1,e._options.items?e._filterItems(t.filter||e._options.filter,t):e._filter(t.filter||e._options.filter,t)}})},_filter:function(t,e){debug("BaseList._filter");var i=this,n=[],s=i.collection.models.length;for(i.filter=!1;s>0;){this._check()&&(s=-1);var o=i.collection.models[s-1],r=!0;if(Est.each(t,function(t){var e=!1,n=Est.getValue(o.attributes,t.key);return e="regexp"===Est.typeOf(t.match)?!t.match.test(n):Est.isEmpty(n)||-1===n.indexOf(t.value),r&&!Est.isEmpty(t.value)&&e?(i.collection.remove(o),r=!1,!1):void 0}),r&&e.onBeforeAdd){var a=e.onBeforeAdd.call(this,o);"boolean"!==Est.typeOf(a)||a||(r=!1)}r&&n.unshift(o),s--}Est.each(n,function(t){t.set("_isSearch",!0),i._addOne(t)})},_filterItems:function(t,e){debug("BaseList._filterItems");var i=this,n=[],s=Est.cloneDeep(i._options.items),o=s.length;for(i.filter=!1;o>0&&!this._check();){var r=s[o-1],a=!0;if(Est.each(t,function(t){var e=!1,i=Est.getValue(r,t.key);return e="regexp"===Est.typeOf(t.match)?!t.match.test(i):Est.isEmpty(i)||-1===i.indexOf(t.value),a&&!Est.isEmpty(t.value)&&e?(s.splice(o,1),a=!1,!1):void 0}),a&&e.onBeforeAdd){var l=e.onBeforeAdd.call(this,r);"boolean"!==Est.typeOf(l)||l||(a=!1)}a&&n.unshift(r),o--}Est.each(n,function(t){t=new i.initModel(t),t.set("_isSearch",!0),i.collection.push(t)})},_checkAll:function(t){var e,i=null;"boolean"===Est.typeOf(t)?this._setValue("checked_all",t):t?(i=this._getEventTarget(t),i.is("checkbox")?this._setValue("checked_all",i.get(0).checked):this._setValue("checked_all",!this._getValue("checked_all"))):this._setValue("checked_all",!this._getValue("checked_all")),e=this._getValue("checked_all"),this.collection.each(function(t){t.view._check(e),t.view.render()}),this._checkedAll(this._getValue("checked_all"))},_checkedAll:function(t){this._setValue("checked_all",t)},_saveSort:function(t){var e={id:t.get("id")};e[this._options.sortField||"sort"]=t.get(this._options.sortField),t._saveField(e,this,{async:!1,hideTip:!0})},_insertOrder:function(t,e,i){e>t&&e++,Est.arrayInsert(this.collection.models,t,e,{arrayExchange:Est.proxy(function(t,e,i,n){this._exchangeOrder(e,i,{path:this._options.sortField||"sort",success:function(t,e){t.get("id")&&e.get("id")?(t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8")}})},this),callback:function(t){i&&i.call(this,t)}}),this._resetDx()},_exchangeOrder:function(t,e,i){var n={},s={},o=this.collection.at(t),r=this.collection.at(e);if(o.view&&r.view){var a=o.view.model.get("dx"),l=r.view.model.get("dx");n.dx=l,s.dx=a}if(i.path){var c=o.view.model.get(i.path),h=r.view.model.get(i.path);n[i.path]=h,s[i.path]=c}return o.view.model.stopCollapse=!0,r.view.model.stopCollapse=!0,this.collection.models[e]=this.collection.models.splice(t,1,this.collection.models[e])[0],o.view.model.set(n),r.view.model.set(s),e>t?o.view.$el.before(r.view.$el).removeClass("hover"):o.view.$el.after(r.view.$el).removeClass("hover"),o.view.$el.hasClass("bui-grid-row-even")?(o.view.$el.removeClass("bui-grid-row-even"),r.view.$el.addClass("bui-grid-row-even")):(o.view.$el.addClass("bui-grid-row-even"),r.view.$el.removeClass("bui-grid-row-even")),i.success&&i.success.call(this,o,r),this},_moveUp:function(t){debug("BaseList._moveUp");var e,i,n=this,s=this.collection.indexOf(t),o=[];if(this._options.subRender){i=t.get(this._options.parentId),this.collection.each(function(t){i===t.get(n._options.parentId)&&o.push(t)});var r=Est.findIndex(o,function(e){return e.get("id")===t.get("id")});if(0===r)return;e=this.collection.indexOf(o[r-1])}else{if(0===s)return;e=s-1}this._exchangeOrder(s,e,{path:this._options.sortField||"sort",success:function(t,e){t.get("id")&&e.get("id")?(this._saveSort(t),this._saveSort(e),t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8")}})},_moveDown:function(t){debug("BaseList._moveDown");var e,i,n=this,s=this.collection.indexOf(t),o=[];if(this._options.subRender){i=t.get(n._options.parentId),this.collection.each(function(t){i===t.get(n._options.parentId)&&o.push(t)});var r=Est.findIndex(o,function(e){return e.get("id")===t.get("id")});if(r===o.length-1)return;e=this.collection.indexOf(o[r+1])}else{if(s===this.collection.models.length-1)return;e=s+1}this._exchangeOrder(s,e,{path:this._options.sortField,success:function(t,e){t.get("id")&&e.get("id")?(this._saveSort(t),this._saveSort(e),t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8")}})},_getCheckboxIds:function(t){return Est.pluck(this._getCheckedItems(),Est.isEmpty(t)?"id":"attributes."+t)},__filter:function(t){return t.attributes.checked},_getCheckedItems:function(t){return t?Est.chain(this.collection.models).filter(this.__filter).pluck("attributes").value():Est.chain(this.collection.models).filter(this.__filter).value()},_getItems:function(t){return Est.map(this.collection.models,function(e){return e.toJSON(t)})},_getItem:function(t){var e=this._getItems();return t=t||0,e.length>t?e[t]:null},_add:function(t){this.collection.push(t)},_batch:function(t){var e=this;return t=Est.extend({tip:CONST.LANG.SUCCESS+"！"},t),this.checkboxIds=this._getCheckboxIds(t.field||"id"),0===this.checkboxIds.length?void BaseUtils.tip(CONST.LANG.SELECT_ONE+"！"):void(t.url?$.ajax({type:"POST",async:!1,url:t.url,data:{ids:e.checkboxIds.join(",")},success:function(i){i.success?BaseUtils.tip(t.tip):BaseUtils.tip(i.msg),e._load(),t.callback&&t.callback.call(e,i)}}):(Est.each(this._getCheckedItems(),function(t){t.destroy()}),t.callback&&t.callback.call(e)))},_batchDel:function(t,e){var i=this,n=null,s="id",o=this._getEventTarget(t);return o.size()>0?(n=o.attr("data-url"),s=o.attr("data-field")||"id"):(n=t.url,id=t.id||"id"),this.checkboxIds=this._getCheckboxIds(s),this.checkboxIds&&0===this.checkboxIds.length?void BaseUtils.tip(CONST.LANG.SELECT_ONE):void BaseUtils.confirm({success:function(){i._batch({url:n,field:s,tip:CONST.LANG.DEL_SUCCESS,callback:e})}})},_clearChecked:function(){Est.each(this.collection.models,function(t){!Est.equal(t._previousAttributes.checked,t.attributes.checked)&&t.view&&(t.attributes.checked=!1,Est.trigger(t.view.cid+"checked","checked"))})}}),BaseItem=SuperView.extend({_initialize:function(t){this._initOptions(t),this._initCollapse(this.model.get("_options")),this._initTemplate(this._options),this._initBind(this._options),this._initView(this._options),this._initStyle(this._options),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.speed=this._options.speed||9},_initCollapse:function(t){t._speed>1&&(this.model.stopCollapse=!1,this.collapsed=t?t._extend:!1)},_initTemplate:function(t){t.template=t.template||t.itemTemp,t.template&&(this.$template="<div>"+t.template+"</div>",t.viewId?app.getCompileTemp(t.viewId)||app.addCompileTemp(t.viewId,Handlebars.compile(t.template)):this.template=Handlebars.compile(t.template))},_initBind:function(t){t.speed>1&&(this.model.bind("reset",this.render,this),this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this))},_initView:function(t){t.speed>1&&(this.model.view&&this.model.view.remove(),this.model.view=this)},_initStyle:function(t){if(t.speed>1){var e=this.model.get("id")?this.model.get("id")+"":this.model.get("dx")+1+"";this.model.get("dx")%2===0&&this.$el.addClass("bui-grid-row-even"),this.$el.addClass("_item_el_"+(this._options.viewId||"")+"_"+e.replace(/^[^1-9]+/,"")),this.$el.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}},_render:function(){debug("10.BaseItem._render"),this._onBeforeRender(),this._options&&this._options.filter&&this._options.filter.call(this,this.model),this.$el.html(this.template?this.template(this.model.attributes):this._options.viewId&&app.getCompileTemp(this._options.viewId)&&app.getCompileTemp(this._options.viewId)(this.model.attributes)),this._options.modelBind&&this._modelBind();var t=this.model.get("_options");if(t&&t._subRender&&this.model.get("children")&&this.model.get("children").length>0){var e=this,i=this.model.get("level")||1,n=this.$(t._subRender+":first");this._setupEvents(t),Est.each(this.model._getChildren(t._collection),function(s){var o=null;debug(function(){return Est.isEmpty(s)?"Error20":void 0},{type:"error"}),s.set("_options",t),s.set("level",i+1),o=new t._item({model:s,data:e._options._data}),o._setInitModel(e.initModel),o._setViewId(e._options.viewId),s.view=o,n.append(o.$el),e._options.views&&e._options.views.push(o),o._render()})}return this._onAfterRender(),this},_setViewId:function(t){this._options&&(this._options.viewId=t)},_setInitModel:function(t){this.initModel=t},_setupEvents:function(t){var e=this;e._toggleCollapse.call(this,t),this.$(t._collapse+":first").click(function(){e._toggleCollapse.call(e,t)})},_toggleCollapse:function(t){var e=this;return this.model.stopCollapse?void this.$(t._subRender+":first").addClass("hide"):(e.collapsed=!e.collapsed,void(e.collapsed?(this.$(t._collapse+":first").removeClass("x-caret-down"),this.$(t._subRender+":first").slideUp(CONST.COLLAPSE_SPEED).addClass("hide")):(this.$(t._collapse+":first").addClass("x-caret-down"),this.$(t._subRender+":first").slideDown(CONST.COLLAPSE_SPEED).removeClass("hide"))))},_onBeforeRender:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this.model)},_onAfterRender:function(){this._options.toolTip&&this._initToolTip(),this.afterRender&&this.afterRender.call(this,this.model),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el)},_close:function(){debug("BaseItem._close"),this.stopListening()},_clear:function(){debug("ProductItem._clear"),this.model.destroy()},_check:function(t){var e=this.model.get("checked"),i=null,n=null,s=null,o=!0;this._checkAppend="undefined"==typeof this.model.get("_options")._checkAppend?!1:this.model.get("_options")._checkAppend,this._checkToggle="undefined"==typeof this.model.get("_options")._checkToggle?!1:this.model.get("_options")._checkToggle,this._checkAppend||(this._options.viewId?app.getView(this._options.viewId)&&app.getView(this._options.viewId)._clearChecked():debug("Error21",{type:"error"})),this._checkToggle?this.model.attributes.checked="boolean"===Est.typeOf(t)?t:!e:(this.model.attributes.checked="boolean"===Est.typeOf(t)?t:!0,this._itemActive({add:this._checkAppend})),this.model.get("checked")&&this._checkToggle?this._itemActive({add:this._checkAppend}):this._checkToggle&&(this.$el.removeClass("item-active"),this.model.set("checked",!1)),t&&t.shiftKey&&this._checkAppend?(i=app.getData("curChecked"),n=this.model.get("dx"),Est.each(this.model.collection.models,function(t){s=t.get("dx"),s>i&&n>s&&(t.attributes.checked=!0,t.view.$el.addClass("item-active"))})):app.addData("curChecked",this.model.get("dx")),"boolean"!==Est.typeOf(t)&&t&&t.stopImmediatePropagation(),Est.trigger(this.cid+"checked","checked"),this.model.get("checked")?Est.each(this.model.collection.models,function(t){t.attributes.checked||(o=!1)}):o=!1,app.getView(this._options.viewId)&&app.getView(this._options.viewId)._checkedAll(o)},_itemActive:function(t){t=t||{},app.getData("itemActiveList"+this._options.viewId)||app.addData("itemActiveList"+this._options.viewId,[]);var e=app.getData("itemActiveList"+this._options.viewId);t.add||(debug("BaseItem._itemActive"),Est.each(e,Est.proxy(function(t){$("."+t,app.getView(this._options.viewId)?app.getView(this._options.viewId).$el:$("body")).removeClass("item-active")},this)),e.length=0),this.$el.addClass("item-active"),e.push(this.$el.attr("class").replace(/^.*(_item_el_.+?)\s+.*$/g,"$1"))},_moveUp:function(t){return t.stopImmediatePropagation(),this.collapsed=!0,this._options.viewId?void app.getView(this._options.viewId)._moveUp(this.model):(debug("Error22",{type:"error"}),!1)},_moveDown:function(t){return t.stopImmediatePropagation(),this.collapsed=!0,this._options.viewId?void app.getView(this._options.viewId)._moveDown(this.model):(debug("Error23",{type:"error"}),!1)},_saveSort:function(){var t=this,e=this.$(".input-sort").val();this.model._saveField({id:this.model.get("id"),sort:e},t,{success:function(){t.model.set("sort",e)},hideTip:!0})},_getPage:function(){var t=this.model.collection.paginationModel;return t?t.get("page"):1},_del:function(t,e){t&&t.stopImmediatePropagation(),debug("1.BaseItem._del");var i=this;return app.getData("delItemDialog")&&app.getData("delItemDialog").close(),i.model.get("children").length>0?void BaseUtils.confirm({title:CONST.LANG.TIP,width:300,content:CONST.LANG.DEL_TIP}):void app.addData("delItemDialog",BaseUtils.confirm({title:CONST.LANG.WARM_TIP,content:'<div class="item-delete-confirm">'+CONST.LANG.DEL_CONFIRM+"</div>",target:t&&this._getTarget(t).get(0),success:function(t){Est.isEmpty(i.model.url())&&(i.model.attributes.id=null),i.model.destroy({wait:!0,error:function(t,e){var i=[];i.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),BaseUtils.dialog({title:CONST.LANG.TIP+"：",content:e.msg,width:250,button:i})},success:function(){i._removeFromItems(i.model.get("dx")),e&&e.call(i)}})}}))},_removeFromItems:function(t){"undefined"!==Est.typeOf(t)&&app.getView(this._options.viewId)&&(app.getView(this._options.viewId)._options.items&&app.getView(this._options.viewId)._options.items.splice(t,1),app.getView(this._options.viewId)._resetDx())}}),PaginationModel=Backbone.Model.extend({defaults:{page:1,pageSize:16,count:0},initialize:function(){debug("3.PaginationModel.initialize")}}),BaseCollection=Backbone.Collection.extend({constructor:function(t){this.options=t||{},Backbone.Collection.apply(this,[null,arguments])},_initialize:function(){debug("2.BaseCollection._initialize"),this._baseUrl=this.url,this.paginationModel||(this.paginationModel=new PaginationModel({page:this.options.page,pageSize:this.options.pageSize}))},initialize:function(){this._initialize()},parse:function(t,e){var i=this;return Est.isEmpty(t)?(debug(function(){var t="function"===Est.typeOf(i.url)?i.url():i.url;return"Error:14 "+t},{type:"error"}),[]):(this._parsePagination(t),this._parseUrl(this.paginationModel),this.options.pagination&&this.paginationModel&&this._paginationRender(),t.attributes.data)},_parseUrl:function(t){debug("- BaseCollection._parseUrl");var e=1,i=16;if(t&&t.get("pageSize")&&(i=t.get("pageSize"),e=t.get("page")),this.options.subRender&&(e=1,i=9e3),"function"!=typeof this.url){var n="";Est.isEmpty(this._itemId)||(n="/"+this._itemId),this.url=this._baseUrl+n+"?page="+e+"&pageSize="+i}},_parsePagination:function(t){debug("6.BaseCollection._parsePagination"),t.attributes=t.attributes||{page:1,per_page:10,count:10},this.paginationModel&&(this.paginationModel.set("page",t.attributes.page),this.paginationModel.set("pageSize",t.attributes.per_page),this.paginationModel.set("count",t.attributes.count))},_paginationRender:function(){seajs.use(["Pagination"],Est.proxy(function(t){if(this.pagination)this.pagination.render();else{var e=$(this.options.el),i="string"===Est.typeOf(this.options.pagination),n=$(i?this.options.pagination:"#pagination-container",e.size()>0?e:$("body"));i&&this.paginationModel.set("numLength",parseInt(n.attr("data-numLength")||7,10)),this.pagination=new t({el:n,model:this.paginationModel})}},this))},_load:function(t,e,i){return debug("4.BaseCollection._load"),this._parseUrl(i),t.fetch({success:function(){debug("5.collection reset"),e._empty()},cacheData:this.options.cache,session:this.options.session})},_setItemId:function(t){this._itemId=t,debug("- get list by itemId "+this._itemId)},_empty:function(){if(debug("BaseCollection._empty"),this.collection)for(var t=this.collection.length;t>-1;)this.collection.remove(this.collection[t]),t--}}),BaseModel=Backbone.Model.extend({defaults:{checked:!1,
checked_all:!1,children:[]},baseId:"",url:function(){var t=this.baseUrl,e="";if(!t)return"";"function"===Est.typeOf(t)&&(t=t.call(this)),this.params=this.params?this.params:"";var i=Est.isEmpty(this.params)?"":"?";return this.isNew()&&Est.isEmpty(this.id)?t+i+this.params:(e=t+("/"==t.charAt(t.length-1)?"":"/")+this.id+i+this.params,debug(function(){return"[Query]"+e}),e)},_initialize:function(t){this.validateMsg=null,debug("9.BaseModel._initialize "+this.baseId)},parse:function(t,e){var i=this,n=[],s=!1;if("msg"in t&&BaseUtils.removeLoading(),Est.isEmpty(t)){var o="function"===Est.typeOf(this.url)?this.url():this.url;return debug("Error25 url"+o),BaseUtils.tip(CONST.LANG.REQUIRE_FAILED),!1}if(t&&t.msg&&t.msg===CONST.LANG.AUTH_FAILED&&BaseUtils.tip(CONST.LANG.AUTH_LIMIT,{time:2e3}),t.msg!==CONST.LANG.NOT_LOGIN||this.stopCheckLogin||Est.trigger("checkLogin"),t.msg&&!this.hideTip){t.success?(!i.isNew()||this.autoHide||this.hideAddBtn||(n.push({value:CONST.LANG.ADD_CONTINUE,callback:function(){i.set("id",null),i.set(i.baseId,null)}}),s=!0),!this.hideOkBtn&&n.push({value:CONST.LANG.CONFIRM,callback:function(){if(Est.trigger("_dialog_submit_callback"),this.autoBack="undefined"===Est.typeOf(this.autoBack)?!0:this.autoBack,"undefined"!=typeof window.topDialog)window.topDialog.close(),window.topDialog=null,$&&this.autoBack&&$(".btn-back").click();else if(app.getDialogs().length>0)try{app.getDialogs().pop().close().remove(),$&&this.autoBack&&$(".btn-back").click()}catch(t){}this.close()},autofocus:!0})):n.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),this.hideOkBtn&&Est.trigger("_dialog_submit_callback");BaseUtils.dialog({id:"dialog_msg",title:CONST.LANG.TIP,content:'<div style="padding: 20px;">'+t.msg+"</div>",width:250,button:n});setTimeout(function(){app.getDialog("dialog_msg")&&(i.autoHide||!s)&&app.getDialog("dialog_msg").close().remove()},2e3)}if("boolean"===Est.typeOf(t.success)&&!t.success)return i.attributes._response=t,i.attributes;if(t.attributes&&t.attributes.data){var r=Est.keys(t.attributes);r.length>1&&Est.each(r,function(e){"data"!==e&&(t.attributes.data[e]=t.attributes[e])}),t=t.attributes.data}return t&&(t.id=t[i.baseId||"id"],t.checked=!1,t.time=(new Date).getTime()),t},_saveField:function(t,e,i){var n=i.async||!0,s=new e.initModel({id:t.id||e.model.get("id")});s.clear(),s.set(t),s.set("silent",!0),i.hideTip&&(s.hideTip=!0),s.hideOkBtn=!0,s.set("editField",!0),debug(function(){return s.baseUrl?void 0:"Error27"},{type:"console"}),s.baseUrl?s.save(null,{success:function(n,s){s.msg!==CONST.LANG.NOT_LOGIN||this.stopCheckLogin||Est.trigger("checkLogin"),"undefined"!=typeof i.success&&i.success&&i.success.call(e,t,s)},wait:n}):i.success&&i.success.call(e,t,{})},_getChildren:function(t){return Est.map(this.get("children"),function(e){return"string"==typeof e||"number"==typeof e?t.get(e):e})},_hideTip:function(){this.hideTip=!0},_toggle:function(){this.set("checked",!this.get("checked"))},_validation:function(t,e){return!t.silent&&e&&e.call(this,t),this.validateMsg},_getValue:function(t){return Est.getValue(this.attributes,t)},_setValue:function(t,e){Est.setValue(this.attributes,t,e)},initialize:function(){this._initialize()}}),BaseDetail=SuperView.extend({_initialize:function(t){this._initOptions(t),this._initTemplate(this._options),this._initList(this._options),this._initModel(t.model,this),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.speed=this._options.speed||9},_initTemplate:function(t){return this._data=t.data=t.data||{},t.template&&(this.template=Handlebars.compile(t.template),this.$template="<div>"+t.template+"</div>"),this._data},_initList:function(t){var e=this;return this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render)),debug(function(){return e.list&&0!==e.list.size()?void 0:"Error15 viewId="+e.options.viewId+(e._options.render?e._options.render:e.el)},{type:"error"}),this.list},_render:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this._options),this.list.append(this.template(this.model.attributes)),this._options.modelBind&&this._modelBind(),window.topDialog&&this.$(".form-actions").hide(),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el),this.afterRender&&this.afterRender.call(this,this._options),this._options.form&&this._form(this._options.form)._initSubmit({beforeSave:this.beforeSave,afterSave:this.afterSave}),this._options.toolTip&&this._initToolTip(),BaseUtils.removeLoading()},_initModel:function(t,e){debug(function(){return t?void 0:"Error16"},{type:"error"}),e.passId=this.options.id||this._options.data.id||Est.getUrlParam("id",window.location.href),Est.isEmpty(this.passId)?(e.passId=(new Date).getTime(),e.model=new t(this._options.data||{}),e.model.set("_data",e._options.data),e.model.set("_isAdd",e._isAdd=!0),e.render()):(e.model=new t,e.model.set("id",e.passId),e.model.set("_data",e._options.data),e.model.set("CONST",CONST),e.model.fetch().done(function(t){t.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),e.model.set("_isAdd",e._isAdd=!1),e.render()})),this._options.hideOkBtn&&(e.model.hideOkBtn=!0),this._options.hideSaveBtn&&(e.model.hideSaveBtn=!0),this._options.autoHide&&(e.model.autoHide=!0)},_form:function(t){return this.formSelector=t,this.formElemnet=this.$(this.formSelector),this},_validate:function(t){return this},_initSubmit:function(t){var e=this,i=!0,n=!0;t=t||{},$("#submit",this.el).on("click",function(){var s=$(this),o=s.is("input"),r=e.preText=o?s.val():s.html();if(i=!0,e.formElemnet.submit(),$("input, textarea, select",$(e.formSelector)).each(function(){var t,n,s,o,r;t=$(this).attr("name"),$(this).hasClass("bui-form-field-error")&&(i=!1);var a=$(this).attr("id");if(a&&-1!==a.indexOf("model")){switch(this.type){case"radio":n=$(this).is(":checked")?$(this).val():s=!0;break;case"checkbox":n=$(this).is(":checked")?Est.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):Est.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:n=$(this).val()}if(!s)if(o=a.replace(/^model\d?-(.+)$/g,"$1"),r=o.split("."),r.length>1)try{e.model.attributes[r[0]]||(e.model.attributes[r[0]]={}),Est.setValue(e.model.attributes,o,n)}catch(l){debug("Error18 "+l)}else e.model.set(r[0],n)}}),i){if("undefined"!=typeof t.beforeSave&&(n=t.beforeSave.call(e)),"undefined"!==Est.typeOf(n)&&!n)return!1;o?s.val(CONST.LANG.SUBMIT):s.html(CONST.LANG.SUBMIT),s.prop("disabled",!0),e._save(function(i){t.afterSave&&(t.afterSave=Est.inject(t.afterSave,function(t){return new Est.setArguments(arguments)},function(t){o?s.val(r):s.html(r),s.prop("disabled",!1)}),t.afterSave.call(e,i,"string"===Est.typeOf(i)?!0:"boolean"===Est.typeOf(Est.getValue(i,"attributes._response.success"))?Est.getValue(i,"attributes._response.success"):!0)),s.html(r)},function(i){i.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),t.onErrorSave&&t.onErrorSave.call(e,i)}),setTimeout(function(){s.html(r),s.prop("disabled",!1)},5e3)}return!1})},_save:function(t,e){this._saveItem(t,e)},_saveItem:function(t,e){return debug("- BaseDetail._saveItem"),"string"===Est.typeOf(this.model.url)&&debug("Error29",{type:"error"}),Est.isEmpty(this.model.url())?void debug("Error19",{type:"error"}):(this.model.attributes._response&&delete this.model.attributes._response,void this.model.save(null,{wait:!0,success:function(e){debug("- BaseDetail._saveSuccess"),app.addModel(Est.cloneDeep(e.attributes)),top&&(top.model=e.attributes),t&&"function"==typeof t&&t.call(this,e)},error:function(i,n,s){200===n.status?t.call(this,n.responseText):e&&"function"==typeof e&&e.call(this,n,i,s)}}))},_empty:function(){this.model.off(),this.$el.empty().off()},_close:function(){debug("- BaseDetail.close"),this.undelegateEvents(),this.stopListening(),this.off()}});