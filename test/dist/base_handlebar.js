!function(t,e){if("function"==typeof define&&define.amd)define(["Est","jquery","exports"],function(i,s,n){t.Backbone=e(t,n,i,s)});else if("undefined"!=typeof exports){var i=require("Est");e(t,exports,i,t.jQuery)}else t.Backbone=e(t,{},t.Est,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,e,i,s){var n=t.Backbone,o=[],a=(o.push,o.slice);o.splice;e.VERSION="1.1.2",e.$=s,e.noConflict=function(){return t.Backbone=n,this},e.result=function(t,e){if(null!=t){var s=t[e];return"function"===i.typeOf(s)?t[e]():s}},e.emulateHTTP=!0,e.emulateJSON=!0;var r=e.Events={on:function(t,e,i){if(!l(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var s=this._events[t]||(this._events[t]=[]);return s.push({callback:e,context:i,ctx:i||this}),this},once:function(t,e,s){if(!l(this,"once",t,[e,s])||!e)return this;var n=this,o=i.once(function(){n.off(t,o),e.apply(this,arguments)});return o._callback=e,this.on(t,o,s)},off:function(t,e,s){var n,o,a,r,h,c,u,p;if(!this._events||!l(this,"off",t,[e,s]))return this;if(!t&&!e&&!s)return this._events=void 0,this;for(r=t?[t]:i.keys(this._events),h=0,c=r.length;c>h;h++)if(t=r[h],a=this._events[t]){if(this._events[t]=n=[],e||s)for(u=0,p=a.length;p>u;u++)o=a[u],(e&&e!==o.callback&&e!==o.callback._callback||s&&s!==o.context)&&n.push(o);n.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=a.call(arguments,1);if(!l(this,"trigger",t,e))return this;var i=this._events[t],s=this._events.all;return i&&c(i,e),s&&c(s,arguments),this},stopListening:function(t,e,s){var n=this._listeningTo;if(!n)return this;var o=!e&&!s;s||"object"!=typeof e||(s=this),t&&((n={})[t._listenId]=t);for(var a in n)t=n[a],t.off(e,s,this),(o||i.isEmpty(t._events))&&delete this._listeningTo[a];return this}},h=/\s+/,l=function(t,e,i,s){if(!i)return!0;if("object"==typeof i){for(var n in i)t[e].apply(t,[n,i[n]].concat(s));return!1}if(h.test(i)){for(var o=i.split(h),a=0,r=o.length;r>a;a++)t[e].apply(t,[o[a]].concat(s));return!1}return!0},c=function(t,e){var i,s=-1,n=t.length,o=e[0],a=e[1],r=e[2];switch(e.length){case 0:for(;++s<n;)(i=t[s]).callback.call(i.ctx);return;case 1:for(;++s<n;)(i=t[s]).callback.call(i.ctx,o);return;case 2:for(;++s<n;)(i=t[s]).callback.call(i.ctx,o,a);return;case 3:for(;++s<n;)(i=t[s]).callback.call(i.ctx,o,a,r);return;default:for(;++s<n;)(i=t[s]).callback.apply(i.ctx,e);return}},u={listenTo:"on",listenToOnce:"once"};i.each(u,function(t,e){r[e]=function(e,s,n){var o=this._listeningTo||(this._listeningTo={}),a=e._listenId||(e._listenId=i.nextUid("l"));return o[a]=e,n||"object"!=typeof s||(n=this),e[t](s,n,this),this}}),r.bind=r.on,r.unbind=r.off,i.extend(e,r);var p=e.Model=function(t,s){var n=t||{};s||(s={}),this.cid=i.nextUid("c"),this.attributes={},s.collection&&(this.collection=s.collection),s.parse&&(n=this.parse(n,s)||{}),n=i.defaults({},n,e.result(this,"defaults")),this.set(n,s),this.changed={},this.initialize.apply(this,arguments)};i.extend(p.prototype,r,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){var e=i.cloneDeep(this.attributes);return delete e.CONST,delete e._data,delete e._isAdd,"boolean"!==i.typeOf(t)&&(delete e.checked,delete e.checked_all,delete e.children),this.fields?Est.pick(e,this.fields):t&&t.fields?Est.pick(e,t.fields):e},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escapeHTML(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,s){var n,o,a,r,h,l,c,u;if(null==t)return this;if("object"==typeof t?(o=t,s=e):(o={})[t]=e,s||(s={}),!this._validate(o,s))return!1;a=s.unset,h=s.silent,r=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,c=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(n in o)e=o[n],i.equal(u[n],e)||r.push(n),i.equal(c[n],e)?delete this.changed[n]:this.changed[n]=e,a?delete u[n]:u[n]=e;if(!h){r.length&&(this._pending=s);for(var p=0,d=r.length;d>p;p++)this.trigger("change:"+r[p],this,u[r[p]],s)}if(l)return this;if(!h)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var s in this.attributes)e[s]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.clone(this.changed):!1;var e,s=!1,n=this._changing?this._previousAttributes:this.attributes;for(var o in t)i.equal(n[o],e=t[o])||((s||(s={}))[o]=e);return s},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=t?i.clone(t):{},t.cache=!1,void 0===t.parse&&(t.parse=!0);var e=this,s=t.success;return t.success=function(i){return e.set(e.parse(i,t),t)?(s&&s(e,i,t),void e.trigger("sync",e,i,t)):!1},M(this,t),this.sync("read",this,t)},save:function(t,e,s){var n,o,a,r=this.attributes;if(null==t||"object"==typeof t?(n=t,s=e):(n={})[t]=e,s=i.extend({validate:!0},s),n&&!s.wait){if(!this.set(n,s))return!1}else if(!this._validate(n,s))return!1;n&&s.wait&&(this.attributes=i.extend({},r,n)),void 0===s.parse&&(s.parse=!0);var h=this,l=s.success;return s.success=function(t){h.attributes=r;var e=h.parse(t,s);return s.wait&&(e=i.extend(n||{},e)),"object"!==i.typeOf(e)||h.set(e,s)?(l&&l(h,t,s),void h.trigger("sync",h,t,s)):!1},M(this,s),o=this.isNew()?"create":s.patch?"patch":"update","patch"===o&&(s.attrs=n),a=this.sync(o,this,s),n&&s.wait&&(this.attributes=r),a},destroy:function(t){t=t?i.clone(t):{};var e=this,s=t.success,n=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(i){return i&&!i.success?void(t.error&&t.error.call(this,i)):((t.wait||e.isNew())&&n(),s&&s(e,i,t),void(e.isNew()||e.trigger("sync",e,i,t)))},this.isNew())return t.success(),!1;M(this,t);var o=this.sync("delete",this,t);return t.wait||n(),o},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||D();return this.isNew()?t:t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var s=this.validationError=this.validate(t,e)||null;return s?(this.trigger("invalid",this,s,i.extend(e,{validationError:s})),!1):!0}});var d=["keys","values","invert","pick"];i.each(d,function(t){p.prototype[t]=function(){var e=a.call(arguments);return e.unshift(this.attributes),i[t].apply(i,e)}});var f=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};i.extend(f.prototype,r,{model:p,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,m))},remove:function(t,e){var s=!("array"===i.typeOf(t));t=s?[t]:i.clone(t),e||(e={});var n,o,a,r;for(n=0,o=t.length;o>n;n++)r=t[n]=this.get(t[n]),r&&(delete this._byId[r.id],delete this._byId[r.cid],a=this.indexOf(r),this.models.splice(a,1),this.length--,e.silent||(e.index=a,r.trigger("remove",r,this,e)),this._removeReference(r,e));return s?t[0]:t},set:function(t,e){e=i.defaults({},e,g),e.parse&&(t=this.parse(t,e));var s=!("array"===i.typeOf(t));t=s?t?[t]:[]:i.clone(t);var n,o,a,r,h,l,c,u=e.at,d=this.model,f=this.comparator&&null==u&&e.sort!==!1,m="string"===i.typeOf(this.comparator)?this.comparator:null,_=[],v=[],b={},y=e.add,E=e.merge,w=e.remove,k=!f&&y&&w?[]:!1;for(n=0,o=t.length;o>n;n++){if(h=t[n]||{},a=h instanceof p?r=h:h[d.prototype.idAttribute||"id"],l=this.get(a))w&&(b[l.cid]=!0),E&&(h=h===r?r.attributes:h,e.parse&&(h=l.parse(h,e)),l.set(h,e),f&&!c&&l.hasChanged(m)&&(c=!0)),t[n]=l;else if(y){if(r=t[n]=this._prepareModel(h,e),!r)continue;_.push(r),this._addReference(r,e)}r=l||r,!k||!r.isNew()&&b[r.id]||k.push(r),b[r.id]=!0}if(w){for(n=0,o=this.length;o>n;++n)b[(r=this.models[n]).cid]||v.push(r);v.length&&this.remove(v,e)}if(_.length||k&&k.length)if(f&&(c=!0),this.length+=_.length,null!=u)for(n=0,o=_.length;o>n;n++)this.models.splice(u+n,0,_[n]);else{k&&(this.models.length=0);var S=k||_;for(n=0,o=S.length;o>n;n++)this.models.push(S[n])}if(c&&this.sort({silent:!0}),!e.silent){for(n=0,o=_.length;o>n;n++)(r=_[n]).trigger("add",r,this,e);(c||k&&k.length)&&this.trigger("sort",this,e)}return s?t[0]:t},reset:function(t,e){e||(e={});for(var s=0,n=this.models.length;n>s;s++)this._removeReference(this.models[s],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return a.apply(this.models,arguments)},get:function(t){return null!=t?this._byId[t]||this._byId[t.id]||this._byId[t.cid]:void 0},at:function(t){return this.models[t]},where:function(t,e){return i.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),"string"===i.typeOf(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.proxy(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return i.invoke(this.models,"get",t)},fetch:function(t){t=t?i.clone(t):{},t.cache=!1,void 0===t.parse&&(t.parse=!0);var e=t.success,s=this;return t.success=function(i){e&&e(s,i,t);var n=t.reset?"reset":"set";s[n](i,t),s.trigger("sync",s,i,t)},M(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?i.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var s=this,n=e.success;return e.success=function(t,i){e.wait&&s.add(t,e),n&&n(t,i,e)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof p)return t;e=e?i.clone(e):{},e.collection=this;var s=new this.model(t,e);return s.validationError?(this.trigger("invalid",this,s.validationError,e),!1):s},_addReference:function(t,e){this._byId[t.cid]=t,null!=t.id&&(this._byId[t.id]=t),t.collection||(t.collection=this),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,s){("add"!==t&&"remove"!==t||i===this)&&("destroy"===t&&this.remove(e,s),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var _=["forEach","each","map","collect","find","detect","filter","all","some","any","invoke","rest","tail","drop","indexOf","isEmpty","chain"];i.each(_,function(t){f.prototype[t]=function(){var e=a.call(arguments);return e.unshift(this.models),i[t].apply(i,e)}});var v=["sortBy"];i.each(v,function(t){f.prototype[t]=function(e,s){var n="function"===i.typeOf(e)?e:function(t){return t.get(e)};return i[t](this.models,n,s)}});var b=e.View=function(t){this.cid=i.nextUid("view"),t||(t={}),i.extend(this,i.pick(t,E)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},y=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName","events"];i.extend(b.prototype,r,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=e.result(this,"events")))return this;this.undelegateEvents();for(var s in t){var n=t[s];if("function"!==i.typeOf(n)&&(n=this[t[s]]),n){var o=s.match(y),a=o[1],r=o[2];n=i.proxy(n,this),a+=".delegateEvents"+this.cid,""===r?this.$el.on(a,n):this.$el.on(a,r,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var t=i.extend({},e.result(this,"attributes"));this.id&&(t.id=e.result(this,"id")),this.className&&(t["class"]=e.result(this,"className"));var s=e.$("<"+e.result(this,"tagName")+">").attr(t);this.setElement(s,!1)}}}),e.sync=function(t,s,n){var o=k[t];i.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var a={type:o,dataType:"json"};if(n.url||(a.url=e.result(s,"url"),!i.isEmpty(a.url))){if(null==n.data&&s&&("create"===t||"update"===t||"patch"===t)){a.contentType="application/json";var r=i.cloneDeep(s.toJSON(n));delete r.CONST,delete r._data,delete r._isAdd,delete r.checked,delete r.checked_all,delete r.children,delete r._options,a.data=JSON.stringify(n.attrs||r)}if(n.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),n.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){a.type="POST",n.emulateJSON&&(a.data._method=o);var h=n.beforeSend;n.beforeSend=function(t){return t.setRequestHeader("X-HTTP-Method-Override",o),h?h.apply(this,arguments):void 0}}"GET"===a.type||n.emulateJSON||(a.processData=!1),"PATCH"===a.type&&w&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=n.xhr=e.ajax(i.extend(a,n));return s.trigger("request",s,l,n),l}};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){function t(t){return app.addCache(n,t),new i.setArguments(arguments)}var s=null,n={};if(arguments[0].cacheData||arguments[0].session){if(n.data=arguments[0].data,n.url=arguments[0].url,n.cache=arguments[0].cacheData,n.session=arguments[0].session,s=app.getCache(n))return arguments[0].success.call(this,s),{done:function(t){t.call(this,s)}};arguments[0].success=i.inject(arguments[0].success,t,function(){})}return e.$.ajax.apply(e.$,arguments)};var S=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},x=/\((.*?)\)/g,I=/(\(\?)?:\w+/g,O=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(S.prototype,r,{initialize:function(){},route:function(t,s,n){"regexp"!==i.typeOf(t)&&(t=this._routeToRegExp(t)),"function"===i.typeOf(s)&&(n=s,s=""),n||(n=this[s]);var o=this;return e.history.route(t,function(i){var a=o._extractParameters(t,i);o.execute(n,a),o.trigger.apply(o,["route:"+s].concat(a)),o.trigger("route",s,a),e.history.trigger("route",o,s,a)}),this},execute:function(t,e){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var t,s=i.keys(this.routes);null!=(t=s.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(N,"\\$&").replace(x,"(?:$1)?").replace(I,function(t,e){return e?t:"([^/?]+)"}).replace(O,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var s=t.exec(e).slice(1);return i.map(s,function(t,e){return e===s.length-1?t||null:t?decodeURIComponent(t):null})}});var T=e.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},C=/^[#\/]|\s+$/g,$=/^\/+|\/+$/g,A=/msie [\w.]+/,L=/\/$/,P=/#.*$/;T.started=!1,i.extend(T.prototype,r,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(L,"");t.indexOf(i)||(t=t.slice(i.length))}else t=this.getHash();return t.replace(C,"")},start:function(t){if(T.started)throw new Error("Backbone.history has already been started");T.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var s=this.getFragment(),n=document.documentMode,o=A.exec(navigator.userAgent.toLowerCase())&&(!n||7>=n);if(this.root=("/"+this.root+"/").replace($,"/"),o&&this._wantsHashChange){var a=e.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(s)}this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=s;var r=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&r.hash&&(this.fragment=this.getHash().replace(C,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),T.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return t=this.fragment=this.getFragment(t),i.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(t,e){if(!T.started)return!1;e&&e!==!0||(e={trigger:!!e});var i=this.root+(t=this.getFragment(t||""));if(t=t.replace(P,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var s=t.href.replace(/(javascript:|#).*$/,"");t.replace(s+"#"+e)}else t.hash="#"+e}}),e.history=new T;var B=function(t){return"object"===!i.typeOf(t)?t:(i.each(a.call(arguments,1),function(e){for(var i in e)t[i]=e[i]}),t)},H=function(t,e){var s,n=this;s=t&&i.has(t,"constructor")?t.constructor:function(){return n.apply(this,arguments)},B(s,n,e);var o=function(){this.constructor=s};return o.prototype=n.prototype,s.prototype=new o,t&&i.extend(s.prototype,t),s.__super__=n.prototype,s};p.extend=f.extend=S.extend=b.extend=T.extend=H;var D=function(){throw new Error('A "url" property or function must be specified')},M=function(t,e){var i=e.error;e.error=function(s){i&&i(t,s,e),t.trigger("error",t,s,e)}};return e});var Handlebars={};!function(t,e){t.VERSION="1.0.0",t.COMPILER_REVISION=4,t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},t.helpers={},t.partials={};var i=Object.prototype.toString,s="[object Function]",n="[object Object]";t.registerHelper=function(e,s,o){if(i.call(e)===n){if(o||s)throw new t.Exception("Arg not supported with multiple helpers");t.Utils.extend(this.helpers,e)}else o&&(s.not=o),this.helpers[e]=s},t.registerPartial=function(e,s){i.call(e)===n?t.Utils.extend(this.partials,e):this.partials[e]=s},t.registerHelper("helperMissing",function(t){if(2===arguments.length)return e;throw new Error("Missing helper: '"+t+"'")}),t.registerHelper("blockHelperMissing",function(e,n){var o=n.inverse||function(){},a=n.fn,r=i.call(e);return r===s&&(e=e.call(this)),e===!0?a(this):e===!1||null==e?o(this):"[object Array]"===r?e.length>0?t.helpers.each(e,n):o(this):a(e)}),t.K=function(){},t.createFrame=Object.create||function(e){t.K.prototype=e;var i=new t.K;return t.K.prototype=null,i},t.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(e,i){if(t.logger.level<=e){var s=t.logger.methodMap[e];"undefined"!=typeof console&&console[s]&&console[s].call(console,i)}}},t.log=function(e,i){t.logger.log(e,i)},t.registerHelper("each",function(e,n){var o,a=n.fn,r=n.inverse,h=0,l="",c=i.call(e);if(c===s&&(e=e.call(this)),n.data&&(o=t.createFrame(n.data)),e&&"object"==typeof e)if(e instanceof Array)for(var u=e.length;u>h;h++)o&&(o.index=h),l+=a(e[h],{data:o});else for(var p in e)e.hasOwnProperty(p)&&(o&&(o.key=p),l+=a(e[p],{data:o}),h++);return 0===h&&(l=r(this)),l}),t.registerHelper("if",function(e,n){var o=i.call(e);return o===s&&(e=e.call(this)),!e||t.Utils.isEmpty(e)?n.inverse(this):n.fn(this)}),t.registerHelper("unless",function(e,i){return t.helpers["if"].call(this,e,{fn:i.inverse,inverse:i.fn})}),t.registerHelper("with",function(e,n){var o=i.call(e);return o===s&&(e=e.call(this)),t.Utils.isEmpty(e)?void 0:n.fn(e)}),t.registerHelper("log",function(e,i){var s=i.data&&null!=i.data.level?parseInt(i.data.level,10):1;t.log(s,e)});var o=function(){function t(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function(t,e,i,s,n,o,a){var r=o.length-1;switch(n){case 1:return o[r-1];case 2:this.$=new s.ProgramNode([],o[r]);break;case 3:this.$=new s.ProgramNode(o[r-2],o[r]);break;case 4:this.$=new s.ProgramNode(o[r-1],[]);break;case 5:this.$=new s.ProgramNode(o[r]);break;case 6:this.$=new s.ProgramNode([],[]);break;case 7:this.$=new s.ProgramNode([]);break;case 8:this.$=[o[r]];break;case 9:o[r-1].push(o[r]),this.$=o[r-1];break;case 10:this.$=new s.BlockNode(o[r-2],o[r-1].inverse,o[r-1],o[r]);break;case 11:this.$=new s.BlockNode(o[r-2],o[r-1],o[r-1].inverse,o[r]);break;case 12:this.$=o[r];break;case 13:this.$=o[r];break;case 14:this.$=new s.ContentNode(o[r]);break;case 15:this.$=new s.CommentNode(o[r]);break;case 16:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1]);break;case 17:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1]);break;case 18:this.$=o[r-1];break;case 19:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1],"&"===o[r-2][2]);break;case 20:this.$=new s.MustacheNode(o[r-1][0],o[r-1][1],!0);break;case 21:this.$=new s.PartialNode(o[r-1]);break;case 22:this.$=new s.PartialNode(o[r-2],o[r-1]);break;case 23:break;case 24:this.$=[[o[r-2]].concat(o[r-1]),o[r]];break;case 25:this.$=[[o[r-1]].concat(o[r]),null];break;case 26:this.$=[[o[r-1]],o[r]];break;case 27:this.$=[[o[r]],null];break;case 28:this.$=[[o[r]],null];break;case 29:o[r-1].push(o[r]),this.$=o[r-1];break;case 30:this.$=[o[r]];break;case 31:this.$=o[r];break;case 32:this.$=new s.StringNode(o[r]);break;case 33:this.$=new s.IntegerNode(o[r]);break;case 34:this.$=new s.BooleanNode(o[r]);break;case 35:this.$=o[r];break;case 36:this.$=new s.HashNode(o[r]);break;case 37:o[r-1].push(o[r]),this.$=o[r-1];break;case 38:this.$=[o[r]];break;case 39:this.$=[o[r-2],o[r]];break;case 40:this.$=[o[r-2],new s.StringNode(o[r])];break;case 41:this.$=[o[r-2],new s.IntegerNode(o[r])];break;case 42:this.$=[o[r-2],new s.BooleanNode(o[r])];break;case 43:this.$=[o[r-2],o[r]];break;case 44:this.$=new s.PartialNameNode(o[r]);break;case 45:this.$=new s.PartialNameNode(new s.StringNode(o[r]));break;case 46:this.$=new s.PartialNameNode(new s.IntegerNode(o[r]));break;case 47:this.$=new s.DataNode(o[r]);break;case 48:this.$=new s.IdNode(o[r]);break;case 49:o[r-2].push({part:o[r],separator:o[r-1]}),this.$=o[r-2];break;case 50:this.$=[{part:o[r]}]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function(t,e){throw new Error(t)},parse:function(t){function e(){var t;return t=i.lexer.lex()||1,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,s=[0],n=[null],o=[],a=this.table,r="",h=0,l=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;o.push(u);var p=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var d,f,g,m,_,v,b,y,E,w={};;){if(g=s[s.length-1],this.defaultActions[g]?m=this.defaultActions[g]:((null===d||"undefined"==typeof d)&&(d=e()),m=a[g]&&a[g][d]),"undefined"==typeof m||!m.length||!m[0]){var k="";if(!c){E=[];for(v in a[g])this.terminals_[v]&&v>2&&E.push("'"+this.terminals_[v]+"'");k=this.lexer.showPosition?"Parse error on line "+(h+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+E.join(", ")+", got '"+(this.terminals_[d]||d)+"'":"Parse error on line "+(h+1)+": Unexpected "+(1==d?"end of input":"'"+(this.terminals_[d]||d)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[d]||d,line:this.lexer.yylineno,loc:u,expected:E})}}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+d);switch(m[0]){case 1:s.push(d),n.push(this.lexer.yytext),o.push(this.lexer.yylloc),s.push(m[1]),d=null,f?(d=f,f=null):(l=this.lexer.yyleng,r=this.lexer.yytext,h=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(b=this.productions_[m[1]][1],w.$=n[n.length-b],w._$={first_line:o[o.length-(b||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(b||1)].first_column,
last_column:o[o.length-1].last_column},p&&(w._$.range=[o[o.length-(b||1)].range[0],o[o.length-1].range[1]]),_=this.performAction.call(w,r,l,h,this.yy,m[1],n,o),"undefined"!=typeof _)return _;b&&(s=s.slice(0,-1*b*2),n=n.slice(0,-1*b),o=o.slice(0,-1*b)),s.push(this.productions_[m[1]][0]),n.push(w.$),o.push(w._$),y=a[s[s.length-2]][s[s.length-1]],s.push(y);break;case 3:return!0}}return!0}},i=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e-1),this.offset-=e;var s=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===s.length?this.yylloc.first_column:0)+s[s.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-e]),this},more:function(){return this._more=!0,this},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,i,s,n;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),a=0;a<o.length&&(i=this._input.match(this.rules[o[a]]),!i||e&&!(i[0].length>e[0].length)||(e=i,s=a,this.options.flex));a++);return e?(n=e[0].match(/(?:\r\n?|\n).*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,o[s],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),t?t:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.options={},t.performAction=function(t,e,i,s){switch(i){case 0:return e.yytext="\\",14;case 1:if("\\"!==e.yytext.slice(-1)&&this.begin("mu"),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1),this.begin("emu")),e.yytext)return 14;break;case 2:return 14;case 3:return"\\"!==e.yytext.slice(-1)&&this.popState(),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1)),14;case 4:return e.yytext=e.yytext.substr(0,e.yyleng-4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:return 19;case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return e.yytext=e.yytext.substr(3,e.yyleng-5),this.popState(),15;case 14:return 22;case 15:return 37;case 16:return 36;case 17:return 36;case 18:return 40;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),31;case 23:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\'/g,"'"),31;case 24:return 38;case 25:return 33;case 26:return 33;case 27:return 32;case 28:return 36;case 29:return e.yytext=e.yytext.substr(1,e.yyleng-2),36;case 30:return"INVALID";case 31:return 5}},t.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],t.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}},t}();return e.lexer=i,t.prototype=e,e.Parser=t,new t}();t.Parser=o,t.parse=function(e){return e.constructor===t.AST.ProgramNode?e:(t.Parser.yy=t.AST,t.Parser.parse(e))},t.AST={},t.AST.ProgramNode=function(e,i){this.type="program",this.statements=e,i&&(this.inverse=new t.AST.ProgramNode(i))},t.AST.MustacheNode=function(t,e,i){this.type="mustache",this.escaped=!i,this.hash=e;var s=this.id=t[0],n=this.params=t.slice(1),o=this.eligibleHelper=s.isSimple;this.isHelper=o&&(n.length||e)},t.AST.PartialNode=function(t,e){this.type="partial",this.partialName=t,this.context=e},t.AST.BlockNode=function(e,i,s,n){var o=function(e,i){if(e.original!==i.original)throw new t.Exception(e.original+" doesn't match "+i.original)};o(e.id,n),this.type="block",this.mustache=e,this.program=i,this.inverse=s,this.inverse&&!this.program&&(this.isInverse=!0)},t.AST.ContentNode=function(t){this.type="content",this.string=t},t.AST.HashNode=function(t){this.type="hash",this.pairs=t},t.AST.IdNode=function(e){this.type="ID";for(var i="",s=[],n=0,o=0,a=e.length;a>o;o++){var r=e[o].part;if(i+=(e[o].separator||"")+r,".."===r||"."===r||"this"===r){if(s.length>0)throw new t.Exception("Invalid path: "+i);".."===r?n++:this.isScoped=!0}else s.push(r)}this.original=i,this.parts=s,this.string=s.join("."),this.depth=n,this.isSimple=1===e.length&&!this.isScoped&&0===n,this.stringModeValue=this.string},t.AST.PartialNameNode=function(t){this.type="PARTIAL_NAME",this.name=t.original},t.AST.DataNode=function(t){this.type="DATA",this.id=t},t.AST.StringNode=function(t){this.type="STRING",this.original=this.string=this.stringModeValue=t},t.AST.IntegerNode=function(t){this.type="INTEGER",this.original=this.integer=t,this.stringModeValue=Number(t)},t.AST.BooleanNode=function(t){this.type="BOOLEAN",this.bool=t,this.stringModeValue="true"===t},t.AST.CommentNode=function(t){this.type="comment",this.comment=t};var a=["description","fileName","lineNumber","message","name","number","stack"];t.Exception=function(t){for(var e=Error.prototype.constructor.apply(this,arguments),i=0;i<a.length;i++)this[a[i]]=e[a[i]]},t.Exception.prototype=new Error,t.SafeString=function(t){this.string=t},t.SafeString.prototype.toString=function(){return this.string.toString()};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},h=/[&<>"'`]/g,l=/[&<>"'`]/,c=function(t){return r[t]||"&amp;"};t.Utils={extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},escapeExpression:function(e){return e instanceof t.SafeString?e.toString():null==e||e===!1?"":(e=e.toString(),l.test(e)?e.replace(h,c):e)},isEmpty:function(t){return t||0===t?"[object Array]"===i.call(t)&&0===t.length?!0:!1:!0}};var u=t.Compiler=function(){},p=t.JavaScriptCompiler=function(){};u.prototype={compiler:u,disassemble:function(){for(var t,e,i,s=this.opcodes,n=[],o=0,a=s.length;a>o;o++)if(t=s[o],"DECLARE"===t.opcode)n.push("DECLARE "+t.name+"="+t.value);else{e=[];for(var r=0;r<t.args.length;r++)i=t.args[r],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),e.push(i);n.push(t.opcode+" "+e.join(" "))}return n.join("\n")},equals:function(t){var e=this.opcodes.length;if(t.opcodes.length!==e)return!1;for(var i=0;e>i;i++){var s=this.opcodes[i],n=t.opcodes[i];if(s.opcode!==n.opcode||s.args.length!==n.args.length)return!1;for(var o=0;o<s.args.length;o++)if(s.args[o]!==n.args[o])return!1}if(e=this.children.length,t.children.length!==e)return!1;for(i=0;e>i;i++)if(!this.children[i].equals(t.children[i]))return!1;return!0},guid:0,compile:function(t,e){this.children=[],this.depths={list:[]},this.options=e;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var s in i)this.options.knownHelpers[s]=i[s];return this.program(t)},accept:function(t){return this[t.type](t)},program:function(t){var e,i=t.statements;this.opcodes=[];for(var s=0,n=i.length;n>s;s++)e=i[s],this[e.type](e);return this.isSimple=1===n,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e,i=(new this.compiler).compile(t,this.options),s=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[s]=i;for(var n=0,o=i.depths.list.length;o>n;n++)e=i.depths.list[n],2>e||this.addDepth(e-1);return s},block:function(t){var e=t.mustache,i=t.program,s=t.inverse;i&&(i=this.compileProgram(i)),s&&(s=this.compileProgram(s));var n=this.classifyMustache(e);"helper"===n?this.helperMustache(e,i,s):"simple"===n?(this.simpleMustache(e),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(e,i,s),this.opcode("pushProgram",i),this.opcode("pushProgram",s),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(t){var e,i,s=t.pairs;this.opcode("pushHash");for(var n=0,o=s.length;o>n;n++)e=s[n],i=e[1],this.options.stringParams?(i.depth&&this.addDepth(i.depth),this.opcode("getContext",i.depth||0),this.opcode("pushStringParam",i.stringModeValue,i.type)):this.accept(i),this.opcode("assignToHash",e[0]);this.opcode("popHash")},partial:function(t){var e=t.partialName;this.usePartial=!0,t.context?this.ID(t.context):this.opcode("push","depth0"),this.opcode("invokePartial",e.name),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},mustache:function(t){var e=this.options,i=this.classifyMustache(t);"simple"===i?this.simpleMustache(t):"helper"===i?this.helperMustache(t):this.ambiguousMustache(t),t.escaped&&!e.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(t,e,i){var s=t.id,n=s.parts[0],o=null!=e||null!=i;this.opcode("getContext",s.depth),this.opcode("pushProgram",e),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",n,o)},simpleMustache:function(t){var e=t.id;"DATA"===e.type?this.DATA(e):e.parts.length?this.ID(e):(this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(t,e,i){var s=this.setupFullMustacheParams(t,e,i),n=t.id.parts[0];if(this.options.knownHelpers[n])this.opcode("invokeKnownHelper",s.length,n);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+n);this.opcode("invokeHelper",s.length,n)}},ID:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);var e=t.parts[0];e?this.opcode("lookupOnContext",t.parts[0]):this.opcode("pushContext");for(var i=1,s=t.parts.length;s>i;i++)this.opcode("lookup",t.parts[i])},DATA:function(e){if(this.options.data=!0,e.id.isScoped||e.id.depth)throw new t.Exception("Scoped data references are not supported: "+e.original);this.opcode("lookupData");for(var i=e.id.parts,s=0,n=i.length;n>s;s++)this.opcode("lookup",i[s])},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("pushLiteral",t.integer)},BOOLEAN:function(t){this.opcode("pushLiteral",t.bool)},comment:function(){},opcode:function(t){this.opcodes.push({opcode:t,args:[].slice.call(arguments,1)})},declare:function(t,e){this.opcodes.push({opcode:"DECLARE",name:t,value:e})},addDepth:function(t){if(isNaN(t))throw new Error("EWOT");0!==t&&(this.depths[t]||(this.depths[t]=!0,this.depths.list.push(t)))},classifyMustache:function(t){var e=t.isHelper,i=t.eligibleHelper,s=this.options;if(i&&!e){var n=t.id.parts[0];s.knownHelpers[n]?e=!0:s.knownHelpersOnly&&(i=!1)}return e?"helper":i?"ambiguous":"simple"},pushParams:function(t){for(var e,i=t.length;i--;)e=t[i],this.options.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.stringModeValue,e.type)):this[e.type](e)},setupMustacheParams:function(t){var e=t.params;return this.pushParams(e),t.hash?this.hash(t.hash):this.opcode("emptyHash"),e},setupFullMustacheParams:function(t,e,i){var s=t.params;return this.pushParams(s),this.opcode("pushProgram",e),this.opcode("pushProgram",i),t.hash?this.hash(t.hash):this.opcode("emptyHash"),s}};var d=function(t){this.value=t};p.prototype={nameLookup:function(t,e){return/^[0-9]+$/.test(e)?t+"["+e+"]":p.isValidJavaScriptVariableName(e)?t+"."+e:t+"['"+e+"']"},appendToBuffer:function(t){return this.environment.isSimple?"return "+t+";":{appendToBuffer:!0,content:t,toString:function(){return"buffer += "+t+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,i,s,n){this.environment=e,this.options=i||{},t.log(t.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!s,this.context=s||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,i);var o,a=e.opcodes;for(this.i=0,_=a.length;this.i<_;this.i++)o=a[this.i],"DECLARE"===o.opcode?this[o.name]=o.value:this[o.opcode].apply(this,o.args);return this.createFunctionContext(n)},nextOpcode:function(){var t=this.environment.opcodes;return t[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var t=[];if(this.isChild)t.push("");else{var e=this.namespace,i="helpers = this.merge(helpers, "+e+".helpers);";this.environment.usePartial&&(i=i+" partials = this.merge(partials, "+e+".partials);"),this.options.data&&(i+=" data = data || {};"),t.push(i)}this.environment.isSimple?t.push(""):t.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(e){var i=this.stackVars.concat(this.registers.list);if(i.length>0&&(this.source[1]=this.source[1]+", "+i.join(", ")),!this.isChild)for(var s in this.context.aliases)this.context.aliases.hasOwnProperty(s)&&(this.source[1]=this.source[1]+", "+s+"="+this.context.aliases[s]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var n=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],o=0,a=this.environment.depths.list.length;a>o;o++)n.push("depth"+this.environment.depths.list[o]);var r=this.mergeSource();if(!this.isChild){var h=t.COMPILER_REVISION,l=t.REVISION_CHANGES[h];r="this.compilerInfo = ["+h+",'"+l+"'];\n"+r}if(e)return n.push(r),Function.apply(this,n);var c="function "+(this.name||"")+"("+n.join(",")+") {\n  "+r+"}";return t.log(t.logger.DEBUG,c+"\n\n"),c},mergeSource:function(){for(var t,i="",s=0,n=this.source.length;n>s;s++){var o=this.source[s];o.appendToBuffer?t=t?t+"\n    + "+o.content:o.content:(t&&(i+="buffer += "+t+";\n  ",t=e),i+=o+"\n  ")}return i},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t),this.replaceStack(function(e){return t.splice(1,0,e),"blockHelperMissing.call("+t.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=["depth0"];this.setupParams(0,t);var e=this.topStack();t.splice(1,0,e),t[t.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+e+" = blockHelperMissing.call("+t.join(", ")+"); }")},appendContent:function(t){this.source.push(this.appendToBuffer(this.quotedString(t)))},append:function(){this.flushInline();var t=this.popStack();this.source.push("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(t){this.lastContext!==t&&(this.lastContext=t)},lookupOnContext:function(t){this.push(this.nameLookup("depth"+this.lastContext,t,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(t){return"typeof "+t+" === functionType ? "+t+".apply(depth0) : "+t})},lookup:function(t){this.replaceStack(function(e){return e+" == null || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")})},lookupData:function(t){this.push("data")},pushStringParam:function(t,e){this.pushStackLiteral("depth"+this.lastContext),this.pushString(e),"string"==typeof t?this.pushString(t):this.pushStackLiteral(t)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var t=this.hash;this.hash=e,this.options.stringParams&&(this.register("hashContexts","{"+t.contexts.join(",")+"}"),this.register("hashTypes","{"+t.types.join(",")+"}")),this.push("{\n    "+t.values.join(",\n    ")+"\n  }")},pushString:function(t){this.pushStackLiteral(this.quotedString(t))},push:function(t){return this.inlineStack.push(t),t},pushLiteral:function(t){this.pushStackLiteral(t)},pushProgram:function(t){null!=t?this.pushStackLiteral(this.programExpression(t)):this.pushStackLiteral(null)},invokeHelper:function(t,e){this.context.aliases.helperMissing="helpers.helperMissing";var i=this.lastHelper=this.setupHelper(t,e,!0),s=this.nameLookup("depth"+this.lastContext,e,"context");this.push(i.name+" || "+s),this.replaceStack(function(t){return t+" ? "+t+".call("+i.callParams+") : helperMissing.call("+i.helperMissingParams+")"})},invokeKnownHelper:function(t,e){var i=this.setupHelper(t,e);this.push(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(t,e){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var i=this.setupHelper(0,t,e),s=this.lastHelper=this.nameLookup("helpers",t,"helper"),n=this.nameLookup("depth"+this.lastContext,t,"context"),o=this.nextStack();this.source.push("if ("+o+" = "+s+") { "+o+" = "+o+".call("+i.callParams+"); }"),this.source.push("else { "+o+" = "+n+"; "+o+" = typeof "+o+" === functionType ? "+o+".apply(depth0) : "+o+"; }")},invokePartial:function(t){var e=[this.nameLookup("partials",t,"partial"),"'"+t+"'",this.popStack(),"helpers","partials"];this.options.data&&e.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+e.join(", ")+")")},assignToHash:function(t){var e,i,s=this.popStack();this.options.stringParams&&(i=this.popStack(),e=this.popStack());var n=this.hash;e&&n.contexts.push("'"+t+"': "+e),i&&n.types.push("'"+t+"': "+i),n.values.push("'"+t+"': ("+s+")")},compiler:p,compileChildren:function(t,e){for(var i,s,n=t.children,o=0,a=n.length;a>o;o++){i=n[o],s=new this.compiler;var r=this.matchExistingProgram(i);null==r?(this.context.programs.push(""),r=this.context.programs.length,i.index=r,i.name="program"+r,this.context.programs[r]=s.compile(i,e,this.context),this.context.environments[r]=i):(i.index=r,i.name="program"+r)}},matchExistingProgram:function(t){for(var e=0,i=this.context.environments.length;i>e;e++){var s=this.context.environments[e];if(s&&s.equals(t))return e}},programExpression:function(t){if(this.context.aliases.self="this",null==t)return"self.noop";for(var e,i=this.environment.children[t],s=i.depths.list,n=[i.index,i.name,"data"],o=0,a=s.length;a>o;o++)e=s[o],1===e?n.push("depth0"):n.push("depth"+(e-1));return(0===s.length?"self.program(":"self.programWithDepth(")+n.join(", ")+")"},register:function(t,e){this.useRegister(t),this.source.push(t+" = "+e+";")},useRegister:function(t){this.registers[t]||(this.registers[t]=!0,this.registers.list.push(t))},pushStackLiteral:function(t){return this.push(new d(t))},pushStack:function(t){this.flushInline();var e=this.incrStack();return t&&this.source.push(e+" = "+t+";"),this.compileStack.push(e),e},replaceStack:function(t){var e,i="",s=this.isInline();if(s){var n=this.popStack(!0);if(n instanceof d)e=n.value;else{var o=this.stackSlot?this.topStackName():this.incrStack();i="("+this.push(o)+" = "+n+"),",e=this.topStack()}}else e=this.topStack();var a=t.call(this,e);return s?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+i+a+")")):(/^stack/.test(e)||(e=this.nextStack()),this.source.push(e+" = ("+i+a+");")),e},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var t=this.inlineStack;if(t.length){this.inlineStack=[];for(var e=0,i=t.length;i>e;e++){var s=t[e];s instanceof d?this.compileStack.push(s):this.pushStack(s)}}},isInline:function(){return this.inlineStack.length},popStack:function(t){var e=this.isInline(),i=(e?this.inlineStack:this.compileStack).pop();return!t&&i instanceof d?i.value:(e||this.stackSlot--,i)},topStack:function(t){var e=this.isInline()?this.inlineStack:this.compileStack,i=e[e.length-1];return!t&&i instanceof d?i.value:i},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(t,e,i){var s=[];this.setupParams(t,s,i);var n=this.nameLookup("helpers",e,"helper");return{params:s,name:n,callParams:["depth0"].concat(s).join(", "),helperMissingParams:i&&["depth0",this.quotedString(e)].concat(s).join(", ")}},setupParams:function(t,e,i){var s,n,o,a=[],r=[],h=[];a.push("hash:"+this.popStack()),n=this.popStack(),o=this.popStack(),(o||n)&&(o||(this.context.aliases.self="this",o="self.noop"),n||(this.context.aliases.self="this",n="self.noop"),a.push("inverse:"+n),a.push("fn:"+o));for(var l=0;t>l;l++)s=this.popStack(),e.push(s),this.options.stringParams&&(h.push(this.popStack()),r.push(this.popStack()));return this.options.stringParams&&(a.push("contexts:["+r.join(",")+"]"),a.push("types:["+h.join(",")+"]"),a.push("hashContexts:hashContexts"),a.push("hashTypes:hashTypes")),this.options.data&&a.push("data:data"),a="{"+a.join(",")+"}",i?(this.register("options",a),e.push("options")):e.push(a),e.join(", ")}};for(var f="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),g=p.RESERVED_WORDS={},m=0,_=f.length;_>m;m++)g[f[m]]=!0;p.isValidJavaScriptVariableName=function(t){return!p.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(t)?!0:!1},t.precompile=function(e,i){if(null==e||"string"!=typeof e&&e.constructor!==t.AST.ProgramNode)throw new t.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);i=i||{},"data"in i||(i.data=!0);var s=t.parse(e),n=(new u).compile(s,i);return(new p).compile(n,i)},t.compile=function(i,s){function n(){var n=t.parse(i),o=(new u).compile(n,s),a=(new p).compile(o,s,e,!0);return t.template(a)}if(null==i||"string"!=typeof i&&i.constructor!==t.AST.ProgramNode)throw new t.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+i);s=s||{},"data"in s||(s.data=!0);var o;return function(t,e){return o||(o=n()),o.call(this,t,e)}},t.VM={template:function(e){var i={escapeExpression:t.Utils.escapeExpression,invokePartial:t.VM.invokePartial,programs:[],program:function(e,i,s){var n=this.programs[e];return s?n=t.VM.program(e,i,s):n||(n=this.programs[e]=t.VM.program(e,i)),n},merge:function(e,i){var s=e||i;return e&&i&&(s={},t.Utils.extend(s,i),t.Utils.extend(s,e)),s},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(s,n){n=n||{};var o=e.call(i,t,s,n.helpers,n.partials,n.data),a=i.compilerInfo||[],r=a[0]||1,h=t.COMPILER_REVISION;if(r!==h){if(h>r){var l=t.REVISION_CHANGES[h],c=t.REVISION_CHANGES[r];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+l+") or downgrade your runtime to an older version ("+c+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+")."}return o}},programWithDepth:function(t,e,i){var s=Array.prototype.slice.call(arguments,3),n=function(t,n){return n=n||{},e.apply(this,[t,n.data||i].concat(s))};return n.program=t,n.depth=s.length,n},program:function(t,e,i){var s=function(t,s){return s=s||{},e(t,s.data||i)};return s.program=t,s.depth=0,s},noop:function(){return""},invokePartial:function(i,s,n,o,a,r){var h={helpers:o,partials:a,data:r};if(i===e)throw new t.Exception("The partial "+s+" could not be found");if(i instanceof Function)return i(n,h);if(t.compile)return a[s]=t.compile(i,{data:r!==e}),a[s](n,h);throw new t.Exception("The partial "+s+" could not be compiled when running in runtime-only mode")}},t.template=t.VM.template}(Handlebars),Handlebars.registerHelper("compare",function(t,e,i,s){if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");try{switch(e.toString()){case"==":return t==i?s.fn(this):s.inverse(this);case"!=":return t!=i?s.fn(this):s.inverse(this);case"===":return t===i?s.fn(this):s.inverse(this);case"!==":return t!==i?s.fn(this):s.inverse(this);case"<":return i>t?s.fn(this):s.inverse(this);case"<=":return i>=t?s.fn(this):s.inverse(this);case">":return t>i?s.fn(this):s.inverse(this);case">=":return t>=i?s.fn(this):s.inverse(this);case"&&":return t&&i?s.fn(this):s.inverse(this);case"||":return t||i?s.fn(this):s.inverse(this);case"indexOf":return t.indexOf(i)>-1?s.fn(this):s.inverse(this);default:return s.inverse(this)}}catch(n){console.log("Errow: hbs.compare v1="+t+";v2="+i+n)}}),Handlebars.registerHelper("pagination",function(t,e,i,s){var n="",s=s,i=i;3===arguments.length&&(s=i,i=9);for(var o=Est.getPaginationNumber(t,e,i),a=0,r=o.length;r>a;a++)n+=s.fn(o[a]);return n}),Handlebars.registerHelper("get",function(t,e){if("undefined"==typeof t||"string"!==Est.typeOf(t))return t;var i=t.split(".");return i[0]in this?i.length>1?("object"!==Est.typeOf(this[i[0]])&&(this[i[0]]=JSON.parse(this[i[0]])),Est.getValue(this,t)):this[i[0]]:void 0}),Handlebars.registerHelper("dateFormat",function(t,e,i){return Est.dateFormat(t,e)}),Handlebars.registerHelper("contains",function(t,e,i){return Est.isEmpty(t)?void 0:Est.contains(t,e)?i.fn(this):i.inverse(this)}),Handlebars.registerHelper("plus",function(t,e,i){return parseInt(t,10)+parseInt(e,10)}),Handlebars.registerHelper("minus",function(t,e,i){return parseInt(t,10)-parseInt(e,10)+""}),Handlebars.registerHelper("cutByte",function(t,e,i){return Est.cutByte(t,e,i.hash.end||"...")}),Handlebars.registerHelper("x",function(t,e){var i,s=function(){};try{s=Function.apply(this,["window","return "+t+";"])}catch(n){console.warn("[warning] {{x "+t+"}} is invalid javascript",n)}try{i=s.bind(this)(window)}catch(n){console.warn("[warning] {{x "+t+"}} runtime error",n)}return i}),Handlebars.registerHelper("xif",function(t,e){return Handlebars.helpers.x.apply(this,[t,e])?e.fn(this):e.inverse(this)}),Handlebars.registerHelper("parseInt",function(t,e){return parseInt(t,10)}),Handlebars.registerHelper("id2",function(t){return null==t?"":t.replace(/^[^1-9]+/,"")}),Handlebars.registerHelper("CONST",function(t,e){return Est.getValue(CONST,t)}),Handlebars.registerHelper("picUrl",function(t,e,i){var s=t;if(arguments.length<3)return t||CONST.PIC_NONE;if(null==t||0==t.length)return CONST.PIC_NONE;if(e>10)s=s+"!"+e;else{var n=s.substring(s.lastIndexOf(".")+1,s.length);s=s.substring(0,s.lastIndexOf("."))+"_"+e+"."+n}return s?s:""}),Handlebars.registerHelper("_picUrl",function(t,e,i){return CONST.PIC_URL+"/"+Handlebars.helpers.picUrl.apply(this,[t,e,i])}),Handlebars.registerHelper("PIC",function(t,e,i){var s="";return t&&(s+=t.indexOf("?")>-1?"&v="+Est.hash(CONST.APP_VERSION):"?v="+Est.hash(CONST.APP_VERSION),Est.startsWidth(t,"CONST")&&(t=Handlebars.helpers.CONST.apply(this,[t.replace("CONST.",""),i]))),t&&/[^\s]+\.(?:jpe?g|gif|png|bmp)/i.test(t)?(Est.startsWidth(t,"http")&&t.indexOf("upload")>-1&&(t=t.substring(t.indexOf("upload"),t.length)),Est.startsWidth(t,"upload")?arguments.length<3?CONST.PIC_URL+"/"+t+s:Handlebars.helpers._picUrl.apply(this,[t,e,i])+s:Est.startsWidth(t,"http")?t+s:CONST.DOMAIN+t+s):CONST.DOMAIN+CONST.PIC_NONE+s}),Handlebars.registerHelper("isEmpty",function(t,e){return Est.isEmpty(t)?e.fn(this):e.inverse(this)}),Handlebars.registerHelper("encodeUrl",function(t,e){return encodeURIComponent(t)}),Handlebars.registerHelper("json",function(t,e){return Handlebars.helpers.get.call(this,t)}),Handlebars.registerHelper("version",function(t,e){switch(t){case"time":return(new Date).getTime();case"hash":return Est.hash((new Date).getTime());default:return Est.hash((new Date).getTime())}}),Handlebars.registerHelper("stripScripts",function(t,e){return Est.stripScripts(t)}),Handlebars.registerHelper("replace",function(t,e,i,s){return t.replace(new RegExp(e,"img"),i)}),Handlebars.registerHelper("default",function(t,e,i){return Est.isEmpty(t)?e:t}),Handlebars.registerHelper("keyMap",function(t,e,i){return t&&e?e[t]:""});var BaseApp=function(t){this.options=t,Est.extend(this,t),this.initialize.apply(this,arguments)};Est.extend(BaseApp.prototype,{initialize:function(){this.data={itemActiveList:[],sessionId:""},this.instance={},this.modules={},this.routes={},this.templates={},this.panels={},this.dialog=[],this.dialogs={},this.status={},this.cookies=[],this.models=[],this.compileTemps={},this.filters={navigator:[],form:[]},this.cache={}},getAppType:function(){return"backbone"},addRegion:function(t,e,i){var s=Est.nextUid("region");return i.__panelId||(i.__panelId=i.el),i.diff&&app.getView(i.viewId||t)?(app.getView(i.viewId||t)._extend(i),void app.getView(i.viewId||t)._reset(i.data)):(this.addPanel(t,{el:i.__panelId,template:'<div class="region '+s+'"></div>'},i),i.viewId||(i.viewId=t),
i.viewId in this.instance&&this.removeView(i.viewId),this.addView(i.viewId,new e(i)))},addPanel:function(t,e,i){var s="string"===Est.typeOf(e.cid)?!1:!0;return i=i||{},s&&(this.removePanel(t,e),e.$template=$(e.template),i&&(i.el=e.$template),e.$template.addClass("__panel_"+t),e.$template.attr("data-view",i.viewId||t),i&&"boolean"===Est.typeOf(i.append)&&!i.append&&$(e.el).empty(),$(e.el).append(e.$template)),this.panels[t]=e,s?this:e},removePanel:function(t,e){try{var i=[];e||(e=this.panels[t]),"body"!==e.el&&($(".region",$(e.el)).each(function(){i.push($(this).attr("data-view"))}),i.reverse(),Est.each(i,function(t){app.getView(t)&&app.getView(t).destroy&&app.getView(t).destroy(),app.removeView(t)})),$(".__panel_"+t,$(e.el)).off().remove(),delete this.panels[t]}catch(s){console.error(s)}},addView:function(t,e){return t in this.instance&&this.removeView(t),this.instance[t]=e,this.setCurrentView(t),this.instance[t]},removeView:function(t){try{this.getView(t)&&(this.getView(t).destroy&&this.getView(t).destroy(),this.getView(t)._empty(),this.getView(t).stopListening(),this.getView(t).$el.off().remove()),delete this.instance[t]}catch(e){console.log(e)}return this},panel:function(t,e){return this.addPanel(t,e)},show:function(t){this.addView(this.currentView,t)},getPanel:function(t){return this.panels[t]},add:function(t,e){return this.addView(t,e)},setCurrentView:function(t){this.currentView=t},getCurrentView:function(){return this.currentView},getView:function(t){return this.instance[t]},addDialog:function(t,e){return this.dialog.push(t),e&&(app.addData("_curDialog",e),this.dialogs[e]=t),t},getDialogs:function(){return this.dialog},getDialog:function(t){return Est.isEmpty(t)?this.dialogs:this.dialogs[t]},getCurrentDialog:function(){return app.getData("_curDialog")?this.dialogs[app.getData("_curDialog")]:null},emptyDialog:function(){Est.each(this.dialog,function(t){t&&t.close&&t.close().remove()}),this.dialog=[],this.dialogs={},app.addData("_curDialog",null)},addModel:function(t){return this.models.push(t),t},getModels:function(){return this.models},addData:function(t,e){t in this.data&&debug("reset data "+t),this.data[t]=e},getData:function(t){return this.data[t]},addModule:function(t,e){t in this.modules&&debug("Error10 module="+t),this.modules[t]=e},getModules:function(){return this.modules},addRoute:function(t,e){t in this.routes&&debug("Error13 "+t),this.routes[t]=e},getRoutes:function(){return this.routes},addTemplate:function(t,e){t in this.templates&&debug("Error11 template name:"+t),this.templates[t]=e},getTemplates:function(){return this.templates},addSession:function(t,e,i){try{var s="undefined"===Est.typeOf(i)?"":i?this.data.sessionId:"";localStorage["___JHW_BACKBONE__"+Est.hash(s+t)]=e}catch(n){debug("Error9 "+n)}return e},getSession:function(t,e){var i="undefined"===Est.typeOf(e)?"":e?this.data.sessionId:"";return localStorage["___JHW_BACKBONE__"+Est.hash(i+t)]},addCompileTemp:function(t,e){this.compileTemps[t]=e},getCompileTemp:function(t){return this.compileTemps[t]},addStatus:function(t,e){this.status[t]=e},getStatus:function(t){return this.status[t]},getAllStatus:function(){return this.status},addOption:function(t,e){this.options[t]=e},getOption:function(t){return Est.cloneDeep(this.options[t])},addFilter:function(t,e){this.filters[t].push(e)},getFilters:function(t){return this.filters[t]},getParamsHash:function(t){var e="",i="";for(var s in t)e+=t[s];return i="_hash"+Est.hash(e)},addCache:function(t,e){try{var i="";if(!e.success)return;i=this.getParamsHash(t),t.session&&e?app.addSession(i,JSON.stringify(e)):this.cache[i]=e}catch(s){debug("Error12"+s)}},getCache:function(t){var e=null,i=this.getParamsHash(t);return!t.session||app.getData("versionUpdated")?this.cache[i]:(e=app.getSession(i))?JSON.parse(e):void 0},removeCache:function(t){var e=null;return t?(e=this.getParamsHash(t),void delete this.cache[e]):void(this.cache={})},addCookie:function(t){-1===Est.findIndex(this.cookies,t)&&this.cookies.push(t)},getCookies:function(){return this.cookies}});var BaseUtils={dialog:function(t){var e=t.button||[];seajs.use(["dialog-plus"],function(i){t.success&&e.push({value:CONST.LANG.CONFIRM,autofocus:!0,callback:function(){t.success.apply(this,arguments)}}),t.hideCloseBtn||e.push({value:CONST.LANG.CLOSE,callback:function(){this.close().remove()}}),t=Est.extend({id:t.id||t.moduleId||Est.nextUid("dialog"),title:CONST.LANG.DIALOG_TIP,width:150,content:"",button:e},t),t.target&&(t.target=$(t.target).get(0)),t.oniframeload=function(){try{this.iframeNode.contentWindow.topDialog=thisDialog,this.iframeNode.contentWindow.app=app,delete app.getRoutes().index}catch(e){}"function"==typeof t.load&&t.load.call(this,arguments)},t.cover?app.addDialog(i(t),t.viewId||t.id).showModal(t.target):app.addDialog(i(t),t.viewId||t.id).show(t.target)})},tip:function(t,e){e=Est.extend({id:"tip-dialog"+Est.nextUid(),time:3e3,content:'<div style="padding: 10px;">'+t+"</div>",title:null},e),seajs.use(["dialog-plus"],function(t){window.tipsDialog&&window.tipsDialog.close().remove(),window.tipsDialog=app.addDialog(t(e)).show(e.target),setTimeout(function(){window.tipsDialog.close().remove()},e.time)})},confirm:function(t,e){var i={title:CONST.LANG.WARM_TIP,content:CONST.LANG.DEL_CONFIRM,success:function(){},target:null};Est.extend(i,t),e||(e=this),seajs.use(["dialog-plus"],function(s){window.comfirmDialog=app.addDialog(s({id:"dialog"+Est.nextUid(),title:i.title,content:'<div style="padding: 20px;">'+i.content+"</div>",width:i.width||200,button:[{value:t.successValue||CONST.LANG.CONFIRM,autofocus:!0,callback:function(){i.success&&i.success.call(e)}},{value:t.cancelValue||CONST.LANG.CANCEL,callback:function(){window.comfirmDialog.close().remove(),i.cancel&&i.cancel.call(e)}}],onClose:function(){i.cancel&&i.cancel.call(e)}})).show(i.target)})},addLoading:function(t){try{window.$loading&&window.$loading.remove(),window.$loading=$('<div id="loading" class="loading"><div class="object" id="object_one"></div><div class="object" id="object_two"></div><div class="object" id="object_three"></div></div>'),$("body").append(window.$loading)}catch(e){debug("Error28"+e)}return window.$loading},removeLoading:function(t){window.$loading?window.$loading.remove():$(".loading").remove()},execute:function(t){return debug("- BaseUtils.execute "+t),BaseUtils[t]&&BaseUtils[t].apply(BaseUtils,[].slice.call(arguments,1))}},BaseService=function(){return"object"==typeof BaseService.instance?BaseService.instance:(debug("build BaseService instance"),void(BaseService.instance=this))};BaseService.prototype={ajax:function(t){var e=Est.extend({_method:"GET"},t);return $.ajax({type:"post",url:t.url,async:!1,cache:t.cache,data:e,success:function(t){}})},initTree:function(t,e){t.tree&&(e.attributes.data=Est.bulidTreeNode(e.attributes.data,t.rootKey,t.rootValue,{categoryId:t.categoryId,belongId:t.belongId,childTag:t.childTag,sortBy:t.sortBy,callback:function(e){t.tree&&(e.text=e[t.text],e.value=e[t.value])}}))},initSelect:function(t,e){t.select&&(Est.each(e.attributes.data,function(e){e.text=e[t.text],e.value=e[t.value]}),t.tree&&(e.attributes.data=Est.bulidSelectNode(e.attributes.data,1,{name:"text"})))},initExtend:function(t,e){t.extend&&(e.attributes.data=Est.extendTree(e.attributes.data))},initDefault:function(t,e){e.attributes&&t.defaults&&"array"===Est.typeOf(e.attributes.data)&&e.attributes.data.unshift({text:CONST.LANG.SELECT_DEFAULT,value:t.defaultValue})},factory:function(t){var e=this,i=Est.promise,s="",n="",o=null;t=Est.extend({select:!1,extend:!1,defaults:!1,tree:!1,defaultValue:null,cache:!1},t);for(var a in t)s+=t[a];return n="_hash"+Est.hash(s),new i(t.session&&!app.getData("versionUpdated")&&(o=app.getSession(n))?function(t,e){t(JSON.parse(o))}:function(i,s){CONST.DEBUG_LOCALSERVICE?i([]):e.ajax(t).done(function(s){var o=null;return"string"===Est.typeOf(s)?(t.session&&s.attributes&&app.addSession(n,s),void i(s)):(s.attributes?(e.initTree(t,s),e.initSelect(t,s),e.initExtend(t,s)):(s.attributes=s.attributes||{},s.attributes.data=[]),e.initDefault(t,s),o=s.attributes?s.attributes.data:s,t.session&&s.attributes&&app.addSession(n,JSON.stringify(o)),void i(o))})})},query:function(t){var e=this,i=Est.promise,s="",n="",o=null;t=Est.extend({cache:!1},t);for(var a in t)s+=t[a];return n="_hash"+Est.hash(s),new i(t.session&&!app.getData("versionUpdated")&&(o=app.getSession(n))?function(t,e){t(JSON.parse(o))}:function(i,s){CONST.DEBUG_LOCALSERVICE?i([]):e.ajax(t).done(function(e){e.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),t.session&&e&&app.addSession(n,JSON.stringify(e)),i(e)})})}};var SuperView=Backbone.View.extend({constructor:function(t){this.options=t||{},this.init&&"function"!==Est.typeOf(this.init)&&this._initialize(this.init),Backbone.View.apply(this,arguments)},initialize:function(){this._initialize()},_super:function(){return this},_extend:function(t){Est.extend(this.options,t)},_navigate:function(t,e){e=e||!0,Backbone.history.navigate(t,e)},_dialog:function(t,e){var i=e||this,s=t.viewId?t.viewId:"string"===Est.typeOf(t.id)?t.id:t.moduleId;"function"===Est.typeOf(s)&&(s=Est.nextUid("dialog_view")),t=Est.extend({width:"auto",title:null,cover:!1,autofocus:!1,hideOkBtn:!0,hideCloseBtn:!0,button:[],quickClose:t.cover?!1:"boolean"===Est.typeOf(t.autofocus)?t.quickClose:!1,skin:"dialog_min"},t),t=Est.extend(t,{el:"#base_item_dialog"+s,content:t.content||'<div id="'+s+'"></div>',viewId:s,onshow:function(){try{var e=t.onShow&&t.onShow.call(this,t);if("undefined"!=typeof e&&!e)return;"function"===Est.typeOf(t.moduleId)?(t.id=t.id||t.viewId,app.addPanel(t.id,{el:"#"+t.id,template:'<div id="base_item_dialog'+t.id+'" class="region '+t.id+'"></div>'}).addView(t.id,new t.moduleId(t))):"string"===Est.typeOf(t.moduleId)&&seajs.use([t.moduleId],function(e){try{e||console.error(t.moduleId+" is not defined"),app.addPanel(t.viewId,{el:"#"+t.viewId,template:'<div id="base_item_dialog'+t.viewId+'" class="region"></div>'}).addView(t.viewId,new e(t))}catch(i){console.error(i)}})}catch(i){console.log(i)}},onclose:function(){app.getPanel(t.viewId)&&app.removePanel(t.viewId),t.onClose&&t.onClose.call(i,t),app.getDialogs().pop()}}),BaseUtils.dialog(t)},_singleBind:function(t,e,i,s){var n=this;$(e,t||this.$el).each(function(){var t=[],e=$(this).attr("bb-model"),i=$(this).attr("data-bind-type")||"change";Est.isEmpty(e)||(t=e.split(":"),i=t.length>1?t[1]:"change"),$(this).off(i).on(i,function(t){var e,i,o,a,r;if(37===t.keyCode||39===t.keyCode||38===t.keyCode||40===t.keyCode)return!1;if(o=$(this).attr("id"),r=$(this).attr("bb-model"),Est.isEmpty(r)||(r=r.split(":")[0]),r||o&&-1!==o.indexOf("model")){switch(this.type){case"radio":e=$(this).is(":checked")?$(this).val():i=!0;break;case"checkbox":e=$(this).is(":checked")?Est.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):Est.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:e=$(this).val()}i||(a=r||o.replace(/^model\d?-(.+)$/g,"$1"),n._setValue(a,e),s&&s.call(n,a),n.update&&n.update.call(n,a))}})})},_modelBind:function(t,e,i){var s=this;e?this._singleBind(t,e,this.model,i):this.$("input, textarea, select").each(function(){s._singleBind(null,$(this),s.model,i)})},_viewReplace:function(t,e,i,s){try{Est.each(t.split(","),Est.proxy(function(t){var i=[],s="",n="",o=[],a="",r="";if(!Est.isEmpty(t))if(t.indexOf("]:")>-1?(o=t.split("]:"),i=Est.map(o,function(t,e){return e!==o.length-1?t+"]":t})):i=t.split(":"),n=Est.hash(t),i.length>1)for(var h=1;h<i.length;h++){if(n=Est.hash(i[0]+i[h]),r=i[h],Est.msie()?(a="ng-"+r,this["h_temp_"+n]||(s=this._options.template.replace(new RegExp("\\s"+i[h]+"=","img")," ng-"+i[h]+"="))):(a=r,s=this.$template),!this["h_temp_"+n])switch(r){case"html":this["h_temp_"+n]=Handlebars.compile($(s).find(i[0]).html());break;case"checked":this["h_temp_"+n]=Handlebars.compile("checked:{{#if "+/bb-checked=\"(.*?)\"\s?/gim.exec(i[0])[1]+"}}true{{else}}false{{/if}}");break;default:this["h_temp_"+n]=Handlebars.compile($(s).find(i[0]).attr(a))}if(_result=this["h_temp_"+n](e.attributes),this["h_temp_r_"+n]===_result)return void console.log("[ignore]"+i[0]+":"+r+" & result=>"+_result);switch(console.log("[replace]"+i[0]+":"+r+" & result=>"+_result),r){case"value":this.$(i[0]).val(_result);break;case"html":this.$(i[0]).html(_result);break;case"checked":this.$(i[0]).prop("checked",this._getValue(/bb-checked=\"(.*?)\"\s?/gim.exec(i[0])[1]));break;default:this.$(i[0]).attr(i[h],_result)}this["h_temp_r_"+n]=_result}else{if(Est.msie()?(r="ng-style",this["h_temp_"+n]||(s=this.$template.replace(new RegExp("\\sstyle=","img")," "+r+"=")),this["h_temp_"+n]=this["h_temp_"+n]||Handlebars.compile($(s).find(t).wrapAll("<div>").parent().html().replace(/ng-style/gim,"style"))):this["h_temp_"+n]=this["h_temp_"+n]||Handlebars.compile($(this.$template).find(t).wrapAll("<div>").parent().html()),_result=this["h_temp_"+n](e.attributes),this["h_temp_r_"+n]===_result)return;this.$(t).replaceWith(_result),this["h_temp_r_"+n]=_result}},this)),i&&Est.each(i,function(t){t.call(this,s)},this)}catch(n){console.log(n)}},_watch:function(t,e,i){var s,n=this,o=null,a={},r=[];"array"===Est.typeOf(t)?r=t:r.push(t),this.cbMap=this.cbMap||{},this.watchFields=this.watchFields||{},Est.each(r,function(t){var r=t.replace(/^#?model\d?-(.+)$/g,"$1");i&&(this.cbMap[r]=this.cbMap[r]||[],"string"===Est.typeOf(i)?(o=Est.hash(r+i),o in this.cbMap||(this.cbMap[o]=!0,this.cbMap[r].push(this[i]))):this.cbMap[r].push(i)),r in this.watchFields?Est.each(e.split(","),function(t){-1===this.watchFields[r].indexOf(t)&&(this.watchFields[r]=this.watchFields[r]+","+t)},this):this.watchFields[r]=e,e=this.watchFields[r],s=n.cid+r,s in a||(Est.off(a[s]=s).on(s,function(t,i){n._viewReplace(e,n.model,n.cbMap[r],r),n.update&&n.update.call(n,r)}),n.model.off("change:"+(a[r]=r.split(".")[0])).on("change:"+a[r],function(){n._viewReplace(e,n.model,n.cbMap[r],r),n.update&&n.update.call(n,r)}))},this)},_watchBind:function(t){var e=[],i=[];this.cbMap={},this.watchFields={},"string"===Est.typeOf(t)&&(i=t.match(new RegExp('(bb-watch=\\"(.+?)"(\\s*)|bb-change=\\"(.+?)"(\\s*)|bb-model=\\"(.+?)"(\\s*))(bb-action=\\"(.+?)\\"\\s*)?(bb-change=\\"(.+?)\\"\\s*)?',"img")),Est.each(i,this._bind(function(t){var i="",s="",n="",o="";i=/bb-watch=\"(.*?)\"\s?/gim.exec(t)||"",o=/bb-action=\"(.*?)\"\s?/gim.exec(t)||"",n=/bb-change=\"(.*?)\"\s?/gim.exec(t)||"",s=/bb-model=\"(.*?)\"\s?/gim.exec(t)||"",Est.isEmpty(i)&&Est.isEmpty(s)||e.push({watch:i.length>1?i[1]:s[1].split(":")[0],action:o.length>1?o[1]:"",change:n.length>1?n[1]:null})}))),Est.each(e,this._bind(function(t){this._watch(t.watch.split(","),t.action,Est.isEmpty(t.change)?null:t.change)})),this.onWatch&&this.onWatch.call(this,arguments)},_bbBind:function(t,e){var i,s,n,o={};if(this.bbList=[],"string"===Est.typeOf(t)){for(i=new RegExp('\\bbb-([\\w\\.]+)=\\"([\\w\\.:]+?)\\"\\s?',"img");null!==(n=i.exec(t));)this.bbList.push({name:n[1],value:n[2]});Est.each(this.bbList,this._bind(function(t){if(s=Est.hash(t.name+t.value),!(s in o))switch(o[s]=t,t.name){case"watch":break;case"action":break;case"change":break;case"show":console.log("name:"+t.name+";value:"+t.value);break;case"model":this._modelBind(e,'[bb-model="'+t.value+'"]'),this._watch([t.value.split(":")[0]],'[bb-model="'+t.value+'"]:value');break;case"checked":this._watch([t.value],'[bb-checked="'+t.value+'"]:checked'),this.$('[bb-checked="'+t.value+'"]').prop("checked",this._getValue(t.value));break;default:this[t.value]&&e.find("[bb-"+t.name+'="'+t.value+'"]').off(t.name).on(t.name,this._bind(this[t.value]))}}))}},_stringifyJSON:function(t){var e,i;JSON.stringify||alert(CONST.LANG.JSON_TIP),Est.each(t,function(t){e=t.split("."),e.length>1?(i=Est.getValue(this.model.attributes,t),Est.setValue(this.model.attributes,t,JSON.stringify(i))):Est.setValue(this.model.attributes,t,JSON.stringify(this.model.get(t)))},this)},_parseJSON:function(t){var e,i,s=JSON.parse||$.parseJSON;s||alert(CONST.LANG.JSON_TIP),Est.each(t,function(t){e=t.split("."),e.length>1?(i=Est.getValue(this.model.attributes,t),"string"===Est.typeOf(i)&&Est.setValue(this.model.attributes,t,s(i))):"string"===Est.typeOf(this.model.get(t))&&this.model.set(t,s(this.model.get(t)))},this)},_setOption:function(t){return Est.extend(this._options,t),this},_initEnterEvent:function(t){t.speed>1&&t.enterRender&&this.$("input").keyup($.proxy(function(e){e.keyCode===CONST.ENTER_KEY&&this.$(t.enterRender).click()},this))},_getOption:function(t){return this._options[t]},_getValue:function(t){return Est.getValue(this.model.attributes,t)},_get:function(t){return this._getValue.call(this,t)},_getDefault:function(t,e){return this._setDefault(t,e),Est.getValue(this.model.attributes,t)},_setDefault:function(t,e){var i=Est.getValue(this.model.attributes,t);("undefined"===Est.typeOf(i)||"null"===Est.typeOf(i))&&Est.setValue(this.model.attributes,t,e)},_initDefault:function(){this.init&&"function"===Est.typeOf(this.init)&&(this.__def_vals_=this.init.call(this)||{},Est.each(this.__def_vals_,this._bind(function(t,e){this._setDefault(e,t)})))},_reset:function(t){var e=[],i={};for(this.model.attributes={},t=Est.extend(Est.extend(this.model.defaults||{},this.__def_vals_),t),i=t;Est.keys(i).length>0;)t=i,Est.each(t,function(t,s){"object"===Est.typeOf(t)?Est.each(t,function(t,e){i[s+"."+e]=t}):e.push({path:s,value:t}),delete i[s]});Est.each(e,this._bind(function(t){this._set(t.path,t.value)}))},_setValue:function(t,e){Est.equal(Est.getValue(this.model.attributes,t),e)||(Est.setValue(this.model.attributes,t,e),Est.trigger(this.cid+t,t),this._m_change_=!0)},_set:function(t,e){this._m_change_=!1,"object"===Est.typeOf(t)?this._baseSetValues(t):this._setValue(t,e),this._m_change_&&this.options.onChange&&this.options.onChange.call(this,this.model.toJSON())},_baseSetValues:function(t){Est.each(t,this._bind(function(t,e){this._setValue(e,t)}))},_setValues:function(t){this._baseSetValues(t),this._options.onChange&&this._options.onChange.call(this,t)},_setAttr:function(t,e){"string"===Est.typeOf(t)?Est.setValue(this.model.attributes,t,e):Est.each(t,this._bind(function(t,e){Est.setValue(this.model.attributes,e,t)})),this._options.onChange&&this._options.onChange.call(this,t)},_getLength:function(){return this.collection.models.length},_getTarget:function(t){return t.target?$(t.target):$(t.currentTarget)},_getEventTarget:function(t){return t.currentTarget?$(t.currentTarget):$(t.target)},_one:function(t,e){try{var i,s="array"===Est.typeOf(t),n=[],o=null;i=s?t.join("_"):t,o="_one_"+i,this[o]="undefined"===Est.typeOf(this[o])?!0:!1,this[o]&&(s?(Est.each(t,function(t){n.push(t.replace(/^(.+)-(\d+)?$/g,"$1"))}),this._require(n,e)):e&&e.call(this))}catch(a){debug("SuperView._one "+JSON.stringify(t)+a,{type:"error"})}},_require:function(t,e){seajs.use(t,Est.proxy(e,this))},_delay:function(t,e){setTimeout(Est.proxy(function(){setTimeout(Est.proxy(function(){t&&t.call(this)},this),e)},this),0)},_bind:function(t){return Est.proxy(t,this)},_initToolTip:function(t,e){var i=e||".tool-tip",s=t?$(i,t):this.$(i);s.hover(function(t){var e=$(this).attr("data-title")||$(this).attr("title"),i=$(this).attr("data-offset")||0;Est.isEmpty(e)||(BaseUtils.dialog({id:Est.hash(e||"error:446"),title:null,width:"auto",offset:parseInt(i,10),skin:"tool-tip-dialog",align:$(this).attr("data-align")||"top",content:'<div style="padding: 5px 6px;;font-size: 12px;">'+e+"</div>",hideCloseBtn:!0,autofocus:!1,target:$(this).get(0)}),app.getData("toolTipList")||app.addData("toolTipList",[]),app.getData("toolTipList").push(Est.hash(e)),$(window).one("click",Est.proxy(function(){Est.each(app.getData("toolTipList"),function(t){app.getDialog(t)&&app.getDialog(t).close()}),app.addData("toolTipList",[])},this)))},function(){try{app.getDialog(Est.hash($(this).attr("data-title")||$(this).attr("title"))).close()}catch(t){}})},_empty:function(){},render:function(){this._render()}}),BaseView=SuperView.extend({_initialize:function(t){return this._initOptions(t),this._initTemplate(this._options.template),this._initModel(this._options.data,Backbone.Model.extend({fields:this._options.fields})),this._initBind(this._options),this.render(),this},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.data=this._options.data||{}},_initTemplate:function(t){t&&(this.template=Handlebars.compile(t),this.$template="<div>"+t+"</div>")},_initModel:function(t,e){t&&(t.CONST=CONST),this.model=new e(t)},_initBind:function(t){this.model.bind("reset",this.render,this)},_render:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this._options),this._options.append?this.$el.append(this.template(this.model.attributes)):this.$el.html(this.template(this.model.attributes)),this._options.modelBind&&this._modelBind(),this.afterRender&&this.afterRender.call(this,this._options),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el),this._options.toolTip&&this._initToolTip(),this._initEnterEvent(this._options),BaseUtils.removeLoading()},render:function(){this._render()}}),BaseList=SuperView.extend({_initialize:function(t){return debug("1.BaseList._initialize"),this.dx=0,this.views=[],this._initOpt(t.collection,t)},_initOpt:function(t,e){return this._initOptions(e),this._initDataModel(Backbone.Model.extend({})),this._initTemplate(this._options),this._initEnterEvent(this._options,this),this._initList(this._options),this._initCollection(this._options,t),this._initItemView(this._options.item,this),this._initModel(this._options.model),this._initBind(this.collection),this._initPagination(this._options),this._load(this._options),this},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.sortField="sort",this._options.max=this._options.max||99999,this._options.speed=this._options.speed||9},_initDataModel:function(t){this._options.data&&(this._options.data.CONST=CONST),this.model=new t(this._options.data)},_getTemp:function(){},_getIeTemp:function(){},_initTemplate:function(t){return this._data=t.data=t.data||{},t.template&&(this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this),this.$template=$("<div>"+t.template+"</div>"),this._options.render?(Est.msie()?(this.__template=t.template.replace(new RegExp("\\sstyle=","img")," ng-style="),this._options.itemTemp=$("<div>"+this.__template+"</div>").find(this._options.render).html(),Est.isEmpty(this._options.itemTemp)||(this._options.itemTemp=this._options.itemTemp.replace(/ng-style/gim,"style"))):this._options.itemTemp=this.$template.find(this._options.render).html(),this.$template.find(this._options.render).empty()):(Est.msie()?(this.__template=t.template.replace(new RegExp("\\sstyle=","img")," ng-style="),this._options.itemTemp=$("<div>"+this.__template+"</div>").html(),Est.isEmpty(this._options.itemTemp)||(this._options.itemTemp=this._options.itemTemp.replace(/ng-style/gim,"style"))):this._options.itemTemp=this.$template.html(),this.$template.empty()),this.template=Handlebars.compile(Est.isEmpty(this._options.itemTemp)?t.template:this.$template.html()),this._options.append?(this.$el.empty(),this.$el.append(this.template(this.model.attributes))):this.$el.html(this.template(this.model.attributes))),this._options.modelBind&&this._modelBind(),this._data},_initEnterEvent:function(t,e){t.enterRender&&e.$("input").keyup(function(i){i.keyCode===CONST.ENTER_KEY&&e.$(t.enterRender).click()})},_initList:function(t){var e=this;return this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render)),debug(function(){return e.list&&0!==e.list.size()?void 0:"Error1"},{type:"error"}),this.list},_initCollection:function(t,e){return debug(function(){return t.model?void 0:"Error2"},{type:"error"}),(!this.collection||this.collection&&!this.collection.remove)&&(this.collection=new e(t)),t.itemId&&this.collection._setItemId(t.itemId),t.subRender&&(this.composite=!0),this.collection},_initItemView:function(t){this.item=t},_initModel:function(t){this.initModel=t},_initBind:function(t){t&&(t.bind("add",this._addOne,this),t.bind("reset",this._render,this))},_initPagination:function(t){var e=this;e.collection&&e.collection.paginationModel&&e.collection.paginationModel.on("reloadList",function(i){e._setValue("checked_all",!1),e._clear.call(e),e._load.call(e,t,i)})},_load:function(t,e){var i=this;t=t||this._options||{},this._beforeLoad(t),(t.page||t.pageSize)&&(t.page&&i.collection.paginationModel.set("page",t.page||1),t._page=t.page,t.pageSize&&i.collection.paginationModel.set("pageSize",t.pageSize||16),t._pageSize=t.pageSize,e=i.collection.paginationModel,t.page=t.pageSize=null),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el),this._options.items&&(this._empty(),this._initItems()),this._options.viewId&&i.collection.paginationModel&&i.collection.paginationModel.get("pageSize")<999&&(app.addCookie(this._options.viewId+"_page"),Est.cookie(this._options.viewId+"_page",i.collection.paginationModel.get("page")),app.addCookie(this._options.viewId+"_pageSize"),Est.cookie(this._options.viewId+"_pageSize",i.collection.paginationModel.get("pageSize"))),i.collection.url&&!this._options.items?(i._options.filter&&(i.filter=!0),i._options.subRender&&(i.composite=!0,i.collection.paginationModel.set("page",1),i.collection.paginationModel.set("pageSize",9e3)),debug(function(){return"[Query]"+("function"===Est.typeOf(i.collection.url)?i.collection.url():i.collection.url)}),i.collection._load(i.collection,i,e).done(function(e){e&&e.msg&&e.msg===CONST.LANG.AUTH_FAILED&&BaseUtils.tip(CONST.LANG.AUTH_LIMIT+"！",{time:2e3}),i.list.find(".no-result").remove();try{(Est.isEmpty(e)||Est.isEmpty(e.attributes)||0===e.attributes.data.length)&&(i._options.append?i.list.append('<div class="no-result">'+CONST.LANG.LOAD_ALL+"</div>"):i.list.append('<div class="no-result">'+CONST.LANG.NO_RESULT+"</div>"),1===i.collection.paginationModel.get("page")&&Est.trigger("resultListNone"+i._options.viewId,{}),e.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),debug(function(){return"Warm3 list.length=0"+("function"===Est.typeOf(i.collection.url)?i.collection.url():i.collection.url)}))}catch(s){Est.trigger("checkLogin"),debug("Error4 "+e.msg)}i._afterLoad(t),i._options.subRender&&i._filterRoot(),i._options.filter&&i._filterCollection(),e.attributes&&e.attributes.model&&(i._options.data=Est.extend(i._options.data,e.attributes.model)),i._finally()})):(i._afterLoad(t),i._finally())},_reload:function(t){debug("BaseList_reload"),this._empty.call(this),this.collection.reset(),this.list.empty(),this._load(t)},_finally:function(){this.afterRender&&this.afterRender.call(this,this._options),this._options.toolTip&&this._initToolTip(),BaseUtils.removeLoading()},_beforeLoad:function(t){this.beforeLoad&&this.beforeLoad.call(this,this.collection)},_afterLoad:function(t){this.afterLoad&&this.afterLoad.call(this,this.collection)},_initItems:function(){"function"===Est.typeOf(this._options.items)&&(this._options.items=this._options.items.apply(this,arguments)),this._options.filter&&(this.collection.push(this._options.items),this._filterCollection(),this._options.items=Est.pluck(Est.cloneDeep(this.collection.models,function(){},this),"attributes")),this._options._page||this._options._pageSize?this._renderListByPagination():this.filter||(Est.each(this._options.items,function(t){return this._check()?!1:void this.collection.push(new this.initModel(t))},this),this._options.subRender&&this._filterRoot())},_setTemplate:function(t){this.compileTemp=t},_getTemplate:function(){return this.compileTemp},_stop:function(){this.stopIterator=!0},_check:function(){return this.stopIterator?(this.stopIterator=!1,!0):!1},_render:function(){debug("BaseList._render"),this._addAll(),this.trigger("after",this)},_filterRoot:function(){var t=this,e=[],i=[];t.composite=!1,Est.each(t.collection.models,function(i){debug(function(){return"undefined"===Est.typeOf(i.attributes[t._options.categoryId])?"Error5 currentId = "+t._options.categoryId+";url="+t.collection.url:"undefined"===Est.typeOf(i.attributes[t._options.parentId])?"Error6 currentId="+t._options.parentId+";url="+t.collection.url:void 0},{type:"error"}),e.push({categoryId:i.attributes[t._options.categoryId],belongId:i.attributes[t._options.parentId]})}),this.collection.each(function(s){for(var n=e.length,o=[];n>0;){var a=e[n-1];a.belongId===s.get(t._options.categoryId)&&(o.unshift(a.categoryId),e.splice(n-1,1)),n--}s.set("children",o),s.set("id",s.get(t._options.categoryId)),"array"===Est.typeOf(t._options.rootValue)?Est.each(t._options.rootValue,Est.proxy(function(e){"function"===Est.typeOf(e)?e.call(this,e)&&(s.set("level",1),i.push(s)):!Est.isEmpty(e)&&s.get(t._options.rootId)&&s.get(t._options.rootId).indexOf(e)>-1?(s.set("level",1),i.push(s)):s.get(t._options.rootId)===e&&(s.set("level",1),i.push(s))},this)):s.get(t._options.rootId)===t._options.rootValue&&(s.set("level",1),i.push(s))}),Est.each(i,function(e){t._addOne(e)})},_addOne:function(t,e,i){var s=this;if(!this.filter&&!this.composite&&this.dx<this._options.max){switch(t.set({dx:this.dx++}),this._options.speed){case 1:t.set("_options",{});break;case 9:t.set("_options",{_speed:this._options.speed,_item:s._options.item,_items:s._options.items?!0:!1,_model:s._options.model,_collection:Est.isEmpty(s._options.subRender)?null:s.collection,_subRender:s._options.subRender,_collapse:s._options.collapse,_extend:s._options.extend,_checkAppend:s._options.checkAppend,_checkToggle:s._options.checkToggle,_data:s.options.data||s._options.data})}var n=new this.item({model:t,viewId:this._options.viewId,speed:this._options.speed,data:this._data,views:this.views,itemTemp:this._options.itemTemp});n._setInitModel(this.initModel),n._setViewId(this._options.viewId||app.getCurrentView()),i&&i.at<this.collection.models.length-1&&this.collection.models.length>1?this.collection.models[0===i.at?0:i.at-1].view.$el.after(n._render().el):this.list.append(n._render().el),this.views.push(n)}},_push:function(t,e){debug("BaseList._push");var i,s="number"===Est.typeOf(e)?e+1:0===this.collection.models.length?0:this.collection.models.length+1,n={at:s>this.collection.models.length?this.collection.models.length+2:s};t.cid||(t=new this.initModel(t)),this._options.items&&(i="array"===Est.typeOf(t)?Est.pluck(t,function(t){return t.attributes}):t.attributes,this._options.items.splice(n.at-1,0,i)),this.collection.push(t,n),Est.isEmpty(e)||this._exchangeOrder(s-1,s,{}),this._resetDx(),this._setValue("checked_all",!1)},_eq:function(t){return this.collection.models[t].view.$el},_resetDx:function(){debug("BaseList._resetDx");var t=0;Est.each(this.collection.models,function(e){e.set("dx",t),t++})},_findIndex:function(t){return Est.findIndex(this.collection.models,{cid:t.cid})},_filterCollection:function(){debug("BaseList._filterCollection"),this._filter(this._options.filter,this._options)},_renderListByPagination:function(){debug("BaseList._renderListByPagination"),this.page=this.collection.paginationModel.get("page"),this.pageSize=this.collection.paginationModel.get("pageSize"),this.startIndex=(this.page-1)*parseInt(this.pageSize,10),this.endIndex=this.startIndex+parseInt(this.pageSize,10);for(var t=this.startIndex;t<this.endIndex;t++)this.collection.push(this._options.items[t]);return this.collection.paginationModel.set("count",this._options.items.length),this.collection._paginationRender(),this.collection},_empty:function(){if(this.dx=0,debug("BaseList._empty"),this._options.append)return this.collection;if(this.collection&&!this.collection.remove,this.collection._reset&&this.collection._reset(),this.collection)for(var t=this.collection.length;t>-1;)this.collection.remove(this.collection[t]),t--;return this.collection.paginationModel&&(this.dx=(this.collection.paginationModel.get("pageSize")||16)*(this.collection.paginationModel.get("page")-1||0)),Est.each(this.views,function(t){
t.remove().off()}),this.views=[],this.collection},_clear:function(){debug("BaseList._clear"),this._empty.call(this),this.list.empty(),this.collection.models.length=0},_addAll:function(){debug("BaseList._addAll and call this._empty"),this._empty(),this.collection.each(this._addOne,this)},_search:function(t){debug("BaseList._search");var e=this;this._clear(),this.filter=!0,t=Est.extend({onBeforeAdd:function(){}},t),this._load({page:1,pageSize:5e3,afterLoad:function(){e.filter=!1,e._options.items?e._filterItems(t.filter||e._options.filter,t):e._filter(t.filter||e._options.filter,t)}})},_filter:function(t,e){debug("BaseList._filter");var i=this,s=[],n=i.collection.models.length;for(i.filter=!1;n>0;){this._check()&&(n=-1);var o=i.collection.models[n-1],a=!0;if(Est.each(t,function(t){var e=!1,s=Est.getValue(o.attributes,t.key);return e="regexp"===Est.typeOf(t.match)?!t.match.test(s):Est.isEmpty(s)||-1===s.indexOf(t.value),a&&!Est.isEmpty(t.value)&&e?(i.collection.remove(o),a=!1,!1):void 0}),a&&e.onBeforeAdd){var r=e.onBeforeAdd.call(this,o);"boolean"!==Est.typeOf(r)||r||(a=!1)}a&&s.unshift(o),n--}Est.each(s,function(t){t.set("_isSearch",!0),i._addOne(t)})},_filterItems:function(t,e){debug("BaseList._filterItems");var i=this,s=[],n=Est.cloneDeep(i._options.items),o=n.length;for(i.filter=!1;o>0&&!this._check();){var a=n[o-1],r=!0;if(Est.each(t,function(t){var e=!1,i=Est.getValue(a,t.key);return e="regexp"===Est.typeOf(t.match)?!t.match.test(i):Est.isEmpty(i)||-1===i.indexOf(t.value),r&&!Est.isEmpty(t.value)&&e?(n.splice(o,1),r=!1,!1):void 0}),r&&e.onBeforeAdd){var h=e.onBeforeAdd.call(this,a);"boolean"!==Est.typeOf(h)||h||(r=!1)}r&&s.unshift(a),o--}Est.each(s,function(t){t=new i.initModel(t),t.set("_isSearch",!0),i.collection.push(t)})},_checkAll:function(t){var e,i=null;"boolean"===Est.typeOf(t)?this._setValue("checked_all",t):t?(i=this._getEventTarget(t),i.is("checkbox")?this._setValue("checked_all",i.get(0).checked):this._setValue("checked_all",!this._getValue("checked_all"))):this._setValue("checked_all",!this._getValue("checked_all")),e=this._getValue("checked_all"),this.collection.each(function(t){t.view._check(e),t.view.render()}),this._checkedAll(this._getValue("checked_all"))},_checkedAll:function(t){this._setValue("checked_all",t)},_saveSort:function(t){var e={id:t.get("id")};e[this._options.sortField||"sort"]=t.get(this._options.sortField),t._saveField(e,this,{async:!1,hideTip:!0})},_insertOrder:function(t,e,i){e>t&&e++,Est.arrayInsert(this.collection.models,t,e,{arrayExchange:Est.proxy(function(t,e,i,s){this._exchangeOrder(e,i,{path:this._options.sortField||"sort",success:function(t,e){t.get("id")&&e.get("id")?(t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8")}})},this),callback:function(t){i&&i.call(this,t)}}),this._resetDx()},_exchangeOrder:function(t,e,i){var s={},n={},o=this.collection.at(t),a=this.collection.at(e);if(o.view&&a.view){var r=o.view.model.get("dx"),h=a.view.model.get("dx");s.dx=h,n.dx=r}if(i.path){var l=o.view.model.get(i.path),c=a.view.model.get(i.path);s[i.path]=c,n[i.path]=l}return o.view.model.stopCollapse=!0,a.view.model.stopCollapse=!0,this.collection.models[e]=this.collection.models.splice(t,1,this.collection.models[e])[0],o.view.model.set(s),a.view.model.set(n),e>t?o.view.$el.before(a.view.$el).removeClass("hover"):o.view.$el.after(a.view.$el).removeClass("hover"),o.view.$el.hasClass("bui-grid-row-even")?(o.view.$el.removeClass("bui-grid-row-even"),a.view.$el.addClass("bui-grid-row-even")):(o.view.$el.addClass("bui-grid-row-even"),a.view.$el.removeClass("bui-grid-row-even")),i.success&&i.success.call(this,o,a),this},_moveUp:function(t){debug("BaseList._moveUp");var e,i,s=this,n=this.collection.indexOf(t),o=[];if(this._options.subRender){i=t.get(this._options.parentId),this.collection.each(function(t){i===t.get(s._options.parentId)&&o.push(t)});var a=Est.findIndex(o,function(e){return e.get("id")===t.get("id")});if(0===a)return;e=this.collection.indexOf(o[a-1])}else{if(0===n)return;e=n-1}this._exchangeOrder(n,e,{path:this._options.sortField||"sort",success:function(t,e){t.get("id")&&e.get("id")?(this._saveSort(t),this._saveSort(e),t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8")}})},_moveDown:function(t){debug("BaseList._moveDown");var e,i,s=this,n=this.collection.indexOf(t),o=[];if(this._options.subRender){i=t.get(s._options.parentId),this.collection.each(function(t){i===t.get(s._options.parentId)&&o.push(t)});var a=Est.findIndex(o,function(e){return e.get("id")===t.get("id")});if(a===o.length-1)return;e=this.collection.indexOf(o[a+1])}else{if(n===this.collection.models.length-1)return;e=n+1}this._exchangeOrder(n,e,{path:this._options.sortField,success:function(t,e){t.get("id")&&e.get("id")?(this._saveSort(t),this._saveSort(e),t.stopCollapse=!1,e.stopCollapse=!1):debug("Error8")}})},_getCheckboxIds:function(t){return Est.pluck(this._getCheckedItems(),Est.isEmpty(t)?"id":"attributes."+t)},__filter:function(t){return t.attributes.checked},_getCheckedItems:function(t){return t?Est.chain(this.collection.models).filter(this.__filter).pluck("attributes").value():Est.chain(this.collection.models).filter(this.__filter).value()},_getItems:function(t){return Est.map(this.collection.models,function(e){return e.toJSON(t)})},_getItem:function(t){var e=this._getItems();return t=t||0,e.length>t?e[t]:null},_add:function(t){this.collection.push(t)},_batch:function(t){var e=this;return t=Est.extend({tip:CONST.LANG.SUCCESS+"！"},t),this.checkboxIds=this._getCheckboxIds(t.field||"id"),0===this.checkboxIds.length?void BaseUtils.tip(CONST.LANG.SELECT_ONE+"！"):void(t.url?$.ajax({type:"POST",async:!1,url:t.url,data:{ids:e.checkboxIds.join(",")},success:function(i){i.success?BaseUtils.tip(t.tip):BaseUtils.tip(i.msg),e._load(),t.callback&&t.callback.call(e,i)}}):(Est.each(this._getCheckedItems(),function(t){t.destroy()}),t.callback&&t.callback.call(e)))},_batchDel:function(t,e){var i=this,s=null,n="id",o=this._getEventTarget(t);return o.size()>0?(s=o.attr("data-url"),n=o.attr("data-field")||"id"):(s=t.url,id=t.id||"id"),this.checkboxIds=this._getCheckboxIds(n),this.checkboxIds&&0===this.checkboxIds.length?void BaseUtils.tip(CONST.LANG.SELECT_ONE):void BaseUtils.confirm({success:function(){i._batch({url:s,field:n,tip:CONST.LANG.DEL_SUCCESS,callback:e})}})},_clearChecked:function(){Est.each(this.collection.models,function(t){!Est.equal(t._previousAttributes.checked,t.attributes.checked)&&t.view&&(t.attributes.checked=!1,Est.trigger(t.view.cid+"checked","checked"))})}}),BaseItem=SuperView.extend({_initialize:function(t){this._initOptions(t),this._initCollapse(this.model.get("_options")),this._initTemplate(this._options),this._initBind(this._options),this._initView(this._options),this._initStyle(this._options),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.speed=this._options.speed||9},_initCollapse:function(t){t._speed>1&&(this.model.stopCollapse=!1,this.collapsed=t?t._extend:!1)},_initTemplate:function(t){t.template=t.template||t.itemTemp,t.template&&(this.$template="<div>"+t.template+"</div>",t.viewId?app.getCompileTemp(t.viewId)||app.addCompileTemp(t.viewId,Handlebars.compile(t.template)):this.template=Handlebars.compile(t.template))},_initBind:function(t){t.speed>1&&(this.model.bind("reset",this.render,this),this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this))},_initView:function(t){t.speed>1&&(this.model.view&&this.model.view.remove(),this.model.view=this)},_initStyle:function(t){if(t.speed>1){var e=this.model.get("id")?this.model.get("id")+"":this.model.get("dx")+1+"";this.model.get("dx")%2===0&&this.$el.addClass("bui-grid-row-even"),this.$el.addClass("_item_el_"+(this._options.viewId||"")+"_"+e.replace(/^[^1-9]+/,"")),this.$el.hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}},_render:function(){debug("10.BaseItem._render"),this._onBeforeRender(),this._options&&this._options.filter&&this._options.filter.call(this,this.model),this.$el.html(this.template?this.template(this.model.attributes):this._options.viewId&&app.getCompileTemp(this._options.viewId)&&app.getCompileTemp(this._options.viewId)(this.model.attributes)),this._options.modelBind&&this._modelBind();var t=this.model.get("_options");if(t&&t._subRender&&this.model.get("children")&&this.model.get("children").length>0){var e=this,i=this.model.get("level")||1,s=this.$(t._subRender+":first");this._setupEvents(t),Est.each(this.model._getChildren(t._collection),function(n){var o=null;debug(function(){return Est.isEmpty(n)?"Error20":void 0},{type:"error"}),n.set("_options",t),n.set("level",i+1),o=new t._item({model:n,data:e._options._data}),o._setInitModel(e.initModel),o._setViewId(e._options.viewId),n.view=o,s.append(o.$el),e._options.views&&e._options.views.push(o),o._render()})}return this._onAfterRender(),this},_setViewId:function(t){this._options&&(this._options.viewId=t)},_setInitModel:function(t){this.initModel=t},_setupEvents:function(t){var e=this;e._toggleCollapse.call(this,t),this.$(t._collapse+":first").click(function(){e._toggleCollapse.call(e,t)})},_toggleCollapse:function(t){var e=this;return this.model.stopCollapse?void this.$(t._subRender+":first").addClass("hide"):(e.collapsed=!e.collapsed,void(e.collapsed?(this.$(t._collapse+":first").removeClass("x-caret-down"),this.$(t._subRender+":first").slideUp(CONST.COLLAPSE_SPEED).addClass("hide")):(this.$(t._collapse+":first").addClass("x-caret-down"),this.$(t._subRender+":first").slideDown(CONST.COLLAPSE_SPEED).removeClass("hide"))))},_onBeforeRender:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this.model)},_onAfterRender:function(){this._options.toolTip&&this._initToolTip(),this.afterRender&&this.afterRender.call(this,this.model),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el)},_close:function(){debug("BaseItem._close"),this.stopListening()},_clear:function(){debug("ProductItem._clear"),this.model.destroy()},_check:function(t){var e=this.model.get("checked"),i=null,s=null,n=null,o=!0;this._checkAppend="undefined"==typeof this.model.get("_options")._checkAppend?!1:this.model.get("_options")._checkAppend,this._checkToggle="undefined"==typeof this.model.get("_options")._checkToggle?!1:this.model.get("_options")._checkToggle,this._checkAppend||(this._options.viewId?app.getView(this._options.viewId)&&app.getView(this._options.viewId)._clearChecked():debug("Error21",{type:"error"})),this._checkToggle?this.model.attributes.checked="boolean"===Est.typeOf(t)?t:!e:(this.model.attributes.checked="boolean"===Est.typeOf(t)?t:!0,this._itemActive({add:this._checkAppend})),this.model.get("checked")&&this._checkToggle?this._itemActive({add:this._checkAppend}):this._checkToggle&&(this.$el.removeClass("item-active"),this.model.set("checked",!1)),t&&t.shiftKey&&this._checkAppend?(i=app.getData("curChecked"),s=this.model.get("dx"),Est.each(this.model.collection.models,function(t){n=t.get("dx"),n>i&&s>n&&(t.attributes.checked=!0,t.view.$el.addClass("item-active"))})):app.addData("curChecked",this.model.get("dx")),"boolean"!==Est.typeOf(t)&&t&&t.stopImmediatePropagation(),Est.trigger(this.cid+"checked","checked"),this.model.get("checked")?Est.each(this.model.collection.models,function(t){t.attributes.checked||(o=!1)}):o=!1,app.getView(this._options.viewId)&&app.getView(this._options.viewId)._checkedAll(o)},_itemActive:function(t){t=t||{},app.getData("itemActiveList"+this._options.viewId)||app.addData("itemActiveList"+this._options.viewId,[]);var e=app.getData("itemActiveList"+this._options.viewId);t.add||(debug("BaseItem._itemActive"),Est.each(e,Est.proxy(function(t){$("."+t,app.getView(this._options.viewId)?app.getView(this._options.viewId).$el:$("body")).removeClass("item-active")},this)),e.length=0),this.$el.addClass("item-active"),e.push(this.$el.attr("class").replace(/^.*(_item_el_.+?)\s+.*$/g,"$1"))},_moveUp:function(t){return t.stopImmediatePropagation(),this.collapsed=!0,this._options.viewId?void app.getView(this._options.viewId)._moveUp(this.model):(debug("Error22",{type:"error"}),!1)},_moveDown:function(t){return t.stopImmediatePropagation(),this.collapsed=!0,this._options.viewId?void app.getView(this._options.viewId)._moveDown(this.model):(debug("Error23",{type:"error"}),!1)},_saveSort:function(){var t=this,e=this.$(".input-sort").val();this.model._saveField({id:this.model.get("id"),sort:e},t,{success:function(){t.model.set("sort",e)},hideTip:!0})},_getPage:function(){var t=this.model.collection.paginationModel;return t?t.get("page"):1},_del:function(t,e){t&&t.stopImmediatePropagation(),debug("1.BaseItem._del");var i=this;return app.getData("delItemDialog")&&app.getData("delItemDialog").close(),i.model.get("children").length>0?void BaseUtils.confirm({title:CONST.LANG.TIP,width:300,content:CONST.LANG.DEL_TIP}):void app.addData("delItemDialog",BaseUtils.confirm({title:CONST.LANG.WARM_TIP,content:'<div class="item-delete-confirm">'+CONST.LANG.DEL_CONFIRM+"</div>",target:t&&this._getTarget(t).get(0),success:function(t){Est.isEmpty(i.model.url())&&(i.model.attributes.id=null),i.model.destroy({wait:!0,error:function(t,e){var i=[];i.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),BaseUtils.dialog({title:CONST.LANG.TIP+"：",content:e.msg,width:250,button:i})},success:function(){i._removeFromItems(i.model.get("dx")),e&&e.call(i)}})}}))},_removeFromItems:function(t){"undefined"!==Est.typeOf(t)&&app.getView(this._options.viewId)&&(app.getView(this._options.viewId)._options.items&&app.getView(this._options.viewId)._options.items.splice(t,1),app.getView(this._options.viewId)._resetDx())}}),PaginationModel=Backbone.Model.extend({defaults:{page:1,pageSize:16,count:0},initialize:function(){debug("3.PaginationModel.initialize")}}),BaseCollection=Backbone.Collection.extend({constructor:function(t){this.options=t||{},Backbone.Collection.apply(this,[null,arguments])},_initialize:function(){debug("2.BaseCollection._initialize"),this._baseUrl=this.url,this.paginationModel||(this.paginationModel=new PaginationModel({page:this.options.page,pageSize:this.options.pageSize}))},initialize:function(){this._initialize()},parse:function(t,e){var i=this;return Est.isEmpty(t)?(debug(function(){var t="function"===Est.typeOf(i.url)?i.url():i.url;return"Error:14 "+t},{type:"error"}),[]):(this._parsePagination(t),this._parseUrl(this.paginationModel),this.options.pagination&&this.paginationModel&&this._paginationRender(),t.attributes.data)},_parseUrl:function(t){debug("- BaseCollection._parseUrl");var e=1,i=16;if(t&&t.get("pageSize")&&(i=t.get("pageSize"),e=t.get("page")),this.options.subRender&&(e=1,i=9e3),"function"!=typeof this.url){var s="";Est.isEmpty(this._itemId)||(s="/"+this._itemId),this.url=this._baseUrl+s+"?page="+e+"&pageSize="+i}},_parsePagination:function(t){debug("6.BaseCollection._parsePagination"),t.attributes=t.attributes||{page:1,per_page:10,count:10},this.paginationModel&&(this.paginationModel.set("page",t.attributes.page),this.paginationModel.set("pageSize",t.attributes.per_page),this.paginationModel.set("count",t.attributes.count))},_paginationRender:function(){seajs.use(["Pagination"],Est.proxy(function(t){if(this.pagination)this.pagination.render();else{var e=$(this.options.el),i="string"===Est.typeOf(this.options.pagination),s=$(i?this.options.pagination:"#pagination-container",e.size()>0?e:$("body"));i&&this.paginationModel.set("numLength",parseInt(s.attr("data-numLength")||7,10)),this.pagination=new t({el:s,model:this.paginationModel})}},this))},_load:function(t,e,i){return debug("4.BaseCollection._load"),this._parseUrl(i),t.fetch({success:function(){debug("5.collection reset"),e._empty()},cacheData:this.options.cache,session:this.options.session})},_setItemId:function(t){this._itemId=t,debug("- get list by itemId "+this._itemId)},_empty:function(){if(debug("BaseCollection._empty"),this.collection)for(var t=this.collection.length;t>-1;)this.collection.remove(this.collection[t]),t--}}),BaseModel=Backbone.Model.extend({defaults:{checked:!1,checked_all:!1,children:[]},baseId:"",url:function(){var t=this.baseUrl,e="";if(!t)return"";"function"===Est.typeOf(t)&&(t=t.call(this)),this.params=this.params?this.params:"";var i=Est.isEmpty(this.params)?"":"?";return this.isNew()&&Est.isEmpty(this.id)?t+i+this.params:(e=t+("/"==t.charAt(t.length-1)?"":"/")+this.id+i+this.params,debug(function(){return"[Query]"+e}),e)},_initialize:function(t){this.validateMsg=null,debug("9.BaseModel._initialize "+this.baseId)},parse:function(t,e){var i=this,s=[],n=!1;if("msg"in t&&BaseUtils.removeLoading(),Est.isEmpty(t)){var o="function"===Est.typeOf(this.url)?this.url():this.url;return debug("Error25 url"+o),BaseUtils.tip(CONST.LANG.REQUIRE_FAILED),!1}if(t&&t.msg&&t.msg===CONST.LANG.AUTH_FAILED&&BaseUtils.tip(CONST.LANG.AUTH_LIMIT,{time:2e3}),t.msg!==CONST.LANG.NOT_LOGIN||this.stopCheckLogin||Est.trigger("checkLogin"),t.msg&&!this.hideTip){t.success?(!i.isNew()||this.autoHide||this.hideAddBtn||(s.push({value:CONST.LANG.ADD_CONTINUE,callback:function(){i.set("id",null),i.set(i.baseId,null)}}),n=!0),!this.hideOkBtn&&s.push({value:CONST.LANG.CONFIRM,callback:function(){if(Est.trigger("_dialog_submit_callback"),this.autoBack="undefined"===Est.typeOf(this.autoBack)?!0:this.autoBack,"undefined"!=typeof window.topDialog)window.topDialog.close(),window.topDialog=null,$&&this.autoBack&&$(".btn-back").click();else if(app.getDialogs().length>0)try{app.getDialogs().pop().close().remove(),$&&this.autoBack&&$(".btn-back").click()}catch(t){}this.close()},autofocus:!0})):s.push({value:CONST.LANG.CONFIRM,callback:function(){this.close()},autofocus:!0}),this.hideOkBtn&&Est.trigger("_dialog_submit_callback");BaseUtils.dialog({id:"dialog_msg",title:CONST.LANG.TIP,content:'<div style="padding: 20px;">'+t.msg+"</div>",width:250,button:s});setTimeout(function(){app.getDialog("dialog_msg")&&(i.autoHide||!n)&&app.getDialog("dialog_msg").close().remove()},2e3)}if("boolean"===Est.typeOf(t.success)&&!t.success)return i.attributes._response=t,i.attributes;if(t.attributes&&t.attributes.data){var a=Est.keys(t.attributes);a.length>1&&Est.each(a,function(e){"data"!==e&&(t.attributes.data[e]=t.attributes[e])}),t=t.attributes.data}return t&&(t.id=t[i.baseId||"id"],t.checked=!1,t.time=(new Date).getTime()),t},_saveField:function(t,e,i){var s=i.async||!0,n=new e.initModel({id:t.id||e.model.get("id")});n.clear(),n.set(t),n.set("silent",!0),i.hideTip&&(n.hideTip=!0),n.hideOkBtn=!0,n.set("editField",!0),debug(function(){return n.baseUrl?void 0:"Error27"},{type:"console"}),n.baseUrl?n.save(null,{success:function(s,n){n.msg!==CONST.LANG.NOT_LOGIN||this.stopCheckLogin||Est.trigger("checkLogin"),"undefined"!=typeof i.success&&i.success&&i.success.call(e,t,n)},wait:s}):i.success&&i.success.call(e,t,{})},_getChildren:function(t){return Est.map(this.get("children"),function(e){return"string"==typeof e||"number"==typeof e?t.get(e):e})},_hideTip:function(){this.hideTip=!0},_toggle:function(){this.set("checked",!this.get("checked"))},_validation:function(t,e){return!t.silent&&e&&e.call(this,t),this.validateMsg},_getValue:function(t){return Est.getValue(this.attributes,t)},_setValue:function(t,e){Est.setValue(this.attributes,t,e)},initialize:function(){this._initialize()}}),BaseDetail=SuperView.extend({_initialize:function(t){this._initOptions(t),this._initTemplate(this._options),this._initList(this._options),this._initModel(t.model,this),this._initEnterEvent(this._options)},_initOptions:function(t){this._options=Est.extend(this.options,t||{}),this._options.speed=this._options.speed||9},_initTemplate:function(t){return this._data=t.data=t.data||{},t.template&&(this.template=Handlebars.compile(t.template),this.$template="<div>"+t.template+"</div>"),this._data},_initList:function(t){var e=this;return this.list=t.render?this.$(t.render):this.$el,0===this.list.size()&&(this.list=$(t.render)),debug(function(){return e.list&&0!==e.list.size()?void 0:"Error15 viewId="+e.options.viewId+(e._options.render?e._options.render:e.el)},{type:"error"}),this.list},_render:function(){this._initDefault&&this._initDefault.call(this),this.beforeRender&&this.beforeRender.call(this,this._options),this.list.append(this.template(this.model.attributes)),this._options.modelBind&&this._modelBind(),window.topDialog&&this.$(".form-actions").hide(),this._watchBind&&this._watchBind.call(this,this._options.template),this._bbBind&&this._bbBind.call(this,this._options.template,this.$el),this.afterRender&&this.afterRender.call(this,this._options),this._options.form&&this._form(this._options.form)._initSubmit({beforeSave:this.beforeSave,afterSave:this.afterSave}),this._options.toolTip&&this._initToolTip(),BaseUtils.removeLoading()},_initModel:function(t,e){debug(function(){return t?void 0:"Error16"},{type:"error"}),e.passId=this.options.id||this._options.data.id||Est.getUrlParam("id",window.location.href),Est.isEmpty(this.passId)?(e.passId=(new Date).getTime(),e.model=new t(this._options.data||{}),e.model.set("_data",e._options.data),e.model.set("_isAdd",e._isAdd=!0),e.render()):(e.model=new t,e.model.set("id",e.passId),e.model.set("_data",e._options.data),e.model.set("CONST",CONST),e.model.fetch().done(function(t){t.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),e.model.set("_isAdd",e._isAdd=!1),e.render()})),this._options.hideOkBtn&&(e.model.hideOkBtn=!0),this._options.hideSaveBtn&&(e.model.hideSaveBtn=!0),this._options.autoHide&&(e.model.autoHide=!0)},_form:function(t){return this.formSelector=t,this.formElemnet=this.$(this.formSelector),this},_validate:function(t){return this},_initSubmit:function(t){var e=this,i=!0,s=!0;t=t||{},$("#submit",this.el).on("click",function(){var n=$(this),o=n.is("input"),a=e.preText=o?n.val():n.html();if(i=!0,e.formElemnet.submit(),$("input, textarea, select",$(e.formSelector)).each(function(){var t,s,n,o,a;t=$(this).attr("name"),$(this).hasClass("bui-form-field-error")&&(i=!1);var r=$(this).attr("id");if(r&&-1!==r.indexOf("model")){switch(this.type){case"radio":s=$(this).is(":checked")?$(this).val():n=!0;break;case"checkbox":s=$(this).is(":checked")?Est.isEmpty($(this).attr("true-value"))?!0:$(this).attr("true-value"):Est.isEmpty($(this).attr("false-value"))?!1:$(this).attr("false-value");break;default:s=$(this).val()}if(!n)if(o=r.replace(/^model\d?-(.+)$/g,"$1"),a=o.split("."),a.length>1)try{e.model.attributes[a[0]]||(e.model.attributes[a[0]]={}),Est.setValue(e.model.attributes,o,s)}catch(h){debug("Error18 "+h)}else e.model.set(a[0],s)}}),i){if("undefined"!=typeof t.beforeSave&&(s=t.beforeSave.call(e)),"undefined"!==Est.typeOf(s)&&!s)return!1;o?n.val(CONST.LANG.SUBMIT):n.html(CONST.LANG.SUBMIT),n.prop("disabled",!0),e._save(function(i){t.afterSave&&(t.afterSave=Est.inject(t.afterSave,function(t){return new Est.setArguments(arguments)},function(t){o?n.val(a):n.html(a),n.prop("disabled",!1)}),t.afterSave.call(e,i,"string"===Est.typeOf(i)?!0:"boolean"===Est.typeOf(Est.getValue(i,"attributes._response.success"))?Est.getValue(i,"attributes._response.success"):!0)),n.html(a)},function(i){i.msg===CONST.LANG.NOT_LOGIN&&Est.trigger("checkLogin"),t.onErrorSave&&t.onErrorSave.call(e,i)}),setTimeout(function(){n.html(a),n.prop("disabled",!1)},5e3)}return!1})},_save:function(t,e){this._saveItem(t,e)},_saveItem:function(t,e){return debug("- BaseDetail._saveItem"),"string"===Est.typeOf(this.model.url)&&debug("Error29",{type:"error"}),Est.isEmpty(this.model.url())?void debug("Error19",{type:"error"}):(this.model.attributes._response&&delete this.model.attributes._response,void this.model.save(null,{wait:!0,success:function(e){debug("- BaseDetail._saveSuccess"),app.addModel(Est.cloneDeep(e.attributes)),top&&(top.model=e.attributes),t&&"function"==typeof t&&t.call(this,e)},error:function(i,s,n){200===s.status?t.call(this,s.responseText):e&&"function"==typeof e&&e.call(this,s,i,n)}}))},_empty:function(){this.model.off(),this.$el.empty().off()},_close:function(){debug("- BaseDetail.close"),this.undelegateEvents(),this.stopListening(),this.off()}});